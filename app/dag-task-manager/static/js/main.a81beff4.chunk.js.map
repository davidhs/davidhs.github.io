{"version":3,"sources":["component/textarea/index.tsx","component/play-button/index.tsx","layout/hcf/index.tsx","utils-ui.ts","page/edit-task/index.tsx","page/home/index.tsx","page/edit-depend/index.tsx","component/task-list-item/index.tsx","page/task-list/index.tsx","page/export/index.tsx","page/import/index.tsx","page/dev/index.tsx","page/dev-server/index.tsx","page/creation-selection/index.tsx","page/date/index.tsx","App.tsx","component/gantt-view/index.tsx","page/gantt/index.tsx","page/test-4/index.tsx","page/about/index.tsx","layout/mobile/index.tsx","navi.ts","gtm-storage/observable-slim.ts","gtm-storage/storka.ts","gtm-app/utils.ts","gtm-app/lz-string.ts","gtm-app/gtm-lib-common.ts","gtm-app/entity/calendar.ts","gtm-app/entity/dependency.ts","gtm-app/entity/event.ts","gtm-app/entity/link.ts","gtm-app/entity/note.ts","gtm-app/entity/poset.ts","gtm-app/entity/reminder.ts","gtm-app/entity/task.ts","gtm-app/gtm-lib.ts","gtm-app/gtm.ts","index.tsx"],"names":["TextArea","props","state","value","handleChange","bind","event","this","setState","target","onChange","children","React","Component","PlayButton","active","onClick","HCFLayout","header","content","footer","className","assert","condition","messageOrCallback","callback","errorMessage","potentialErrorMessage","Error","console","error","isObject","x","isArray","Array","parseURL","url","urlObj","URL","hash","host","hostname","href","origin","password","pathname","port","protocol","search","username","parsed_url","authority","fragment","query","userinfo","scheme","path","pathSegments","slug","queryPairs","queryObject","length","substring","split","shift","searchParams","entries","pair","push","key","Set","formatMS","format2TS","format4TS","ms","rms","days","Math","floor","hours","minutes","seconds","milliseconds","PageEditTask","gtm","navi","id","has_task","task","hasTask","description","toggle_remove_dependencies","toggle_remove_dependents","comments","to_delete","animate","animate_id","_i","getTask","back","handleChangeDescription","handleCommentChange","animationCallback","prevProps","prevState","snapshot","clearInterval","updateState","setInterval","new_comment_text","comment_index","changeComment","e","new_description","changeDescription","dependents_open","dependents_nonopen","deps","dependents","deps_open","deps_nonopen","forEach","dep_id","status","dependencies_open","dependencies_nonopen","dependencies","is_open","self_work_time","getTaskSelfWorktime","total_work_time","getTaskTotalWorktime","deleteTask","setURL","createElement","style","border","Date","date_created","toUTCString","date_modified","rows","display","flexDirection","marginTop","marginBottom","paddingBottom","paddingLeft","paddingRight","boxShadow","paddingTop","backgroundColor","fontSize","fontWeight","justifyContent","map","y","escape","join","flexWrap","description_short","n","button_text","info","minHeight","hasDueDate","alignItems","getDueDate","removeDueDate","forceStatefulRerender","changeDueDate","toJSON","isDone","getDateDone","isRemoved","getDateRemoved","isArchived","getDateArchived","hasEstimatedTime","type","getEstimatedTime","parseInt","Number","isFinite","changeEstimatedTime","priority","worktime","worktime_interval","idx","jd_from","jd_to","comment_id","idx2","text","note","getNote","addComment","finishTask","openTask","isTaskActive","stopAllTasks","startTask","_id","PageHome","routes","route","find","name","PageEditDepend","mode","list_fn","listTaskIDs","getListFn","action_fn","did","addDependency","removeDependency","addDependent","removeDependent","getActionFn","useState","dids","setDids","short_description","createTask","TaskListItem","task_id","buttonEnterText","buttonEnterOnClick","buttonEnterHide","getActiveTaskIDs","includes","work_time","setDate","useEffect","timerID","setTimeout","alignSelf","PageTaskList","title","task_ids","super_task_ids","sub_task_ids","has_task_view","index","PageExport","export_value","common","doExport","overflowWrap","fontFamily","filename","element","document","setAttribute","encodeURIComponent","body","appendChild","click","removeChild","download","now","str","el","select","execCommand","copyToClipboard","PageImport","fileInput","useRef","setText","handleFileLoaded","performImport","result","doImport","flexGrow","height","trim","width","resize","textDecoration","padding","color","borderRadius","margin","transition","lineHeight","ref","files","file","reader","FileReader","onload","onerror","readAsText","getRoute","PageDev","sub_routes","startsWith","location","reload","sub_route","PageDevServer","data","fetch","method","headers","then","catch","reason","PageCreationSelection","PageDate","GanttView","setWidth","setHeight","canvas_ref","current","clientWidth","clientHeight","useLayoutEffect","canvas","ctx","getContext","beginPath","moveTo","lineTo","stroke","fillRect","render","PageGantt","reorder","list","startIndex","endIndex","from","splice","removed","PageTest4","getIDs","initial_supertask_ids","initial_subtask_ids","filter","supertask_ids","subtask_ids","the_task","onDragEnd","destination","source","droppableId","provided","innerRef","droppableProps","subtask_id","draggableId","draggableProps","dragHandleProps","placeholder","reorderDependencies","reorderDependents","supertask_id","PageAbout","MobileLayout","hasOwnProperty","upper_self_props","Object","keys","propName","self_props","deepMixIn","source_prop_name","source_prop","target_prop","route_handlers","child_props_routes","i","route_handler","route_object","App","count","setCount","window","innerHeight","innerWidth","dimensions","setDimensions","deboundedHandleResize","fn","timer","clearTimeout","apply","arguments","debounce","addEventListener","removeEventListener","reo","child_props","JSON","parse","stringify","found_index","createNavi","initialURL","current_url","current_url_obj","history","history_index","go","offset","effective_index","_update","return_object","forward","pop","url_obj","ObservableSlim","paths","observables","targets","targetsProxy","dupProxy","create","domDelay","observer","__isProxy","__getTarget","proxy","_create","originalObservable","originalPath","observable","__length","changes","_getPath","property","jsonPointer","fullPath","lastTarget","isNaN","indexOf","replace","_notifyObservers","numChanges","paused","changesCopy","slice","observers","handler","get","parentPath","obj","reduce","prev","curr","undefined","_getProperty","parentProxy","targetProp","Function","__targetPosition","ttp","l","newPath","deleteProperty","originalChange","previousValue","assign","changesPaused","a","currentTargetProxy","b","set","receiver","foundObservable","typeOfTargetProp","targetPosition","z","parentTarget","stillExists","iterate","nestedTarget","objProp","c","d","defineProperty","writable","enumerable","configurable","Proxy","proxyItem","observe","pause","foundMatch","resume","pauseChanges","resumeChanges","remove","matchedObservable","message","other","createStorka","database_name","config","indexedDB","object","transactional","scheduler","jobTypes","jobQueue","jobHandlers","Map","working","handleJobHandlerCallback","ok","dispatch","jobType","has","jobHandler","addJobType","add","setJobHandler","scheduleJob","removeJobHandler","createScheduler","listeners","afterchange","beforechange","change","synced","syncing","ready","beforeaddchange","afteraddchange","pending_changes","accumulatedLocalChange","accumulatedDbChange","applyChangeToObject","node","last_crumb","dbInit","Promise","resolve","reject","upgrading","req","open","onblocked","onupgradeneeded","db","createObjectStore","keyPath","autoIncrement","onsuccess","close","dbInitObject","transaction","oncomplete","objectStore","put","dbGetChanges","store_req","getAll","dbRemoveAllChanges","clear","dbApplyChanges","all","dbGetObject","values","transactions","inTransaction","transactionID","dbSetObject","dbSetup","requestAddChanges","addChangeItem","changeItem","accumulateLocalChange","dispatchEvent","resetDbAccumulation","items","removedLocalAccumulation","resetLocalAccumulation","store","item","newValue","activeTransactionID","beginTransaction","endTransaction","listener","retrieved_object","init","log","delete","propertyName","prototype","call","generateRandomStringGenerator","alphabet","symbols","m","randomSymbols","randomIndex","random","randomSymbol","getDurationISO8601InMS","start","end","da","ta","getTime","tb","duration","isSafeInteger","grs1","grs2","LETTERS_LOWER_CASE","Uint8Array","crypto","getRandomValues","alph","k","LZString","f","String","fromCharCode","keyStrBase64","keyStrUriSafe","baseReverseDic","getBaseValue","character","charAt","compressToBase64","input","res","_compress","decompressFromBase64","_decompress","compressToUTF16","decompressFromUTF16","compressed","charCodeAt","compressToUint8Array","uncompressed","compress","buf","TotalLen","current_value","decompressFromUint8Array","decompress","compressToEncodedURIComponent","decompressFromEncodedURIComponent","bitsPerChar","getCharFromInt","ii","context_dictionary","context_dictionaryToCreate","context_c","context_wc","context_w","context_enlargeIn","context_dictSize","context_numBits","context_data","context_data_val","context_data_position","pow","resetValue","getNextValue","w","bits","resb","maxpower","power","dictionary","enlargeIn","dictSize","numBits","entry","val","position","VERIFICATION_LEVEL_NONE","VERIFICATION_LEVEL_MINIMAL","VERIFICATION_LEVEL_MAX","setup","verifyState","version","migratedState","migrate","newState","transactionValue","useTransaction","applyNewState","getNewState","verifyState_v20","entities","next_id","activity_stack","misc","active_task_ids","verifyState_v21","full","hasEntity","verifyEntity","getEntity","addEntity","entity","removeEntity","json","import_value","new_state","decompressed_import_value","getNextID","nextID","getState","expectedValue","getNewState_v21","migrate_from_v_0_16_0_to_v_20","oldState","storage","_next_id","old_task_ids","graph","nodes","comments_changes","old_task_id","old_task","new_status","new_task","date_due","date_opened","date_done","date_archived","date_abandoned","date_removed","estimated_time","time_estimated","tags","comments_change","task_comments","task_comment","migrate_from_v_20_to_v_21","inputState","migrationResult","createCalendar","getCalendar","verify","createDependency","source_id","target_id","getDependency","createEvent","getEvent","createLink","getLink","createNote","lib","now_json","changeText","createPoset","getPoset","createReminder","getReminder","ALLOWED_STATUSES","_verifyDependencyGraph","mark","out","L","visit","j","node_id","reverse","_updateTask","doesPathThroughDependenciesExist","task_from_id","task_to_id","isTask","S","Q","nid","date_user_modified","source_index","target_index","task_from","task_to","node_id_1","node_id_2","node_1","node_2","task_1_id","task_2_id","idx1","removeComment","comment","getComment","changePriority","due_date","getDescendantIDs","getPossibleDependencyIDs","possible_dependencies","entity_id","getPossibleDependentIDs","possible_dependents","addTag","removeTag","tag","criteria","tasks","criterion","criterion_type","filter_type","ids","getTaskDependencyIDs","getTaskDependentIDs","sort","sort_type","dedup","listTasks","rewindTask","json_now","wtu","jt1","jt2","getTotalDependencyGraph","D","tid","dependency","d_id","removeTask","changeStatus","archiveTask","stopTask","removeEstimatedTime","getStatus","getSelfEstimatedTime","getTotalEstimatedTime","current_status","getActiveTasks","isOpen","calendar","link","poset","reminder","createGTMApp","wrapTransaction","getGTMNativeApp","storka","evt","state_proxy","app","ReactDOM","getElementById","main"],"mappings":"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","file":"static/js/main.a81beff4.chunk.js","sourcesContent":["import React from \"react\";\n\nimport \"./index.css\";\n\ninterface AnyProps {\n  [key: string]: any;\n}\n\ninterface Props extends AnyProps {\n  value: string,\n  onChange: (x: React.ChangeEvent<HTMLTextAreaElement>) => void\n}\n\ninterface State {\n  value: string;\n}\n\n\nexport default class TextArea extends React.Component<Props, State> {\n  /**\n   * @param {{value: string, onChange: (e: any) => void}} props\n   */\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      value: props.value,\n    };\n\n    this.handleChange = this.handleChange.bind(this);\n  }\n\n  handleChange(event: React.ChangeEvent<HTMLTextAreaElement>) {\n    this.setState({ value: event.target.value });\n    this.props.onChange(event);\n  }\n\n  render() {\n    const { value, children } = this.props;\n    return <textarea value={value} onChange={this.handleChange} {...this.props} >{children}</textarea>;\n  }\n}\n","import React from \"react\";\n\nimport \"./index.css\";\n\ntype Props = {\n  active: boolean,\n  onChange: (active: boolean) => void\n}\n\nconst PlayButton: React.FC<Props> = (props) => {\n  const { active, onChange } = props;\n  return (\n    <button\n      onClick={() => {\n        onChange(!active);\n      }}\n    >{ active ? \"⏸️\" : \"▶️\"}</button>\n  );\n}\n\nexport default PlayButton;\n","import React from \"react\";\n\nimport \"./index.css\";\n\ninterface Props {\n  children: [React.ReactNode, React.ReactNode, React.ReactNode]\n}\n\nconst HCFLayout: React.FC<Props> = (props) => {\n  const { children } = props;\n  const [header, content, footer] = children;\n\n  return (\n    <div className=\"hcf-layout__container\">\n      <div className=\"hcf-layout__container__header\">{header}</div>\n      <div className=\"hcf-layout__container__content\">{content}</div>\n      <div className=\"hcf-layout__container__footer\">{footer}</div>\n    </div>\n  );\n}\n\n\nexport default HCFLayout;\n","/**\n * Asserts the condition `condition`.  If the value is not boolean then it is\n * cast to a boolean value.  If the condition evaluates to a falsy value then\n * an exception is raised.  An optional message `message` is displayed and\n * other optional things `...other` printed to the error console.\n *\n * @param {any} condition\n * @param {string=} message\n * @param {any=} other\n *\n * @throws Will throw an error if `condition` is falsy.\n */\nexport function assert(condition: any, messageOrCallback: string | (() => any) = \"Assertion failed\", callback?: () => any): asserts condition {\n  if (!condition) {\n    if (typeof messageOrCallback === \"string\") {\n      let errorMessage = messageOrCallback;\n      if (typeof callback === \"function\") {\n        const potentialErrorMessage = callback();\n        if (typeof potentialErrorMessage === \"string\") {\n          errorMessage = potentialErrorMessage;\n        }\n      }\n      throw new Error(errorMessage);\n    } else if (typeof messageOrCallback === \"function\") {\n      let errorMessage = \"Assertion failed\";\n      const potentialErrorMessage = messageOrCallback();\n      if (typeof potentialErrorMessage === \"string\") {\n        errorMessage = potentialErrorMessage;\n      }\n      assert(typeof callback === \"undefined\", `Assertion argument error: don't supply two callbacks!`);\n      throw new Error(errorMessage);\n    } else {\n      console.error(\"Assertion argument error:\", { condition, messageOrCallback });\n      throw new Error(`Assertion argument error: condition: ${condition}, messageOrCallback: ${messageOrCallback}`);\n    }\n  }\n}\n\n/**\n *\n * @param {any[]} validMembers\n */\nexport function createMembershipTestFunction(validMembers: any[]) {\n  let s: Set<any>;\n\n  if (Array.isArray(validMembers)) {\n    s = new Set(validMembers);\n  } else {\n    throw new Error(\"Not supported!\");\n  }\n\n  return function(potentialMember: any) {\n    return s.has(potentialMember);\n  };\n}\n\nexport function isObject(x: any) {\n  return x !== null && typeof x === \"object\";\n}\n\nexport function isArray(x: any) {\n  return Array.isArray(x);\n}\n\n/**\n * Parses URL `url`.\n *\n * TODO: I'm not sure whether or not I need to use `encodeURI()` or\n * `encodeURIComponent()` here.\n *\n * @param {string} url\n *\n * @throws Will throw an error if the URL `url` is invalid.\n */\nexport function parseURL(url: string) {\n  const urlObj = new URL(url);\n\n  const {\n    hash,\n    host,\n    hostname,\n    href,\n    origin,\n    password,\n    pathname,\n    port,\n    protocol,\n    search,\n    username,\n  } = urlObj;\n\n  const parsed_url = {\n    // From URL\n    hash,\n    host,\n    hostname,\n    href,\n    origin,\n    password,\n    pathname,\n    port,\n    protocol,\n    search,\n    username,\n    // Other\n    authority: \"\",\n    fragment: \"\",\n    query: \"\",\n    userinfo: \"\",\n    scheme: \"\",\n    path: \"\",\n    pathSegments: [] as string[],\n    slug: \"\",\n    queryPairs: [] as [string, string][],\n    queryObject: {} as { [key: string]: string },\n    url,\n  };\n\n  // protocol\n  if (protocol.length > 0) {\n    parsed_url.scheme = protocol.substring(0, protocol.length - 1);\n  }\n\n  // userinfo\n  if (username.length > 0 || password.length > 0) {\n    if (username.length > 0 && password.length === 0) {\n      parsed_url.userinfo = username;\n    } else if (username.length > 0 && password.length > 0) {\n      parsed_url.userinfo = `${username}:${password}`;\n    } else if (username.length === 0 && password.length > 0) {\n      parsed_url.userinfo = `:${password}`;\n    } else {\n      throw new Error();\n    }\n  }\n\n  // query\n  parsed_url.query = search.substring(1, search.length);\n\n  // fragment\n  parsed_url.fragment = hash.substring(1, hash.length);\n\n  // path segments\n  parsed_url.pathSegments = pathname.split(\"/\");\n  parsed_url.pathSegments.shift();\n\n  parsed_url.slug = parsed_url.pathSegments[parsed_url.pathSegments.length - 1];\n\n  if (parsed_url.userinfo.length > 0 || parsed_url.port.length > 0) {\n    if (parsed_url.hostname.length === 0) {\n      throw new Error();\n    }\n\n    const { userinfo } = parsed_url;\n\n    if (userinfo.length > 0 && port.length > 0) {\n      parsed_url.authority = `${userinfo}@${hostname}:${port}`;\n    } else if (userinfo.length > 0 && port.length === 0) {\n      parsed_url.authority = `${userinfo}@${hostname}`;\n    } else if (userinfo.length === 0 && port.length > 0) {\n      parsed_url.authority = `${hostname}:${port}`;\n    } else {\n      parsed_url.authority = hostname;\n    }\n  }\n\n  // query_pairs & query_object\n  for (const pair of urlObj.searchParams.entries()) {\n    parsed_url.queryPairs.push(pair);\n    const [key, value] = pair;\n    parsed_url.queryObject[key] = value;\n  }\n\n  // path\n  parsed_url.path = pathname;\n\n  return parsed_url;\n}\n\n/**\n *\n * @param {string} str\n */\nexport function copyToClipboard(str: string) {\n  const el = document.createElement(\"textarea\");\n  el.value = str;\n  document.body.appendChild(el);\n  el.select();\n  document.execCommand(\"copy\");\n  document.body.removeChild(el);\n}\n\n// Throttle call to function\nexport function debounce(this: any, fn: () => void, ms: number) {\n  let timer: any;\n  return () => {\n    clearTimeout(timer);\n    timer = setTimeout(() => {\n      timer = null;\n      fn.apply(this, arguments as any);\n    }, ms);\n  };\n}\n\n/**\n *\n * @param {string} filename\n * @param {string} text\n */\nexport function download(filename: string, text: string) {\n  var element = document.createElement(\"a\");\n  element.setAttribute(\n    \"href\",\n    \"data:text/plain;charset=utf-8,\" + encodeURIComponent(text)\n  );\n  element.setAttribute(\"download\", filename);\n\n  element.style.display = \"none\";\n  document.body.appendChild(element);\n\n  element.click();\n\n  document.body.removeChild(element);\n}\n\n/**\n * Encodes the string `s` to be used in regular expressions, such that it does\n * not conflict with any regular expression meta-characters.\n *\n * @param {string} s\n */\nexport function encodeForRegex(s: string) {\n  // $& means the whole matched string\n  return s.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n}\n\nconst s1 = new Set([\"has\", \"starts-width\", \"ends-with\", \"not-starts-with\"]);\n\n/**\n *\n * @param {string} query\n * @param {string} mode \"has\", \"starts-width\", \"ends-with\", \"not-starts-with\"\n * @param {boolean} caseSensitive\n */\nexport function createSearchFilter(query: string, mode: string, caseSensitive: boolean) {\n  assert(s1.has(mode));\n  assert(typeof caseSensitive === \"boolean\");\n\n  if (caseSensitive) {\n    // is case sensitive, do nothing\n  } else {\n    query = query.toLocaleLowerCase();\n  }\n\n  const escaped_query = encodeForRegex(query);\n\n  let regex = null;\n\n  if (mode === \"has\") {\n    regex = new RegExp(`.*${escaped_query}.*`);\n  } else if (mode === \"starts-width\") {\n    regex = new RegExp(`^${escaped_query}.*`);\n  } else if (mode === \"ends-with\") {\n    // TODO: I'm not sure if this one is correct.  Double check later.\n    regex = new RegExp(`.*${escaped_query}$`);\n  } else if (mode === \"not-starts-with\") {\n    regex = new RegExp(`.+${escaped_query}.*`);\n  } else {\n    throw new Error();\n  }\n\n  if (!(regex instanceof RegExp)) {\n    throw new Error();\n  }\n\n  const reg = regex;\n\n  if (caseSensitive) {\n    /**\n     *\n     * @param {string} string\n     */\n    const f = (string: string) => {\n      return string.match(reg) !== null;\n    };\n    return f;\n  } else {\n    /**\n     *\n     * @param {string} string\n     */\n    const f = (string: string) => {\n      return string.toLocaleLowerCase().match(reg) !== null;\n    };\n    return f;\n  }\n}\n\n/**\n * a u b\n *\n * @param {Set<any>} a\n * @param {Set<any>} b\n */\nexport function getSetUnion(a: Set<any>, b: Set<any>) {\n  const union = new Set([...a, ...b]);\n  return union;\n}\n\n/**\n * a n b\n *\n * @param {Set<any>} a\n * @param {Set<any>} b\n */\nexport function getSetIntersection(a: Set<any>, b: Set<any>) {\n  const intersection = new Set([...a].filter((x) => b.has(x)));\n  return intersection;\n}\n\n/**\n * a - b OR a \\ b\n *\n * @param {Set<any>} a\n * @param {Set<any>} b\n */\nexport function getSetDifference(a: Set<any>, b: Set<any>) {\n  const difference = new Set([...a].filter((x) => !b.has(x)));\n  return difference;\n}\n\n/**\n *\n * @param {Set<any>} a\n * @param {Set<any>} b\n */\nexport function getSetSymmetricDifference(a: Set<any>, b: Set<any>) {\n  const x = getSetDifference(a, b);\n  const y = getSetDifference(b, a);\n  return getSetUnion(x, y);\n}\n\n/**\n *\n * @param {string[]} strings\n * @param {string} query\n */\nexport function filterStrings(strings: string[], query: string) {\n  query = query.trim().toLowerCase();\n\n  const escaped_query = encodeForRegex(query);\n\n  if (escaped_query.length === 0) {\n    return strings;\n  }\n\n  // const startsWithRegex = new RegExp(`^${escaped_query}.*`);\n  // const notStartsHasRegex = new RegExp(`.+${escaped_query}.*`);\n  const hasRegex = new RegExp(`.*${escaped_query}.*`);\n\n  strings = strings.filter((string) => {\n    return string.toLowerCase().match(hasRegex) !== null;\n  });\n\n  return strings;\n}\n\nexport const formatMS = (function() {\n  const msInMillisecond = 1;\n  const msInSecond = 1000 * msInMillisecond;\n  const msInMinute = 60 * msInSecond;\n  const msInHour = 60 * msInMinute;\n  const msInDay = 24 * msInHour;\n\n  function format2TS(x: number) {\n    if (x < 10) {\n      return `0${x}`;\n    } else {\n      return x;\n    }\n  }\n\n  function format4TS(x: number) {\n    if (x < 10) {\n      return `00${x}`;\n    } else if (x < 100) {\n      return `0${x}`;\n    } else {\n      return x;\n    }\n  }\n\n  function formatMS(ms: number) {\n    // Remaining milliseconds\n    let rms = ms;\n\n    const days = Math.floor(rms / msInDay);\n    rms = rms - days * msInDay;\n    const hours = Math.floor(rms / msInHour);\n    rms = rms - hours * msInHour;\n    const minutes = Math.floor(rms / msInMinute);\n    rms = rms - minutes * msInMinute;\n    const seconds = Math.floor(rms / msInSecond);\n    rms = rms - seconds * msInSecond;\n    const milliseconds = Math.floor(rms / msInMillisecond);\n\n    if (ms === 0) {\n      return \"0\";\n    } else if (ms < 1000 * 60) {\n      // < 1 minute\n      // 32.781\n\n      return `${seconds}.${format4TS(milliseconds)}`;\n    } else if (ms < 1000 * 60 * 60) {\n      // < 1 hour\n      // 01:75.834\n      return `${minutes}:${format2TS(seconds)}.${format4TS(milliseconds)}`;\n    } else if (ms < 1000 * 60 * 60 * 24) {\n      // < 1 day\n      // 03:15:75.743\n\n      return `${hours}:${format2TS(minutes)}:${format2TS(seconds)}.${format4TS(\n        milliseconds\n      )}`;\n    } else {\n      // >= 1 day\n      // 3 01:75:\n\n      return `${days} ${format2TS(hours)}:${format2TS(minutes)}:${format2TS(\n        seconds\n      )}.${format4TS(milliseconds)}`;\n    }\n  }\n\n  return formatMS;\n})();\n\n/**\n * Deep mixing from `objectSource` to `objectTarget`.\n *\n * @param {any} source\n * @param {any} target\n */\nexport function deepMixIn(source: any, target: any) {\n  assert(isObject(source) || isArray(source));\n  assert(isObject(target) || isArray(target));\n\n  if (isObject(source)) {\n    assert(isObject(target));\n  } else if (isArray(source)) {\n    assert(isArray(target));\n  } else {\n    throw new Error(\"Shouldn't happen\");\n  }\n\n  if (isArray(source)) {\n    throw new Error(\"Array mixing not implemented\");\n  } else if (isObject(source)) {\n    Object.keys(source).forEach((source_prop_name) => {\n      const source_prop = source[source_prop_name];\n      if (target.hasOwnProperty(source_prop_name)) {\n        const target_prop = target[source_prop_name];\n\n        if (isObject(source_prop)) {\n          if (isObject(target_prop)) {\n            // Mix even deeper\n            deepMixIn(source_prop, target_prop);\n          } else {\n            // Replace target prop with source prop\n            target[source_prop_name] = source_prop;\n          }\n        } else if (isArray(source_prop)) {\n          if (isArray(target_prop)) {\n            throw new Error(\"Not implemented\");\n          } else {\n            // Replace target prop with source prop\n            target[source_prop_name] = source_prop;\n          }\n        } else {\n          // Replace\n          target[source_prop_name] = source_prop;\n        }\n      } else {\n        target[source_prop_name] = source_prop;\n      }\n    });\n  }\n}\n","import React from \"react\";\n\nimport TextArea from \"../../component/textarea\";\nimport PlayButton from \"../../component/play-button\";\n\nimport HCFLayout from \"../../layout/hcf\";\n\n\nimport { assert, formatMS } from \"../../utils-ui\";\nimport { Navi } from '../../navi';\n\nimport { GTMApp } from \"../../gtm-app/gtm\";\n\nimport \"./index.css\";\n\n\n\n\ninterface Props {\n  gtm: GTMApp;\n  navi: Navi;\n}\n\ninterface State {\n  url: string;\n  description: string;\n  id: string;\n  toggle_remove_dependencies: boolean;\n  toggle_remove_dependents: boolean;\n  comments: string[];\n\n\n  to_delete: boolean;\n  animate: boolean;\n  animate_id: any;\n  _i: number;\n}\n\n\n\n/**\n * URL: `gtm:/task`\n */\nexport default class PageEditTask extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n\n    const { gtm, navi } = this.props;\n\n    const id = navi.urlObj.pathSegments[1];\n\n    assert(typeof id === \"string\");\n\n    const has_task = gtm.task.hasTask(id);\n\n    const state: State = {\n      url: navi.url,\n      description: \"\",\n      id,\n      toggle_remove_dependencies: false,\n      toggle_remove_dependents: false,\n      // NOTE: probably slow\n      comments: [],\n      to_delete: false,\n      animate: false,\n      animate_id: null,\n      _i: 0\n    };\n\n    if (has_task) {\n      const task = gtm.task.getTask(id);\n      state.description = task.description;\n      state.comments = [...task.comments];\n    }\n\n    this.state = state;\n\n    if (!has_task) {\n      navi.back();\n    }\n\n    this.handleChangeDescription = this.handleChangeDescription.bind(this);\n    this.handleCommentChange = this.handleCommentChange.bind(this);\n    this.animationCallback = this.animationCallback.bind(this);\n  }\n\n  animationCallback() {\n    this.setState({ _i: this.state._i + 1 });\n  }\n\n  updateState() {\n\n    const { gtm, navi } = this.props;\n\n    const id = navi.urlObj.pathSegments[1];\n\n    if (!gtm.task.hasTask(id)) {\n      navi.back();\n      return;\n    }\n\n    if (navi.urlObj === null) {\n      // type guard\n      throw new Error();\n    }\n\n    const task = gtm.task.getTask(id);\n\n    this.setState({\n      description: task.description,\n      id,\n      // NOTE: probably slow\n      comments: [...task.comments],\n      to_delete: false,\n    });\n  }\n\n  componentDidUpdate(prevProps: any, prevState: any, snapshot: any) {\n\n    const { navi } = this.props;\n    const { animate, animate_id } = this.state;\n    if (navi.url !== prevState.url) {\n      if (navi.url === null) {\n        // type guard\n        throw new Error();\n      }\n      // WARNING: hmm...\n      clearInterval(animate_id);\n      this.setState({ url: navi.url, animate: false, animate_id: null });\n      this.updateState();\n    } else if (animate && animate_id === null) {\n      // Start animating\n      const animate_id = setInterval(this.animationCallback, 100);\n      this.setState({ animate: true, animate_id: animate_id });\n    } else if (!animate && animate_id !== null) {\n      // Stop animating\n      clearInterval(animate_id);\n      this.setState({ animate: false, animate_id: null });\n    }\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.state.animate_id);\n  }\n\n  forceRerender() {\n    const { _i } = this.state;\n    this.setState({ _i: _i + 1 });\n  }\n\n  forceStatefulRerender() {\n    const { state } = this;\n    this.setState({ ...state });\n  }\n\n  handleCommentChange(new_comment_text: string, comment_index: number) {\n    const { gtm } = this.props;\n    const { id } = this.state;\n\n    if (!gtm.task.hasTask(id)) {\n      return;\n    }\n\n    gtm.task.changeComment(id, comment_index, new_comment_text)\n\n    const task = gtm.task.getTask(id);\n\n    this.setState({\n      comments: [...task.comments],\n    });\n  }\n\n  handleChangeDescription(e: any) {\n    const { gtm } = this.props;\n    const { id } = this.state;\n\n    if (!gtm.task.hasTask(id)) {\n      return;\n    }\n\n    const new_description = e.target.value;\n\n    gtm.task.changeDescription(id, new_description)\n\n    this.setState({\n      description: new_description,\n    });\n  }\n\n  render() {\n\n    const { id } = this.state;\n    const { gtm, navi } = this.props;\n\n    \n\n\n    if (!gtm.task.hasTask(id)) {\n      navi.back();\n      return (<div>...</div>);\n    }\n\n    const task = gtm.task.getTask(id);\n\n    const { description } = task;\n\n    // Open dependents\n    const dependents_open: string[] = [];\n\n    // Non-open dependents\n    const dependents_nonopen: string[] = [];\n\n    {\n      const deps = task.dependents;\n      const deps_open = dependents_open;\n      const deps_nonopen = dependents_nonopen;\n\n      deps.forEach((dep_id) => {\n        const dep_task = gtm.task.getTask(dep_id);\n        if (dep_task.status === \"open\") {\n          deps_open.push(dep_id);\n        } else {\n          deps_nonopen.push(dep_id);\n        }\n      });\n    }\n\n    // Open dependencies\n    const dependencies_open: string[] = [];\n\n    // Non-open dependencies\n    const dependencies_nonopen: string[] = [];\n\n    {\n      const deps = task.dependencies;\n      const deps_open = dependencies_open;\n      const deps_nonopen = dependencies_nonopen;\n\n      deps.forEach((dep_id) => {\n        const dep_task = gtm.task.getTask(dep_id);\n        if (dep_task.status === \"open\") {\n          deps_open.push(dep_id);\n        } else {\n          deps_nonopen.push(dep_id);\n        }\n      });\n    }\n\n    const is_open = task.status === \"open\";\n\n    \n    \n\n\n    const self_work_time = gtm.task.getTaskSelfWorktime(id);\n    const total_work_time = gtm.task.getTaskTotalWorktime(id);\n\n    const header = (\n      <div key={1} className=\"topBar page-edit-task__header\">\n        <div>\n          <button onClick={() => { navi.back(); }}>\n            Go back\n          </button>\n          <span>{`ID: ${task.id}`}</span>\n        </div>\n        <div>\n          {\n            this.state.to_delete ? (\n              <button onClick={() => {\n                gtm.task.deleteTask(id);\n                navi.back();\n              }}>\n                Confirm deletion\n              </button>\n            ) : (\n                <button onClick={() => { this.setState({ to_delete: true }) }}>Delete</button>\n              )\n          }\n        </div>\n        <div>\n          <button onClick={() => { navi.setURL(\"gtm:/tasklist/\"); }}>\n            Go to task list\n          </button>\n        </div>\n      </div>\n    );\n\n\n    // Content\n    const content = React.createElement(\n      \"div\",\n      {\n        key: \"2\",\n      },\n      <div style={{ border: \"1px solid var(--missing)\" }}>\n        Date created: {new Date(task.date_created).toUTCString()}\n      </div>,\n      <div style={{ border: \"1px solid var(--missing)\" }}>\n        Date modified: {new Date(task.date_modified).toUTCString()}\n      </div>,\n      <div style={{ border: \"1px solid var(--missing)\" }}>\n        Work time (self): {formatMS(self_work_time)} s\n      </div>,\n      <div style={{ border: \"1px solid var(--missing)\" }}>\n        Work time (total): {formatMS(total_work_time)} s\n      </div>,\n      <div className=\"page-edit-task__1\">\n        <div className=\"page-edit-task__2\">\n          Description\n        </div>\n        <div className=\"page-edit-task__4\">\n          <TextArea className=\"page-edit-task__3\" value={description} onChange={this.handleChangeDescription} rows={12}></TextArea>\n        </div>\n      </div>,\n      // -----------------------------------------------------------------------\n      // Dependents\n      //\n      //\n      React.createElement(\n        \"div\",\n        {\n          style: {\n            display: \"flex\",\n            flexDirection: \"column\",\n\n            marginTop: \"var(--theme__task-edit-entry__margin-top)\",\n            marginBottom: \"var(--theme__task-edit-entry__margin-bottom)\",\n\n            paddingBottom: \"var(--theme__task-edit-entry__padding-bottom)\",\n            paddingLeft: \"var(--theme__task-edit-entry__padding-left)\",\n            paddingRight: \"var(--theme__task-edit-entry__padding-right)\",\n\n            border: \"var(--theme__task-edit-entry__border)\",\n            boxShadow: \"var(--theme__task-edit-entry__box-shadow)\",\n          },\n        },\n        React.createElement(\n          \"div\",\n          {\n            style: {\n              display: \"flex\",\n              flexDirection: \"column\",\n\n              paddingTop: \"var(--theme__task-edit-entry-header__padding-top)\",\n              paddingBottom:\n                \"var(--theme__task-edit-entry-header__padding-bottom)\",\n\n              marginBottom:\n                \"var(--theme__task-edit-entry-header__margin-bottom)\",\n\n              backgroundColor:\n                \"var(--theme__task-edit-entry-header__background-color)\",\n\n              boxShadow: \"var(--theme__task-edit-entry-header__box-shadow)\",\n            },\n          },\n          React.createElement(\n            \"div\",\n            {\n              style: {\n                marginTop: \"4px\",\n                marginBottom: \"8px\",\n                fontSize: \"0.9rem\",\n                fontWeight: \"bold\",\n              },\n            },\n            // Dependents\n            \"Supertasks\"\n          ),\n          React.createElement(\n            \"div\",\n            {\n              style: {\n                display: \"flex\",\n                flexDirection: \"row\",\n                justifyContent: \"space-between\",\n              },\n            },\n            React.createElement(\n              \"button\",\n              {\n                onClick: () => {\n                  navi.setURL(\n                    `gtm:/edit-depend?${[\n                      [\"id\", id],\n                      [\"type\", \"dependent\"],\n                      [\"mode\", \"add\"],\n                    ]\n                      .map((x) => x.map((y) => escape(y)).join(\"=\"))\n                      .join(\"&\")}`\n                  );\n                },\n              },\n              \"Add\"\n            ),\n            React.createElement(\n              \"button\",\n              {\n                onClick: () => {\n                  navi.setURL(\n                    `gtm:/edit-depend?${[\n                      [\"id\", id],\n                      [\"type\", \"dependent\"],\n                      [\"mode\", \"remove\"],\n                    ]\n                      .map((x) => x.map((y) => escape(y)).join(\"=\"))\n                      .join(\"&\")}`\n                  );\n                },\n              },\n              \"Remove\"\n            )\n          )\n        ),\n\n        React.createElement(\n          \"span\",\n          { style: { fontSize: \"0.8rem\", marginBottom: \"4px\" } },\n          \"Open\"\n        ),\n        React.createElement(\n          \"div\",\n          {\n            style: {\n              display: \"flex\",\n              flexDirection: \"row\",\n              flexWrap: \"wrap\",\n            },\n          },\n          dependents_open.map((dep_id) => {\n            \n            const task = gtm.task.getTask(dep_id);\n\n            const n = 20;\n\n            const description_short =\n              task.description.length <= n\n                ? task.description.substring(0, n)\n                : task.description.substring(0, n - 3) + \"...\";\n\n            const button_text = `${dep_id}: ${description_short}`;\n\n            return React.createElement(\n              \"button\",\n              {\n                key: dep_id,\n                onClick: () => {\n                  console.info(`Goto: gtm:/task/${dep_id}`);\n                  navi.setURL(`gtm:/task/${dep_id}`);\n                },\n              },\n              button_text\n            );\n          })\n        ),\n\n        // Non-open dependencies\n        React.createElement(\n          \"span\",\n          { style: { fontSize: \"0.8rem\", marginBottom: \"4px\" } },\n          \"Non-open\"\n        ),\n        React.createElement(\n          \"div\",\n          {\n            style: {\n              display: \"flex\",\n              flexDirection: \"row\",\n              flexWrap: \"wrap\",\n            },\n          },\n          dependents_nonopen.map((dep_id) => {\n            const task = gtm.task.getTask(dep_id);\n\n            const n = 20;\n\n            const description_short =\n              task.description.length <= n\n                ? task.description.substring(0, n)\n                : task.description.substring(0, n - 3) + \"...\";\n\n            const button_text = `${dep_id}: ${description_short}`;\n\n            return React.createElement(\n              \"button\",\n              {\n                key: dep_id,\n                onClick: () => {\n                  console.info(`Goto: gtm:/task/${dep_id}`);\n                  navi.setURL(`gtm:/task/${dep_id}`);\n                },\n              },\n              button_text\n            );\n          })\n        )\n      ),\n\n      // -------------------------------------------------------------------------\n      // Dependencies\n      React.createElement(\n        \"div\",\n        {\n          style: {\n            display: \"flex\",\n            flexDirection: \"column\",\n\n            marginTop: \"var(--theme__task-edit-entry__margin-top)\",\n            marginBottom: \"var(--theme__task-edit-entry__margin-bottom)\",\n\n            paddingBottom: \"var(--theme__task-edit-entry__padding-bottom)\",\n            paddingLeft: \"var(--theme__task-edit-entry__padding-left)\",\n            paddingRight: \"var(--theme__task-edit-entry__padding-right)\",\n\n            border: \"var(--theme__task-edit-entry__border)\",\n            boxShadow: \"var(--theme__task-edit-entry__box-shadow)\",\n          },\n        },\n        React.createElement(\n          \"div\",\n          {\n            style: {\n              display: \"flex\",\n              flexDirection: \"column\",\n\n              paddingTop: \"var(--theme__task-edit-entry-header__padding-top)\",\n              paddingBottom:\n                \"var(--theme__task-edit-entry-header__padding-bottom)\",\n\n              marginBottom:\n                \"var(--theme__task-edit-entry-header__margin-bottom)\",\n\n              backgroundColor:\n                \"var(--theme__task-edit-entry-header__background-color)\",\n\n              boxShadow: \"var(--theme__task-edit-entry-header__box-shadow)\",\n            },\n          },\n          React.createElement(\n            \"div\",\n            {\n              style: {\n                marginTop: \"4px\",\n                marginBottom: \"8px\",\n                fontSize: \"0.9rem\",\n                fontWeight: \"bold\",\n              },\n            },\n            \"Subtasks\"\n            //\"Dependencies\"\n          ),\n          React.createElement(\n            \"div\",\n            {\n              style: {\n                display: \"flex\",\n                flexDirection: \"row\",\n                justifyContent: \"space-between\",\n              },\n            },\n            React.createElement(\n              \"button\",\n              {\n                onClick: () => {\n                  navi.setURL(\n                    `gtm:/edit-depend?${[\n                      [\"id\", id],\n                      [\"type\", \"dependency\"],\n                      [\"mode\", \"add\"],\n                    ]\n                      .map((x) => x.map((y) => escape(y)).join(\"=\"))\n                      .join(\"&\")}`\n                  );\n                },\n              },\n              \"Add\"\n            ),\n            React.createElement(\n              \"button\",\n              {\n                onClick: () => {\n                  navi.setURL(\n                    `gtm:/edit-depend?${[\n                      [\"id\", id],\n                      [\"type\", \"dependency\"],\n                      [\"mode\", \"remove\"],\n                    ]\n                      .map((x) => x.map((y) => escape(y)).join(\"=\"))\n                      .join(\"&\")}`\n                  );\n                },\n              },\n              \"Remove\"\n            )\n          )\n        ),\n\n        React.createElement(\n          \"div\",\n          {\n            style: {\n              display: \"flex\",\n              flexDirection: \"column\",\n              style: {\n                backgroundColor: \"rgb(230, 230, 230)\",\n                marginBottom: \"4px\",\n              },\n            },\n          }, // Open dependencies\n          React.createElement(\n            \"span\",\n            { style: { fontSize: \"0.8rem\", marginBottom: \"4px\" } },\n            \"Open\"\n          ),\n          React.createElement(\n            \"div\",\n            {\n              style: {\n                display: \"flex\",\n                flexDirection: \"row\",\n                flexWrap: \"wrap\",\n                minHeight: \"4px\",\n              },\n            },\n            dependencies_open.map((dep_id) => {\n              const task = gtm.task.getTask(dep_id);\n\n              const n = 20;\n\n              const description_short =\n                task.description.length <= n\n                  ? task.description.substring(0, n)\n                  : task.description.substring(0, n - 3) + \"...\";\n\n              const button_text = `${dep_id}: ${description_short}`;\n\n              return React.createElement(\n                \"button\",\n                {\n                  key: dep_id,\n                  onClick: () => {\n                    console.info(`Goto: gtm:/task/${dep_id}`);\n                    navi.setURL(`gtm:/task/${dep_id}`);\n                  },\n                },\n                button_text\n              );\n            })\n          )\n        ),\n\n        // Non-open dependencies\n\n        React.createElement(\n          \"div\",\n          {\n            style: {\n              display: \"flex\",\n              flexDirection: \"column\",\n            },\n          },\n          React.createElement(\n            \"span\",\n            { style: { fontSize: \"0.8rem\", marginBottom: \"4px\" } },\n            \"Non-open\"\n          ),\n          React.createElement(\n            \"div\",\n            {\n              style: {\n                display: \"flex\",\n                flexDirection: \"row\",\n                flexWrap: \"wrap\",\n              },\n            },\n            dependencies_nonopen.map((dep_id) => {\n              const task = gtm.task.getTask(dep_id);\n\n              const n = 20;\n\n              const description_short =\n                task.description.length <= n\n                  ? task.description.substring(0, n)\n                  : task.description.substring(0, n - 3) + \"...\";\n\n              const button_text = `${dep_id}: ${description_short}`;\n\n              return React.createElement(\n                \"button\",\n                {\n                  key: dep_id,\n                  onClick: () => {\n                    navi.setURL(`gtm:/task/${dep_id}`);\n                  },\n                },\n                button_text\n              );\n            })\n          )\n        )\n      ),\n\n      <div style={{ display: \"flex\", flexDirection: \"column\", marginTop: \"8px\", marginBottom: \"8px\", backgroundColor: \"#f0f0f0\", paddingTop: \"4px\", paddingBottom: \"4px\" }}>\n        Due date\n        {\n          !gtm.task.hasDueDate(id)\n          ?\n          <button onClick={() => {\n            gtm.task.changeDueDate(id, (new Date()).toJSON());\n            this.forceStatefulRerender();\n          }}>Set due date</button>\n          :\n          <div style={{ display: \"flex\", flexDirection: \"row\", justifyContent: \"space-between\", alignItems: \"center\" }}>\n            <button onClick={() => {\n              navi.setURL(`gtm:/date/task/${id}/date_due`);\n            }}>{ gtm.task.getDueDate(id) }</button>\n            <button onClick={() => {\n              gtm.task.removeDueDate(id);\n              this.forceStatefulRerender();\n            }}>Remove</button>\n          </div>\n        }\n      </div>,\n\n      // -----------------------------------------------------------------------\n      // Dates\n\n      // Date done\n      gtm.task.isDone(id)\n        ? React.createElement(\n          \"div\",\n          { style: { border: \"1px solid var(--missing)\" } },\n          `Date done: ${gtm.task.getDateDone(id)}`\n        )\n        : null,\n      // Date removed\n\n      gtm.task.isRemoved(id)\n        ? React.createElement(\n          \"div\",\n          { style: { border: \"1px solid var(--missing)\" } },\n          `Date removed: ${gtm.task.getDateRemoved(id)}`\n        )\n        : null,\n\n      gtm.task.isArchived(id)\n        ? React.createElement(\n          \"div\",\n          { style: { border: \"1px solid var(--missing)\" } },\n          `Date archived: ${gtm.task.getDateArchived(id)}`\n        )\n        : null,\n\n      \n      gtm.task.hasDueDate(id)\n        ? React.createElement(\n          \"div\",\n          { style: { border: \"1px solid var(--missing)\" } },\n          `Date due: ${gtm.task.getDueDate(id)}`\n        )\n        : null,\n\n\n      <div style={{ border: \"1px solid var(--missing)\" }}>\n        Estimated time:\n        {\n          !gtm.task.hasEstimatedTime(id)\n          ?\n          <button onClick={() => {\n            // TODO: finish implementation\n            gtm.task.changeEstimatedTime(id, 0);\n            this.forceStatefulRerender();\n          }}>Set estimated time</button>\n          :\n          <input type=\"number\" value={gtm.task.getEstimatedTime(id) as number} onChange={(e) => {\n            \n            const value = parseInt(e.target.value, 10);\n            if (Number.isFinite(value)) {\n\n              gtm.task.changeEstimatedTime(id, value);\n              this.forceStatefulRerender();\n            }\n          }}/>\n        }\n      </div>,\n\n      // -----------------------------------------------------------------------\n      // Priority\n\n      <div style={{\n        border: \"1px solid var(--missing)\",\n        marginTop: \"8px\",\n        marginBottom: \"8px\"\n      }}>\n        Priority\n        <input type=\"number\" value={task.priority} onChange={(e) => { console.info(e); }} />\n      </div>,\n\n      // -----------------------------------------------------------------------\n      // Status\n      React.createElement(\n        \"div\",\n        { style: { border: \"1px solid var(--missing)\" } },\n        `Status: ${task.status}`\n      ),\n\n      // -----------------------------------------------------------------------\n      // Work time\n      <div style={{ \n        display: \"flex\",\n        flexDirection: \"column\",\n        border: \"1px solid var(--missing)\",\n        marginTop: \"8px\",\n        marginBottom: \"8px\"\n      }}>\n        Work time:\n        <ul style={{ fontSize: \"0.75rem\" }}>\n          {task.worktime.map((worktime_interval, idx) => {\n\n            if (worktime_interval.length === 2) {\n              const [jd_from, jd_to] = worktime_interval;\n              return (\n                <div key={idx}>{jd_from} - {jd_to}</div>\n              );\n            } else if (worktime_interval.length === 1) {\n              const [jd_from] = worktime_interval;\n              return (\n                <div key={idx}>{jd_from} -</div>\n              );\n            } else {\n              throw new Error();\n            }\n          })}\n        </ul>\n      </div>,\n      <div style={{ display: \"flex\", flexDirection: \"column\", border: \"1px solid var(--missing)\" }}>\n        Comments:\n        {task.comments.map((comment_id, idx2) => {\n          const comment = gtm.note.getNote(comment_id);\n          const text = comment.text;\n          return (\n            <textarea key={idx2} value={text} rows={10} onChange={(e: any) => { this.handleCommentChange(e.target.value, idx2); }}></textarea>\n          );\n          }\n        )}\n        <button\n          onClick={() => {\n            gtm.task.addComment(id);\n            this.forceStatefulRerender();\n          }}\n        >\n          Add comment\n        </button>\n      </div>\n    );\n\n    \n    \n    \n\n    const footer = (\n      <div key={3} className=\"bottomBar\" style={{ display: \"flex\", flexDirection: \"row\", justifyContent: \"space-between\" }}>\n        <div>\n          <button onClick={() => {\n            if (is_open) gtm.task.finishTask(id);\n            else gtm.task.openTask(id);\n            this.forceStatefulRerender();\n          }}>{is_open ? \"Finish\" : \"Re-open\"}</button>\n        </div>\n        <div>\n          <PlayButton\n            active={gtm.task.isTaskActive(id)}\n            onChange={(active) => {\n\n              if (active) {\n                gtm.task.stopAllTasks();\n                gtm.task.startTask(id);\n                const _id = setInterval(this.animationCallback, 20);\n                this.setState({ animate: true, animate_id: _id });\n              } else {\n                gtm.task.stopAllTasks();\n                this.setState({ animate: false, animate_id: null });\n              }\n            }}\n          />\n        </div>\n      </div>\n    );\n\n    return (\n      <HCFLayout>\n        {header}\n        {content}\n        {footer}\n      </HCFLayout>\n    );\n  }\n}\n","import React from \"react\";\n\nimport HCFLayout from \"../../layout/hcf\";\nimport { Navi } from '../../navi';\nimport { Routes } from '../../App';\n\nimport { GTMApp } from \"../../gtm-app/gtm\";\nimport { assert } from \"../../utils-ui\";\n\nimport \"./index.css\";\n\ntype Props = {\n  navi: Navi,\n  routes: Routes,\n  gtm: GTMApp,\n}\n\n\n/**\n * URL: `gtm:/home`\n * \n * @param props \n */\nconst PageHome: React.FC<Props> = (props) => {\n  const { routes, navi } = props;\n\n  const main_urls = [\n    \"gtm:/test4\",\n    \"gtm:/dev\",\n  ];\n\n  const header = (\n    <div key={1} className=\"topBar\">\n      <div className=\"page-home__header__left\">\n        Home\n      </div>\n    </div>\n  );\n\n  const content = (\n    <div key={2}>\n      <div className=\"page-home__content__mainPages\">\n        Main pages\n        <div className=\"page-home__content__mainPages__pages\">\n          {main_urls.map(url => {\n            const route = routes.find(route => route.url === url);\n            assert(typeof route !== \"undefined\");\n            return (\n              <button key={route.url} onClick={() => { navi.setURL(route.url);  }}>{route.name}</button>\n            );\n          })}\n        </div>\n      </div>\n    </div>\n  );\n\n  const footer = (\n    <div key={3} className=\"bottomBar page-home__footer\">\n      <button>STOP ALL RUNNING TASKS</button>\n    </div>\n  );\n\n\n  return (\n    <HCFLayout>\n      {header}\n      {content}\n      {footer}\n    </HCFLayout>\n  );\n}\n\n\nexport default PageHome;\n","import React, { useState } from \"react\";\n\nimport HCFLayout from \"../../layout/hcf\";\nimport { Navi } from '../../navi';\n\nimport { GTMApp } from \"../../gtm-app/gtm\";\n\nimport \"./index.css\";\n\n\nfunction getListFn(gtm: GTMApp, type: string, mode: string) {\n  if (type === \"dependency\") {\n    if (mode === \"add\") {\n      // Add dependency\n      return (id: string) => {\n        return gtm.task.listTaskIDs([\n          [\"filter\", [\"possible-new-dependencies-of\", id]],\n          [\"sort\", [\"date_modified\", \"desc\"]],\n        ]);\n      };\n    } else if (mode === \"remove\") {\n      // Remove dependency\n      return (id: string) => {\n        return gtm.task.listTaskIDs([\n          [\"filter\", [\"dependencies-of\", id]]\n        ]);\n      };\n    } else {\n      throw new Error();\n    }\n  } else if (type === \"dependent\") {\n    if (mode === \"add\") {\n      // Add possible dependent\n      return (id: string) => {\n        return gtm.task.listTaskIDs([\n          [\"filter\", [\"possible-new-dependents-of\", id]],\n          [\"sort\", [\"date_modified\", \"desc\"]],\n        ])\n      };\n    } else if (mode === \"remove\") {\n      // Remove depedent\n      return (id: string) => {\n        return gtm.task.listTaskIDs([\n          [\"filter\", [\"dependents-of\", id]]\n        ]);\n      };\n    } else {\n      throw new Error(\"\");\n    }\n  } else {\n    throw new Error(\"\");\n  }\n}\n\nfunction getActionFn(gtm: GTMApp, type: string, mode: string) {\n  if (type === \"dependency\") {\n    if (mode === \"add\") {\n      // Add dependency\n      return (id: string, did: string) => {\n        gtm.task.addDependency(id, did);\n      };\n    } else if (mode === \"remove\") {\n      // Remove dependency\n      return (id: string, did: string) => {\n        gtm.task.removeDependency(id, did);\n      };\n    } else {\n      throw new Error();\n    }\n  } else if (type === \"dependent\") {\n    if (mode === \"add\") {\n      // Add dependent\n      return (id: string, did: string) => {\n        gtm.task.addDependent(id, did);\n      };\n    } else if (mode === \"remove\") {\n      // Remove dependent\n      return (id: string, did: string) => {\n        gtm.task.removeDependent(id, did);\n      };\n    } else {\n      throw new Error(\"\");\n    }\n  } else {\n    throw new Error(\"\");\n  }\n}\n\n\ninterface Props {\n  gtm: GTMApp;\n  navi: Navi;\n}\n\n\n/**\n * URL: `gtm:/edit-depend`\n * \n * @param props \n */\nconst PageEditDepend: React.FC<Props> = (props) => {\n  const { navi, gtm } = props;\n\n  if (navi.urlObj === null) {\n    // type guard\n    throw new Error();\n  }\n\n  const { id, type, mode } = navi.urlObj.queryObject;\n\n  const list_fn = getListFn(gtm, type, mode);\n  const action_fn = getActionFn(gtm, type, mode);\n\n  \n\n  const [dids, setDids] = useState<string[]>(list_fn(id));\n\n  function handleChange(did: string) {\n    action_fn(id, did);\n    setDids(list_fn(id));\n  }\n\n  // ---------------------------------------------------------------------------\n  // Header\n  const header = React.createElement(\n    \"div\",\n    {\n      key: \"1\",\n      className: \"topBar\",\n    },\n    React.createElement(\n      \"div\",\n      {},\n      React.createElement(\n        \"button\",\n        {\n          onClick: () => {\n            navi.back();\n          },\n        },\n        \"Go back\"\n      ),\n      // `ID: ${id} | Type: ${type} | Mode: ${mode}`\n      mode === \"add\"\n        ? `Add ${\n        type === \"dependency\"\n          ? \"subtask\"\n          : \"supertask\"\n        } to ${id}`\n        : `Remove ${\n        type === \"dependency\"\n          ? \"subtask\"\n          : \"supertask\"\n        } from ${id}`\n    )\n  );\n\n  // ---------------------------------------------------------------------------\n  // Content\n  const content = React.createElement(\n    \"div\",\n    {\n      key: \"2\",\n    },\n\n    ...dids.map((did) => {\n      const task = gtm.task.getTask(did);\n\n      const n = 20;\n\n      const short_description =\n        task.description.length <= n\n          ? task.description\n          : task.description.substring(0, n - 3) + \"...\";\n      const name = `${did}: ${short_description}`;\n\n      return React.createElement(\n        \"button\",\n        {\n          key: did,\n          onClick: (e) => {\n            handleChange(did);\n          },\n        },\n        name\n      );\n    })\n  );\n\n  // ---------------------------------------------------------------------------\n  // Footer\n\n\n  const footer = (\n    <div key={3} className=\"bottomBar\" style={{ display: \"flex\", flexDirection: \"row-reverse\" }}>\n      {\n        mode === \"add\" ? \n        <button onClick={() => {\n          const task = gtm.task.createTask();\n          if (type === \"dependency\") {\n            gtm.task.addDependency(id, task.id);\n          } else if (type === \"dependent\") {\n            gtm.task.addDependent(id, task.id);\n          } else {\n            throw new Error();\n          }\n          navi.setURL(`gtm:/task/${task.id}`, 1);\n        }}>+</button> :\n        null\n      }\n    </div>\n  );\n\n  return (\n    <HCFLayout>\n      {header}\n      {content}\n      {footer}\n    </HCFLayout>\n  );\n\n}\n\n\nexport default PageEditDepend;\n","import React, { useState, useEffect } from \"react\";\n\nimport PlayButton from \"../play-button\";\n\nimport { formatMS } from \"../../utils-ui\";\nimport { Navi } from '../../navi';\n\nimport { GTMApp } from \"../../gtm-app/gtm\";\n\nimport \"./index.css\";\n\ninterface IProps {\n  gtm: GTMApp;\n  navi: Navi;\n  task_id: string,\n  buttonEnterText?: string,\n  buttonEnterOnClick?: () => void,\n  buttonEnterHide?: boolean\n}\n\nconst TaskListItem: React.FC<IProps> = (props) => {\n  const { \n    task_id, \n    gtm, \n    navi,\n    buttonEnterText = \"o\",\n    buttonEnterOnClick = () => {\n      navi.setURL(`gtm:/tasklist?id=${task_id}`)\n    },\n    buttonEnterHide = false\n  } = props;\n\n  const task = gtm.task.getTask(task_id);\n\n  const n = 30;\n\n  const short_description =\n    task.description.length <= n\n      ? task.description\n      : task.description.substring(0, n - 3) + \"...\";\n\n  \n\n  // TODO: reimplement\n\n\n  let active = gtm.task.getActiveTaskIDs().includes(task_id);\n  \n\n  const work_time = gtm.task.getTaskTotalWorktime(task_id);\n\n  const [, setDate] = useState(new Date());\n\n  // Replaces componentDidMount and componentWillUnmount\n  useEffect(() => {\n    const timerID = setTimeout(() => {\n      tick();\n    }, 1);\n\n    return function cleanup() {\n      clearInterval(timerID);\n    };\n  });\n\n  function tick() {\n    setDate(new Date());\n  }\n\n  return (\n    <div className={task.status === \"open\" ? \"task-list-item\" : \"task-list-item task-list-item--complete\"}>\n      <div style={{  display: \"flex\", flexDirection: \"row\", justifyContent: \"flex-start\" }}>\n        <button\n          style={{ paddingLeft: \"10px\", paddingRight: \"10px\" }}\n          onClick={() => {\n            navi.setURL(`gtm:/task/${task_id}?mode=edit`);\n          }}\n        >...</button>\n        <PlayButton\n          active={active}\n          onChange={(active) => {\n            if (active) {\n              // TODO: maybe change in future!\n              gtm.task.stopAllTasks();\n              gtm.task.startTask(task_id);\n            } else {\n              gtm.task.stopAllTasks();\n            }\n          }}\n        ></PlayButton>\n        <div style={{ paddingLeft: \"2px\", paddingRight: \"2px\", alignSelf: \"center\", fontSize: \"0.9rem\" }}>{short_description}</div>\n      </div>\n      \n      <div style={{ display: \"flex\", flexDirection: \"row\", justifyContent: \"flex-end\", alignItems: \"center\" }}>\n        <span style={{ paddingRight: \"2px\", fontSize: \"0.75rem\" }}>{formatMS(work_time)}</span>\n        {\n          buttonEnterHide ? null : <button onClick={buttonEnterOnClick}>{buttonEnterText}</button>\n        }\n      </div>\n    </div>\n  );\n}\n\nexport default TaskListItem;\n","import React from \"react\";\n\n\nimport HCFLayout from \"../../layout/hcf\";\n\nimport TaskListItem from \"../../component/task-list-item\";\n\nimport { Navi } from '../../navi';\nimport { GTMApp } from \"../../gtm-app/gtm\";\n\nimport \"./index.css\";\n\n\ntype Props = {\n  gtm: GTMApp,\n  navi: Navi\n}\n\n/**\n * URL: `gtm:/tasklist`\n * \n * \n * gtm:/tasklist?id=...\n * \n * @param props \n */\nconst PageTaskList: React.FC<Props> = (props) => {\n  const { gtm, navi } = props;\n\n  const id = navi.urlObj.queryObject.id;\n\n\n  let title = \"Root tasks\";\n\n\n  let task_ids: string[] = [];\n\n  let super_task_ids: string[] = [];\n  let sub_task_ids: string[] = [];\n\n  let has_task_view = false;\n\n\n  if (typeof id === \"string\") {\n\n    if (gtm.task.hasTask(id)) {\n      has_task_view = true;\n      const task = gtm.task.getTask(id);\n\n      title = task.id + \": \" + task.description;\n      if (title.length > 20) {\n        title = title.substring(0, 17) + \"...\";\n      }\n\n      super_task_ids = [...task.dependents];\n      sub_task_ids = [...task.dependencies];\n\n    } else {\n      navi.back();\n    }\n  }\n\n  task_ids = gtm.task.listTaskIDs([\n    [\"filter\", [\"roots\"]],\n    [\"sort\", [\"status\", \"open\", \"asc\"], [\"date_modified\", \"desc\"]],\n  ]);\n\n  const header = (\n    <div key={1} className=\"topBar\"\n      style={{\n        display: \"flex\",\n        flexDirection: \"row\",\n        justifyContent: \"space-between\"\n      }}\n    >\n      <div>\n        <button\n          onClick={() => {\n            navi.back();\n          }}\n        >\n          Go back\n        </button>\n        {\n          has_task_view\n            ?\n            (\n              <button onClick={() => {\n                navi.setURL(`gtm:/task/${id}?mode=edit`);\n              }}>\n                Edit\n            </button>\n            )\n            :\n            null\n        }\n        {title}\n      </div>\n      <div>\n        <button\n          onClick={() => {\n            navi.setURL(\"gtm:/home\");\n          }}\n        >\n          Go home\n      </button>\n      </div>\n    </div>\n  );\n\n  let content;\n  if (has_task_view) {\n\n    if (super_task_ids.length === 0) {\n      content = (\n        <div key={2}>\n          Roots\n          <ul>\n            {task_ids.map((task_id, index) => {\n              return (\n                <TaskListItem\n                  key={index}\n                  task_id={task_id}\n                  gtm={gtm}\n                  navi={navi}\n                ></TaskListItem>\n              );\n            })}\n          </ul>\n          Task\n        <ul>\n            <TaskListItem\n              task_id={id}\n              gtm={gtm}\n              navi={navi}\n            ></TaskListItem>\n          </ul>\n          Sub-tasks\n        <ul>\n            {sub_task_ids.map((task_id, index) => {\n              return (\n                <TaskListItem\n                  key={index}\n                  task_id={task_id}\n                  gtm={gtm}\n                  navi={navi}\n                ></TaskListItem>\n              );\n            })}\n          </ul>\n        </div>\n      );\n    } else {\n      content = (\n        <div key={2}>\n          Super-tasks\n          <ul>\n            {super_task_ids.map((task_id, index) => {\n              return (\n                <TaskListItem\n                  key={index}\n                  task_id={task_id}\n                  gtm={gtm}\n                  navi={navi}\n                ></TaskListItem>\n              );\n            })}\n          </ul>\n\n          Task\n        <ul>\n            <TaskListItem\n              task_id={id}\n              gtm={gtm}\n              navi={navi}\n            ></TaskListItem>\n          </ul>\n          Sub-tasks\n        <ul>\n            {sub_task_ids.map((task_id, index) => {\n              return (\n                <TaskListItem\n                  key={index}\n                  task_id={task_id}\n                  gtm={gtm}\n                  navi={navi}\n                ></TaskListItem>\n              );\n            })}\n          </ul>\n        </div>\n      );\n    }\n  } else {\n    content = (\n      <div key={2}>\n        <ul>\n          {task_ids.map((task_id, index) => {\n            return (\n              <TaskListItem\n                key={index}\n                task_id={task_id}\n                gtm={gtm}\n                navi={navi}\n              ></TaskListItem>\n            );\n          })}\n        </ul>\n      </div>\n    );\n  }\n\n\n\n  const footer = React.createElement(\n    \"div\",\n    {\n      key: \"3\",\n      className: \"bottomBar\",\n      style: {\n        display: \"flex\",\n        flexDirection: \"row\",\n        justifyContent: \"flex-end\",\n      },\n    },\n    <button\n      onClick={() => {\n        if (has_task_view) {\n          navi.setURL(\n            `gtm:/edit-depend?${[\n              [\"id\", id],\n              [\"type\", \"dependency\"],\n              [\"mode\", \"add\"],\n            ]\n              .map((x) => x.map((y) => escape(y)).join(\"=\"))\n              .join(\"&\")}`\n          );\n        } else {\n          const task = gtm.task.createTask();\n          navi.setURL(`gtm:/task/${task.id}`);\n        }\n      }}\n    >\n      &nbsp;+&nbsp;\n    </button>\n  );\n\n  return (\n    <HCFLayout>\n      {header}\n      {content}\n      {footer}\n    </HCFLayout>\n  );\n}\n\n\nexport default PageTaskList;\n","import React from \"react\";\n\nimport HCFLayout from \"../../layout/hcf\";\n\nimport { download, copyToClipboard } from \"../../utils-ui\";\nimport { Navi } from '../../navi';\n\nimport { GTMApp } from \"../../gtm-app/gtm\";\n\nimport \"./index.css\";\n\ninterface Props {\n  gtm: GTMApp;\n  navi: Navi;\n}\n\n/**\n * URL: `gtm:/export`\n * \n * @param props \n */\nconst PageExport: React.FC<Props> = (props) => {\n  const { gtm, navi } = props;\n  \n  const export_value = gtm.common.doExport();\n\n  // ---------------------------------------------------------------------------\n  // Header\n  const header = React.createElement(\n    \"div\",\n    {\n      key: \"1\",\n      className: \"topBar\",\n    },\n    React.createElement(\n      \"div\",\n      {},\n      React.createElement(\n        \"button\",\n        {\n          onClick: () => {\n            navi.back();\n          },\n        },\n        \"Go back\"\n      )\n    )\n  );\n\n  // ---------------------------------------------------------------------------\n  // Content\n  const content = React.createElement(\n    \"div\",\n    {\n      key: \"2\",\n      style: {\n        overflowWrap: \"break-word\",\n      },\n    },\n    React.createElement(\n      \"span\",\n      {\n        style: {\n          fontFamily: \"monospace\",\n        },\n      },\n      export_value\n    )\n  );\n\n  // ---------------------------------------------------------------------------\n  // Footer\n  const footer = React.createElement(\n    \"div\",\n    {\n      key: \"3\",\n      style: {\n        display: \"flex\",\n        justifyContent: \"space-between\",\n      },\n      className: \"bottomBar\",\n    },\n    React.createElement(\n      \"button\",\n      {\n        onClick: () => {\n          download(`export-${Date.now()}.txt`, export_value);\n        },\n      },\n      \"Download\"\n    ),\n    React.createElement(\n      \"button\",\n      {\n        onClick: () => {\n          copyToClipboard(export_value);\n        },\n      },\n      \"Copy to clipboard\"\n    )\n  );\n\n  return (\n    <HCFLayout>\n      {header}\n      {content}\n      {footer}\n    </HCFLayout>\n  );\n}\n\nexport default PageExport;\n","import React, { useState, useRef } from \"react\";\n\nimport HCFLayout from \"../../layout/hcf\";\nimport TextArea from \"../../component/textarea\";\nimport { Navi } from '../../navi';\nimport { GTMApp } from \"../../gtm-app/gtm\";\nimport { assert } from \"../../utils-ui\";\n\nimport \"./index.css\";\n\ntype Props = {\n  gtm: GTMApp,\n  navi: Navi\n}\n\n/**\n * URL: `gtm:/import`\n * \n * @param props \n */\nconst PageImport: React.FC<Props> = (props) => {\n  const { gtm, navi } = props;\n\n  const fileInput = useRef(null);\n\n  const [text, setText] = useState(\"\");\n\n  function onChange(e: any) {\n    setText(e.target.value.trim());\n  }\n\n  function handleFileLoaded(e: ProgressEvent<FileReader>) {\n    if (e.target === null) return;\n    const text = \"\" + e.target.result;\n    performImport(text);\n  }\n\n  function handleFileInputChange(e: any) {\n    assert(e.target.files.length === 1);\n    const file = e.target.files[0];\n    const reader = new FileReader()\n    reader.onload = handleFileLoaded;\n    reader.onerror = error => {\n      throw new Error();\n    }\n    reader.readAsText(file)\n  }\n\n  function performImport(text: string) {\n    gtm.common.doImport(text);\n    navi.setURL(\"gtm:/home\");\n  }\n\n  // ---------------------------------------------------------------------------\n  // Header\n  const header = React.createElement(\n    \"div\",\n    {\n      key: \"1\",\n      className: \"topBar\",\n    },\n    React.createElement(\n      \"div\",\n      {},\n      React.createElement(\n        \"button\",\n        {\n          onClick: () => {\n            navi.back();\n          },\n        },\n        \"Go back\"\n      )\n    )\n  );\n\n  // ---------------------------------------------------------------------------\n  // Content\n\n  const content = (\n    <div key={2} style={{\n      display: \"flex\",\n      flexDirection: \"column\",\n      flexGrow: 1,\n      height: \"100%\",\n    }}>\n      <TextArea value={text} onChange={onChange} style={{\n        width: \"100%\",\n        display: \"flex\",\n        flexGrow: 1,\n        resize: \"none\",\n      }}></TextArea>\n    </div>\n  );\n\n\n  // ---------------------------------------------------------------------------\n  // Footer\n\n  const footer = (\n    <div key={3} style={{ display: \"flex \"}} className=\"bottomBar\">\n      <button onClick={() => {\n        performImport(text);\n      }}>Import</button>\n      <label style={{ \n        textDecoration: \"none\",\n        display: \"inline-block\",\n        padding: \"var(--theme__button__padding)\",\n        color: \"var(--theme__button__color)\",\n        border: \"var(--theme__button__border)\",\n        borderRadius: \"var(--theme__button__border-radius)\",\n        margin: \"2px 2px 2px 2px\",\n        boxShadow: \"0px 0px 4px rgba(0, 0, 0, 0.241)\",\n        transition: \"var(--theme__button__transition)\",\n        backgroundColor: \"var(--theme__button__background-color)\",\n        fontSize: \"0.8rem\",\n        lineHeight: \"normal\",\n        }}\n        \n        >Import file<input type=\"file\" ref={fileInput} style={{ display: \"none\" }} onChange={handleFileInputChange} /></label>\n      \n    </div>\n  );\n\n  return (\n    <HCFLayout>\n      {header}\n      {content}\n      {footer}\n    </HCFLayout>\n  );\n}\n\n\nexport default PageImport;\n","import React from \"react\";\n\nimport HCFLayout from \"../../layout/hcf\";\nimport { Navi } from '../../navi';\nimport { Routes } from '../../App';\n\nimport { GTMApp } from \"../../gtm-app/gtm\";\nimport { assert } from \"../../utils-ui\";\n\nimport \"./index.css\";\n\ninterface Props {\n  gtm: GTMApp;\n  navi: Navi;\n  routes: Routes;\n}\n\nfunction getRoute(routes: Routes, url: string) {\n  const route = routes.find(route => route.url === url);\n  assert(typeof route !== \"undefined\");\n  return route;\n}\n\n\n/**\n * URL: `gtm:/dev`\n * \n */\nconst PageDev: React.FC<Props> = (props) => {\n\n  const other_urls = [    \n    \"gtm:/tasklist\", \n    \"gtm:/gantt\",\n  ];\n\n  const { navi, routes } = props;\n\n  const sub_routes: Routes = [];\n\n  routes.forEach((route) => {\n    const { url } = route;\n    if (url.startsWith(navi.url) && url !== navi.url) {\n      sub_routes.push(route);\n    }\n  });\n\n  const header = (\n    <div key={1} className=\"topBar\">\n      <button onClick={() => { navi.back(); }}>Go back</button>\n      Developer page\n    </div>\n  );\n\n  const content = (\n    <div key={2} style={{ display: \"flex\", flexDirection: \"column\" }}>\n      About\n      {(() => {\n        const url = \"gtm:/about\";\n        const route = getRoute(routes, url);\n        return (\n          <button key={url} onClick={() => { navi.setURL(url); }}>{route.name}</button>\n        );\n      })()}\n      Import / import\n      {(() => {\n        const url = \"gtm:/import\";\n        const route = getRoute(routes, url);\n        return (\n          <button key={url} onClick={() => { navi.setURL(url); }}>{route.name}</button>\n        );\n      })()}\n      {(() => {\n        const url = \"gtm:/export\";\n        const route = getRoute(routes, url);\n        return (\n          <button key={url} onClick={() => { navi.setURL(url); }}>{route.name}</button>\n        );\n      })()}\n      Reload:\n      <button onClick={() => {\n        location.reload(false); // eslint-disable-line no-restricted-globals\n      }}>Reload (from cache)</button>\n      <button onClick={() => {\n        location.reload(true); // eslint-disable-line no-restricted-globals\n      }}>Reload (ignore cache)</button>\n      Routes:\n      {sub_routes.map((sub_route) => {\n        const { name, url } = sub_route;\n        return (\n        <button key={url} onClick={() => { navi.setURL(url); }}>{name}</button>\n        );\n      })}\n      Other:\n      <button onClick={() => { throw new Error(); }}>Throw error</button>\n      Other pages:\n      {other_urls.map(url => {\n        const route = getRoute(routes, url);\n        return (\n          <button key={url} onClick={() => { navi.setURL(url); }}>{route.name}</button>\n        );\n      })}\n\n    </div>\n  );\n\n  /*\n  const footer = (\n    <div key={3} className=\"bottomBar\">\n      Footer: bla bla bla\n    </div>\n  );\n  */\n  \n  return (\n    <HCFLayout>\n      {header}\n      {content}\n      {null}\n    </HCFLayout>\n  );\n}\n\nexport default PageDev;\n\n","import React, { useState } from \"react\";\n\nimport HCFLayout from \"../../layout/hcf\";\nimport { Navi } from '../../navi';\n\nimport { GTMApp } from \"../../gtm-app/gtm\";\n\nimport \"./index.css\";\n\n\n\ninterface Props {\n  gtm: GTMApp;\n  navi: Navi;\n}\n\n\n/**\n * URL: `gtm:/dev/server`\n * \n * @param props \n */\nconst PageDevServer: React.FC<Props> = (props) => {\n  const { navi, gtm } = props;\n\n  const [text, setText] = useState(\"http://\");\n\n\n  const header = (\n    <div key={1} className=\"topBar\">\n      <div>\n        <button onClick={() => { navi.back(); }}>Go back</button>\n      </div>\n    </div>\n  );\n\n  const content = (\n    <div key={2}>\n      URL:\n      <input\n        type=\"text\"\n        value={text}\n        onChange={(e) => {\n          setText(e.target.value);\n        }}\n      ></input>\n      <button\n        onClick={() => {\n          const url = text;\n          \n          const data = gtm.common.doExport();\n          fetch(url, {\n            method: 'POST', // or 'PUT'\n            body: data, // data can be `string` or {object}!\n            headers: {\n              'Content-Type': 'application/json'\n            }\n          }).then((value) => {}).catch((reason) => {\n            console.error(reason);\n          });\n        }}\n      >\n        Send data\n      </button>\n    </div>\n  );\n  \n  /*\n  const footer = (\n    <div key={3} className=\"bottomBar\">\n      ...\n    </div>\n  );\n  */\n\n  return (\n    <HCFLayout>\n      {header}\n      {content}\n      {null}\n    </HCFLayout>\n  );\n}\n\n\nexport default PageDevServer;\n","import React /*, { useState } */ from \"react\";\n\nimport HCFLayout from \"../../layout/hcf\";\nimport { Navi } from '../../navi';\n\nimport { GTMApp } from \"../../gtm-app/gtm\";\n\nimport \"./index.css\";\n\n\ninterface Props {\n  gtm: GTMApp;\n  navi: Navi;\n}\n\n\n/**\n * URL: `gtm:/creation-selection`.\n * \n * @param props \n */\nconst PageCreationSelection: React.FC<Props> = (props) => {\n  const { navi, gtm } = props;\n\n  // const [text, setText] = useState(\"http://\");\n\n\n  const header = (\n    <div key={1} className=\"topBar\">\n      <div>\n        <button onClick={() => { navi.back(); }}>Go back</button>\n      </div>\n    </div>\n  );\n\n  /*\n\n        <button\n        onClick={() => {\n          navi.setURL(`gtm:/view`, 1);\n        }}\n      >\n        Create view\n      </button>\n\n  */\n\n  const content = (\n    <div key={2} className=\"page-creation-selection\">\n\n      <button\n        onClick={() => {\n          const task = gtm.task.createTask();\n          navi.setURL(`gtm:/task/${task.id}`, 1);\n        }}\n      >\n        Create task\n      </button>\n    </div>\n  );\n\n  /*\n  const footer = (\n    <div key={3} className=\"bottomBar\">\n      ...\n    </div>\n  );\n  */\n\n  return (\n    <HCFLayout>\n      {header}\n      {content}\n      {null}\n    </HCFLayout>\n  );\n}\n\n\nexport default PageCreationSelection;\n","import React from \"react\";\n\nimport HCFLayout from \"../../layout/hcf\";\nimport { Navi } from '../../navi';\n\nimport { GTMApp } from \"../../gtm-app/gtm\";\n\nimport \"./index.css\";\n\n\ninterface Props {\n  gtm: GTMApp;\n  navi: Navi;\n}\n\n\n/**\n * URL: `gtm:/date`.\n * \n * gtm:/date/task/534/date_modified\n * \n * @param props \n */\nconst PageDate: React.FC<Props> = (props) => {\n  const { navi } = props;\n\n\n  const header = (\n    <div key={1} className=\"topBar\">\n      <div>\n        <button onClick={() => { navi.back(); }}>Go back</button>\n        Edit date\n      </div>\n    </div>\n  );\n\n  const content = (\n    <div key={2}>\n      <div>Calendar here...</div>\n      <div>Time here...</div>\n    </div>\n  );\n\n  /*\n  const footer = (\n    <div key={3} className=\"bottomBar\">\n      ...\n    </div>\n  );\n  */\n\n  return (\n    <HCFLayout>\n      {header}\n      {content}\n      {null}\n    </HCFLayout>\n  );\n}\n\n\nexport default PageDate;\n","import React, { useState, useEffect } from 'react';\n\nimport PageEditTask from \"./page/edit-task\";\nimport PageHome from \"./page/home\";\nimport PageEditDepend from \"./page/edit-depend\";\nimport PageTaskList from \"./page/task-list\";\nimport PageExport from \"./page/export\";\nimport PageImport from \"./page/import\";\nimport PageDev from \"./page/dev\";\nimport PageDevServer from \"./page/dev-server\";\nimport PageCreationSelection from \"./page/creation-selection\";\nimport PageDate from \"./page/date\";\nimport PageGantt from \"./page/gantt\";\nimport PageTest4 from \"./page/test-4\";\nimport PageAbout from \"./page/about\";\n\nimport MobileLayout from \"./layout/mobile\";\n\nimport { Navi } from './navi';\nimport { GTMApp } from \"./gtm-app/gtm\";\nimport { debounce } from './utils-ui';\n\nimport \"./App.css\";\n\n\nexport type Route = { name: string, url: string };\nexport type Routes = Route[];\n\n\nconst route_handlers = [\n  {\n    name: \"Developer page: server\",\n    url: \"gtm:/dev/server\",\n    element: PageDevServer\n  },\n  {\n    name: \"Creation selection\",\n    url: \"gtm:/creation-selection\",\n    element: PageCreationSelection\n  },\n  {\n    name: \"Edit depend\",\n    url: \"gtm:/edit-depend\",\n    element: PageEditDepend,\n  },\n  {\n    name: \"Home\",\n    url: \"gtm:/home\",\n    element: PageHome,\n  },\n  {\n    name: \"Task list (legacy)\",\n    url: \"gtm:/tasklist\",\n    element: PageTaskList,\n  },\n  {\n    name: \"Edit task\",\n    url: \"gtm:/task\",\n    element: PageEditTask,\n  },\n  {\n    name: \"Import\",\n    url: \"gtm:/import\",\n    element: PageImport,\n  },\n  {\n    name: \"Export\",\n    url: \"gtm:/export\",\n    element: PageExport,\n  },\n  {\n    name: \"Developer page\",\n    url: \"gtm:/dev\",\n    element: PageDev,\n  },\n  {\n    name: \"Date\",\n    url: \"gtm:/date\",\n    element: PageDate\n  },\n  {\n    name: \"Gantt\",\n    url: `gtm:/gantt`,\n    element: PageGantt\n  },\n  {\n    name: \"Task list\",\n    url: \"gtm:/test4\",\n    element: PageTest4\n  },\n  {\n    name: \"About\",\n    url: \"gtm:/about\",\n    element: PageAbout\n  }\n];\n\n\nconst child_props_routes: any[] = [];\nfor (let i = 0; i < route_handlers.length; i++) {\n  const route_handler = route_handlers[i];\n  const route_object: { [key: string]: any } = {};\n  Object.keys(route_handler).forEach((key) => {\n    if (key !== \"element\") {\n      route_object[key] = (route_handler as any)[key];\n    }\n  });\n  child_props_routes.push(route_object);\n}\n\n\n\n\n\ntype Props = {\n  gtm: GTMApp,\n  navi: Navi\n}\n\nconst App: React.FC<Props> = (props) => {\n  const { gtm, navi } = props;\n\n  const { url } = navi;\n\n  const [count, setCount] = useState(1);\n\n  const [dimensions, setDimensions] = useState({\n    height: window.innerHeight,\n    width: window.innerWidth,\n  });\n\n  const initial_url = \"gtm:/home\";\n\n  useEffect(() => {\n    function handleResize() {\n      if (\n        !(\n          dimensions.height === window.innerHeight &&\n          dimensions.width === window.innerWidth\n        )\n      ) {\n        setDimensions({\n          height: window.innerHeight,\n          width: window.innerWidth,\n        });\n      }\n    }\n    const deboundedHandleResize = debounce(handleResize, 500);\n    window.addEventListener(\"resize\", deboundedHandleResize);\n    return () => {\n      // Cleanup\n      window.removeEventListener(\"resize\", deboundedHandleResize);\n    };\n  });\n\n  navi.callback = () => {\n    setCount(count + 1);\n  };\n\n  const child_props = {\n    navi,\n    gtm,\n    routes: JSON.parse(JSON.stringify(child_props_routes))\n  };\n\n  let found_index = -1;\n\n  for (let i = 0; i < route_handlers.length; i++) {\n    const route_handler = route_handlers[i];\n    if (url.startsWith(route_handler.url)) {\n      found_index = i;\n      break;\n    }\n  }\n\n  let reo;\n\n  if (found_index !== -1) {\n    reo = (\n      <MobileLayout>\n        {React.createElement(route_handlers[found_index].element as any, child_props)}\n      </MobileLayout>\n    );\n  } else {\n    reo = (\n      <MobileLayout>\n        <div className=\"app\">\n          Unhandled route: {url}\n          <button onClick={() => { navi.setURL(initial_url); }} >Go home</button>\n        </div>\n      </MobileLayout>\n    );\n  }\n\n  // If this application breaks then maybe try to reload the page.\n  (window as any)[\"isgtmok\"] = true;\n\n  return reo;\n}\n\nexport default App;\n","import React, { useRef, useEffect, useLayoutEffect, useState } from \"react\";\n\nimport \"./index.css\";\n\ninterface IProps {}\n\n\nfunction render(canvas: HTMLCanvasElement) {\n  const ctx = canvas.getContext(\"2d\");\n  if (ctx === null) return;\n\n  ctx.fillRect(0, 0, 10, 10);\n}\n\n\nconst GanttView: React.FC<IProps> = (props) => {\n\n  const [width, setWidth] = useState(0);\n  const [height, setHeight] = useState(0);\n  \n  \n  const canvas_ref = useRef<HTMLCanvasElement>(null);\n\n  // responsive width and height\n  useEffect(() => {\n    const target_ref = canvas_ref;\n    const target = target_ref.current;\n    if (target === null) return;\n\n    console.info(\"yo?\");\n\n    target.width = target.clientWidth;\n    target.height = target.clientHeight;\n\n    setWidth(target.clientWidth);\n    setHeight(target.clientHeight);\n  }, []);\n\n  useLayoutEffect(() => {\n\n\n    const canvas = canvas_ref.current;\n\n    if (canvas === null) return;\n\n    console.info(canvas.width, canvas.height);\n\n    const ctx = canvas.getContext('2d');\n\n    if (ctx === null) return;\n\n    // some canvas stuff..\n    ctx.beginPath()\n    ctx.moveTo(0,height/2)\n    ctx.lineTo(width, height/2)\n    ctx.stroke()\n\n    render(canvas);\n\n  }, [width, height]);\n\n\n  return <canvas className=\"gant-view\" ref={canvas_ref}/>;\n}\n\nexport default GanttView;\n\n\n// Hook\n/*\nfunction useWindowSize() {\n  const isClient = typeof window === \"object\";\n\n  function getSize() {\n\n  } \n\n}\n*/","import React from \"react\";\n\nimport HCFLayout from \"../../layout/hcf\";\n\nimport GanttView from \"../../component/gantt-view\";\n\nimport { Navi } from '../../navi';\nimport { GTMApp } from \"../../gtm-app/gtm\";\n\nimport \"./index.css\";\n\n\n\ninterface IProps {\n  navi: Navi\n  gtm: GTMApp,\n\n}\n\n\n/**\n * URL: `gtm:/gantt`\n * \n * @param props \n */\nconst PageGantt: React.FC<IProps> = (props) => {\n  const { navi } = props;\n\n  const header = (\n    <div key={1} className=\"topBar\"\n      style={{\n        display: \"flex\",\n        flexDirection: \"row\",\n        justifyContent: \"space-between\"\n      }}\n    >\n      <div>\n        <button\n          onClick={() => {\n            navi.back();\n          }}\n        >\n          Go back\n        </button>\n      </div>\n    </div>\n  );\n\n  const content = (\n    <div key={2} className=\"page-gantt__content\">\n      <GanttView/>\n    </div>\n  );\n\n  const footer = (\n    <div key={3} className=\"bottomBar page-home__footer\">\n      Footer\n    </div>\n  );\n\n\n  return (\n    <HCFLayout>\n      {header}\n      {content}\n      {footer}\n    </HCFLayout>\n  );\n}\n\n\nexport default PageGantt;\n","import React, { useState, useEffect } from \"react\";\nimport { DragDropContext, Droppable, Draggable } from \"react-beautiful-dnd\";\n\n\nimport HCFLayout from \"../../layout/hcf\";\nimport { Navi } from '../../navi';\nimport { GTMApp } from \"../../gtm-app/gtm\";\n\nimport TaskListItem from \"../../component/task-list-item\";\n\nimport \"./index.css\";\n\n\ninterface IProps {\n  gtm: GTMApp,\n  navi: Navi\n}\n\nconst reorder = (list: any[], startIndex: number, endIndex: number) => {\n  const result = Array.from(list);\n  const [removed] = result.splice(startIndex, 1);\n  result.splice(endIndex, 0, removed);\n\n  return result;\n};\n\n\n/**\n * URL: `gtm:/test4`\n * \n * @param props \n */\nconst PageTest4: React.FC<IProps> = (props) => {\n  const { navi, gtm } = props;\n\n  const { id: task_id } = navi.urlObj.queryObject;\n\n  function getIDs(task_id: string) {\n    let initial_supertask_ids: string[] = [];\n    let initial_subtask_ids: string[] = [];\n\n    if (typeof task_id === \"undefined\") {\n      // Roots\n      initial_supertask_ids = [];\n      initial_subtask_ids = gtm.task.listTaskIDs([\n        [\"filter\", [\"roots\"]],\n        [\"sort\", [\"status\", \"open\", \"asc\"], [\"date_modified\", \"desc\"]],\n      ]);\n    } else {\n\n      if (gtm.task.hasTask(task_id)) {\n        const task = gtm.task.getTask(task_id);\n\n        if (task.dependents.length === 0) {\n          // Roots\n          initial_supertask_ids = gtm.task.listTaskIDs([\n            [\"filter\", [\"roots\"]],\n            [\"sort\", [\"status\", \"open\", \"asc\"], [\"date_modified\", \"desc\"]],\n          ]).filter(id => id !== task_id);\n        } else {\n          // Dependents\n          initial_supertask_ids = [...task.dependents];\n        }\n\n        initial_subtask_ids = [...task.dependencies];\n      } else {\n        // error\n      }\n\n    }\n\n    return [initial_supertask_ids, initial_subtask_ids];\n  }\n\n  const [initial_supertask_ids, initial_subtask_ids] = getIDs(task_id);\n\n  const [state, setState] = useState<{ supertask_ids: string[], subtask_ids: string[], task_id?: string }>({\n    supertask_ids: initial_supertask_ids,\n    subtask_ids: initial_subtask_ids,\n    task_id,\n  });\n\n  useEffect(() => {\n    if (task_id !== state.task_id) {\n      const [initial_supertask_ids, initial_subtask_ids] = getIDs(task_id);\n      setState({\n        ...state,\n        supertask_ids: initial_supertask_ids,\n        subtask_ids: initial_subtask_ids,\n        task_id,\n      })\n    }\n  }, [task_id]);\n\n\n  if (typeof task_id !== \"undefined\") {\n    if (!gtm.task.hasTask(task_id)) {\n      navi.back();\n      return (\n        <div>...</div>\n      );\n    }\n  }\n\n  let the_task = typeof task_id === \"undefined\" ? null : gtm.task.getTask(task_id);\n\n  let description: string;\n\n  if (the_task === null) {\n    description = \"Roots\";\n  } else {\n    if (the_task.description.length > 20) {\n      description = the_task.description.substring(0, 17) + \"...\";\n    } else {\n      description = the_task.description;\n    }\n  }\n\n\n\n  const header = (\n    <div key={1} className=\"topBar\"\n      style={{\n        display: \"flex\",\n        flexDirection: \"row\",\n        justifyContent: \"space-between\"\n      }}\n    >\n      <div>\n        <button\n          onClick={() => {\n            navi.back();\n          }}\n        >\n          Go back\n        </button>\n        { description }\n      </div>\n      <div>\n        <button\n          onClick={() => {\n            navi.setURL(\"gtm:/home\");\n          }}\n        >\n          Go home\n      </button>\n      </div>\n    </div>\n  );\n\n  let content;\n\n  if (typeof task_id === \"undefined\") {\n    // Show root elements\n    content = (\n      <div key={2}>\n        <DragDropContext\n          onDragEnd={(result) => {\n            if (!result.destination) {\n              return;\n            }\n\n            if (result.destination.index === result.source.index) {\n              return;\n            }\n\n            const subtask_ids = reorder(\n              state.subtask_ids,\n              result.source.index,\n              result.destination.index\n            );\n\n            setState({ ...state, subtask_ids });\n          }}\n        >\n          <Droppable droppableId=\"list\">\n            {provided => (\n              <div ref={provided.innerRef} {...provided.droppableProps}>\n                {state.subtask_ids.map((subtask_id, index) => {\n                  return (\n                    <Draggable key={subtask_id} draggableId={subtask_id} index={index}>\n                      {provided => (\n                        <div\n                          className=\"page-test-item\"\n                          ref={provided.innerRef}\n                          {...provided.draggableProps}\n                          {...provided.dragHandleProps}\n                        >\n                          <TaskListItem\n                            gtm={gtm}\n                            navi={navi}\n                            task_id={subtask_id}\n                            buttonEnterText=\">\"\n                            buttonEnterOnClick={() => {\n                              navi.setURL(`gtm:/test4?id=${subtask_id}`);\n                            }}\n                          />\n                        </div>\n                      )}\n                    </Draggable>\n                  );\n                })}\n                {provided.placeholder}\n              </div>\n            )}\n          </Droppable>\n        </DragDropContext>\n      </div>\n    );\n  } else {\n    const task = gtm.task.getTask(task_id);\n    if (task.dependents.length === 0) {\n      // Has no dependents\n      content = (\n        <div key={2}>\n          <div style={{ display: \"flex\", flexDirection: \"column\" }}>\n            <button\n              onClick={() => {\n                navi.setURL(`gtm:/test4`);\n              }}\n            >Roots</button>\n          </div>\n          Task\n          <TaskListItem\n            gtm={gtm}\n            navi={navi}\n            task_id={task_id}\n            buttonEnterHide={true}\n          />\n          Subtasks\n          <DragDropContext\n            onDragEnd={(result) => {\n              if (!result.destination) {\n                return;\n              }\n\n              if (result.destination.index === result.source.index) {\n                return;\n              }\n\n              gtm.task.reorderDependencies(task_id, result.source.index, result.destination.index);\n\n              const subtask_ids = reorder(\n                state.subtask_ids,\n                result.source.index,\n                result.destination.index\n              );\n\n              setState({ ...state, subtask_ids });\n            }}\n          >\n            <Droppable droppableId=\"list2\">\n              {provided => (\n                <div ref={provided.innerRef} {...provided.droppableProps}>\n                  {state.subtask_ids.map((subtask_id, index) => {\n                    return (\n                      <Draggable key={subtask_id} draggableId={subtask_id} index={index}>\n                        {provided => (\n                          <div\n                            className=\"page-test-item\"\n                            ref={provided.innerRef}\n                            {...provided.draggableProps}\n                            {...provided.dragHandleProps}\n                          >\n                            <TaskListItem\n                              gtm={gtm}\n                              navi={navi}\n                              task_id={subtask_id}\n                              buttonEnterText=\">\"\n                              buttonEnterOnClick={() => {\n                                navi.setURL(`gtm:/test4?id=${subtask_id}`);\n                              }}\n                            />\n                          </div>\n                        )}\n                      </Draggable>\n                    );\n                  })}\n                  {provided.placeholder}\n                </div>\n              )}\n            </Droppable>\n          </DragDropContext>\n        </div>\n      );\n    } else {\n      // Has dependents\n      content = (\n        <div key={2}>\n          Supertasks\n\n            <DragDropContext\n            onDragEnd={(result) => {\n              if (!result.destination) {\n                return;\n              }\n\n              if (result.destination.index === result.source.index) {\n                return;\n              }\n\n              gtm.task.reorderDependents(task_id, result.source.index, result.destination.index);\n\n              const supertask_ids = reorder(\n                state.supertask_ids,\n                result.source.index,\n                result.destination.index\n              );\n              setState({ ...state, supertask_ids });\n            }}\n          >\n            <Droppable droppableId=\"list1\">\n              {provided => (\n                <div ref={provided.innerRef} {...provided.droppableProps}>\n                  {state.supertask_ids.map((supertask_id, index) => {\n                    return (\n                      <Draggable key={supertask_id} draggableId={supertask_id} index={index}>\n                        {provided => (\n                          <div\n                            className=\"page-test-item\"\n                            ref={provided.innerRef}\n                            {...provided.draggableProps}\n                            {...provided.dragHandleProps}\n                          >\n                            <TaskListItem\n                              gtm={gtm}\n                              navi={navi}\n                              task_id={supertask_id}\n                              buttonEnterText=\"<\"\n                              buttonEnterOnClick={() => {\n                                navi.setURL(`gtm:/test4?id=${supertask_id}`);\n                              }}\n                            />\n                          </div>\n                        )}\n                      </Draggable>\n                    );\n                  })}\n                  {provided.placeholder}\n                </div>\n              )}\n            </Droppable>\n          </DragDropContext>\n          Task\n          <TaskListItem\n            gtm={gtm}\n            navi={navi}\n            task_id={task_id}\n            buttonEnterHide={true}\n          />\n          Subtasks\n          <DragDropContext\n            onDragEnd={(result) => {\n              if (!result.destination) {\n                return;\n              }\n\n              if (result.destination.index === result.source.index) {\n                return;\n              }\n\n              gtm.task.reorderDependencies(task_id, result.source.index, result.destination.index);\n\n              const subtask_ids = reorder(\n                state.subtask_ids,\n                result.source.index,\n                result.destination.index\n              );\n\n              setState({ ...state, subtask_ids });\n            }}\n          >\n            <Droppable droppableId=\"list2\">\n              {provided => (\n                <div ref={provided.innerRef} {...provided.droppableProps}>\n                  {state.subtask_ids.map((subtask_id, index) => {\n                    return (\n                      <Draggable key={subtask_id} draggableId={subtask_id} index={index}>\n                        {provided => (\n                          <div\n                            className=\"page-test-item\"\n                            ref={provided.innerRef}\n                            {...provided.draggableProps}\n                            {...provided.dragHandleProps}\n                          >\n                            <TaskListItem\n                              gtm={gtm}\n                              navi={navi}\n                              task_id={subtask_id}\n                              buttonEnterText=\">\"\n                              buttonEnterOnClick={() => {\n                                navi.setURL(`gtm:/test4?id=${subtask_id}`);\n                              }}\n                            />\n                          </div>\n                        )}\n                      </Draggable>\n                    );\n                  })}\n                  {provided.placeholder}\n                </div>\n              )}\n            </Droppable>\n          </DragDropContext>\n        </div>\n      );\n    }\n  }\n\n\n\n  const footer = (\n    <div key={3} className=\"bottomBar\" style={{ display: \"flex\", flexDirection: \"row\", justifyContent: \"flex-end\" }}>\n      <button\n        onClick={() => {\n          if (typeof task_id !== \"undefined\") {\n            navi.setURL(\n              `gtm:/edit-depend?${[\n                [\"id\", task_id],\n                [\"type\", \"dependency\"],\n                [\"mode\", \"add\"],\n              ]\n                .map((x) => x.map((y) => escape(y)).join(\"=\"))\n                .join(\"&\")}`\n            );\n          } else {\n            const task = gtm.task.createTask();\n            navi.setURL(`gtm:/task/${task.id}`);\n          }\n        }}\n      >\n        &nbsp;+&nbsp;\n    </button>\n    </div>\n  );\n\n  return (\n    <HCFLayout>\n      {header}\n      {content}\n      {footer}\n    </HCFLayout>\n  );\n}\n\n\nexport default PageTest4;\n","import React from \"react\";\n\nimport HCFLayout from \"../../layout/hcf\";\nimport { Navi } from '../../navi';\n\n\nimport \"./index.css\";\n\ninterface IProps {\n  navi: Navi\n}\n\n\n/**\n * URL: `gtm:/about`\n * \n * @param props \n */\nconst PageAbout: React.FC<IProps> = (props) => {\n  const { navi } = props;\n\n  const header = (\n    <div key={1} className=\"topBar\"\n      style={{\n        display: \"flex\",\n        flexDirection: \"row\",\n        justifyContent: \"space-between\"\n      }}\n    >\n      <div>\n        <button\n          onClick={() => {\n            navi.back();\n          }}\n        >\n          Go back\n        </button>\n      </div>\n      <div>\n        <button\n          onClick={() => {\n            navi.setURL(\"gtm:/home\");\n          }}\n        >\n          Go home\n      </button>\n      </div>\n    </div>\n  );\n\n  const content = (\n    <div>\n      Last updated: 2020-02-27 15:51\n    </div>\n  );\n\n  const footer = (\n    <div key={3} className=\"bottomBar\" style={{ display: \"flex\", flexDirection: \"row\", justifyContent: \"flex-end\" }}>\n    </div>\n  );\n\n  return (\n    <HCFLayout>\n      {header}\n      {content}\n      {footer}\n    </HCFLayout>\n  );\n}\n\n\nexport default PageAbout;\n","import React from \"react\";\n\nimport { deepMixIn } from \"../../utils-ui\";\nimport CSS from 'csstype';\n\nimport \"./index.css\";\n\ntype Props = {\n  [key: string]: any\n}\n\nconst MobileLayout: React.FC<Props> = (props) =>  {\n  const children = props.hasOwnProperty(\"children\")\n    ? Array.isArray(props.children)\n      ? props.children\n      : [props.children]\n    : [];\n\n  const upper_self_props: any = {};\n  Object.keys(props).forEach((propName) => {\n    if (propName !== \"children\") {\n      upper_self_props[propName] = props[propName];\n    }\n  });\n\n  const self_props = {\n    style: {\n      display: \"flex\",\n      height: \"100%\",\n      width: \"100%\",\n      flexDirection: \"column\",\n    } as CSS.Properties,\n  };\n\n  deepMixIn(upper_self_props, self_props);\n\n  return (<div {...self_props}>{children}</div>);\n}\n\nexport default MobileLayout;\n","import { parseURL, assert } from \"./utils-ui\";\n\n\ntype URLObject = ReturnType<typeof parseURL>;\n\nexport type Navi = ReturnType<typeof createNavi>;\n\n// TODO: add init value so I don't always have to check for null!\n\n/**\n * Creates a `Nav` object.\n *\n * @returns {{ init: (url: string) => void, back: () => void, go: (offset: number) => void, forward: () => void, setURL: (url: string) => void, reload: () => void, url: string, urlObj: any, initialized: boolean, callback?: () => void }}\n */\nexport function createNavi(initialURL: string) {\n\n  // Initialize\n  let current_url: string = initialURL;\n  let current_url_obj: URLObject = parseURL(initialURL);\n  const history: URLObject[] = [current_url_obj];\n  let history_index = 0;\n\n  /**\n   *\n   * @param {number} offset\n   * @throws\n   */\n  function go(offset: number) {\n    const effective_index = history_index + offset;\n    assert(effective_index >= 0 && effective_index < history.length);\n    history_index = effective_index;\n    _update();\n  }\n\n  /**\n   *\n   */\n  function back() {\n    go(-1);\n  }\n\n  /**\n   *\n   */\n  function forward() {\n    go(1);\n  }\n\n  /**\n   *\n   */\n  function reload() {\n    go(0);\n  }\n\n  /**\n   *\n   * @param {string} url\n   *\n   * @throws\n   */\n  function setURL(url: string, pop = 0) {\n    const url_obj = parseURL(url);\n\n    history_index = history_index - pop;\n\n    // Pop of history\n    while (history.length - 1 > history_index) {\n      history.pop();\n    }\n    history.push(url_obj);\n    history_index++;\n    _update();\n  }\n\n  /**\n   *\n   */\n  function _update() {\n    current_url_obj = history[history_index];\n    current_url = current_url_obj.url;\n\n    return_object.url = current_url;\n    return_object.urlObj = current_url_obj;\n    if (typeof return_object.callback === \"function\") {\n      return_object.callback();\n    }\n  }\n\n  type ReturnObject = {\n    back: typeof back,\n    go: typeof go,\n    forward: typeof forward,\n    setURL: typeof setURL,\n    reload: typeof reload,\n    url: string,\n    urlObj: URLObject,\n    callback: null | (() => void),\n  };\n\n  const return_object: ReturnObject = {\n    back,\n    go,\n    forward,\n    setURL,\n    reload,\n    url: current_url,\n    urlObj: current_url_obj,\n    callback: null,\n  };\n\n  return return_object;\n}\n","/*\n * \tObservable Slim\n *\tVersion 0.1.5\n * \thttps://github.com/elliotnb/observable-slim\n *\n * \tLicensed under the MIT license:\n * \thttp://www.opensource.org/licenses/MIT\n *\n *\tObservable Slim is a singleton that allows you to observe changes made to an object and any nested\n *\tchildren of that object. It is intended to assist with one-way data binding, that is, in MVC parlance,\n *\treflecting changes in the model to the view. Observable Slim aspires to be as lightweight and easily\n *\tunderstood as possible. Minifies down to roughly 3000 characters.\n */\n\n\n\nexport type TObserver = (changes: TChange[]) => void;\ntype TTarget = any;\ntype TProxy = any;\n\n\n\ntype TObservable = {\n  parentTarget: TTarget,\n  domDelay: boolean,\n  parentProxy: TProxy,\n  observers: TObserver[],\n  paused: boolean,\n  path: TPath,\n  changesPaused: boolean\n};\n\n\ntype TPathSegment = {\n  target: TTarget,\n  property: any, // don't know the type\n};\n\ntype TPath = TPathSegment[];\n\n\n\ntype TTypeDelete = {\n  type: \"delete\",\n  target: TTarget,\n  property: string | number | symbol,\n  newValue: null,\n  previousValue: any,\n  currentPath: string,\n  jsonPointer: string,\n  proxy: TProxy\n};\n\ntype TTypeUpdateOrAdd = {\n  type: \"update\" | \"add\", // \"update\", \"add\",\n  target: any,\n  property: string | number | symbol,\n  newValue: any,\n  previousValue: any,\n  currentPath: string,\n  jsonPointer: string,\n  proxy: TProxy\n}\n\n\ntype TChange = TTypeDelete | TTypeUpdateOrAdd;\n\n\ntype TProxyItem = {\n  target: any,\n  proxy: any,\n  observable: TObservable\n};\n\ntype TTargetsProxy = TProxyItem[][];\n\n\nconst ObservableSlim = (function () {\n  const paths: TPath[] = [];\n  // An array that stores all of the observables created through the public create() method below.\n  const observables: TObservable[] = [];\n  // An array of all the objects that we have assigned Proxies to\n  const targets: unknown[] = [];\n\n  // An array of arrays containing the Proxies created for each target object. targetsProxy is index-matched with\n  // 'targets' -- together, the pair offer a Hash table where the key is not a string nor number, but the actual target object\n  const targetsProxy: TTargetsProxy = [];\n\n  // this variable tracks duplicate proxies assigned to the same target.\n  // the 'set' handler below will trigger the same change on all other Proxies tracking the same target.\n  // however, in order to avoid an infinite loop of Proxies triggering and re-triggering one another, we use dupProxy\n  // to track that a given Proxy was modified from the 'set' handler\n  let dupProxy: unknown = null;\n\n  const _getProperty = function (obj: any, path: string) {\n    return path.split('.').reduce(function (prev, curr) {\n      return prev ? prev[curr] : undefined\n    }, obj /*|| self */)\n  };\n\n\t/*\tFunction: _create\n\t\t\t\tPrivate internal function that is invoked to create a new ES6 Proxy whose changes we can observe through\n\t\t\t\tthe Observerable.observe() method.\n\n\t\t\tParameters:\n\t\t\t\ttarget \t\t\t\t- required, plain JavaScript object that we want to observe for changes.\n\t\t\t\tdomDelay \t\t\t- batch up changes on a 10ms delay so a series of changes can be processed in one DOM update.\n\t\t\t\toriginalObservable \t- object, the original observable created by the user, exists for recursion purposes,\n\t\t\t\t\t\t\t\t\t  allows one observable to observe change on any nested/child objects.\n\t\t\t\toriginalPath \t\t- array of objects, each object having the properties 'target' and 'property' -- target referring to the observed object itself\n\t\t\t\t\t\t\t\t\t  and property referring to the name of that object in the nested structure. the path of the property in relation to the target \n\t\t\t\t\t\t\t\t\t  on the original observable, exists for recursion purposes, allows one observable to observe change on any nested/child objects. \n\n\t\t\tReturns:\n\t\t\t\tAn ES6 Proxy object.\n\t*/\n  const _create = function (target: TTarget, domDelay: boolean, originalObservable?: TObservable, originalPath?: TPath): TProxy {\n\n    let observable = originalObservable || null;\n\n    // record the nested path taken to access this object -- if there was no path then we provide the first empty entry\n    const path = originalPath || [{ \"target\": target, \"property\": \"\" }];\n    paths.push(path);\n\n    // in order to accurately report the \"previous value\" of the \"length\" property on an Array\n    // we must use a helper property because intercepting a length change is not always possible as of 8/13/2018 in \n    // Chrome -- the new `length` value is already set by the time the `set` handler is invoked\n    if (target instanceof Array) (target as any).__length = target.length;\n\n    let changes: TChange[] = [];\n\n\t\t/*\tFunction: _getPath\n\t\t\t\tReturns a string of the nested path (in relation to the top-level observed object)\n\t\t\t\tof the property being modified or deleted.\n\t\t\tParameters:\n\t\t\t\ttarget - the object whose property is being modified or deleted.\n\t\t\t\tproperty - the string name of the property\n\t\t\t\tjsonPointer - optional, set to true if the string path should be formatted as a JSON pointer.\n\n\t\t\tReturns:\n\t\t\t\tString of the nested path (e.g., hello.testing.1.bar or, if JSON pointer, /hello/testing/1/bar\n\t\t*/\n    const _getPath = function (target: any, property: string, jsonPointer?: boolean) {\n\n      let fullPath = \"\";\n      let lastTarget = null;\n\n      // loop over each item in the path and append it to full path\n      for (let i = 0; i < path.length; i++) {\n\n        // if the current object was a member of an array, it's possible that the array was at one point\n        // mutated and would cause the position of the current object in that array to change. we perform an indexOf\n        // lookup here to determine the current position of that object in the array before we add it to fullPath\n        if (lastTarget instanceof Array && !isNaN(path[i].property)) {\n          path[i].property = lastTarget.indexOf(path[i].target);\n        }\n\n        fullPath = fullPath + \".\" + path[i].property\n        lastTarget = path[i].target;\n      }\n\n      // add the current property\n      fullPath = fullPath + \".\" + property;\n\n      // remove the beginning two dots -- ..foo.bar becomes foo.bar (the first item in the nested chain doesn't have a property name)\n      fullPath = fullPath.substring(2);\n\n      if (jsonPointer === true) fullPath = \"/\" + fullPath.replace(/\\./g, \"/\");\n\n      return fullPath;\n    };\n\n    const _notifyObservers = function (numChanges: number) {\n\n      // if the observable is paused, then we don't want to execute any of the observer functions\n      if ((observable as TObservable).paused === true) return;\n\n      // execute observer functions on a 10ms settimeout, this prevents the observer functions from being executed\n      // separately on every change -- this is necessary because the observer functions will often trigger UI updates\n      if (domDelay === true) {\n        setTimeout(function () {\n          if (numChanges === changes.length) {\n\n            // we create a copy of changes before passing it to the observer functions because even if the observer function\n            // throws an error, we still need to ensure that changes is reset to an empty array so that old changes don't persist\n            const changesCopy = changes.slice(0);\n            changes = [];\n\n            // invoke any functions that are observing changes\n            for (let i = 0; i < (observable as TObservable).observers.length; i++) (observable as TObservable).observers[i](changesCopy);\n\n          }\n        }, 10);\n      } else {\n\n        // we create a copy of changes before passing it to the observer functions because even if the observer function\n        // throws an error, we still need to ensure that changes is reset to an empty array so that old changes don't persist\n        const changesCopy = changes.slice(0);\n        changes = [];\n\n        // invoke any functions that are observing changes\n        for (let i = 0; i < (observable as TObservable).observers.length; i++) (observable as TObservable).observers[i](changesCopy);\n\n      }\n    };\n\n    \n\n    const handler: ProxyHandler<any> = {\n      get: function (target, property) {\n\n        // implement a simple check for whether or not the object is a proxy, this helps the .create() method avoid\n        // creating Proxies of Proxies.\n        if (property === \"__getTarget\") {\n          return target;\n        } else if (property === \"__isProxy\") {\n          return true;\n          // from the perspective of a given observable on a parent object, return the parent object of the given nested object\n        } else if (property === \"__getParent\") {\n          return function (i?: number) {\n            if (typeof i === \"undefined\") i = 1;\n            const parentPath = _getPath(target, \"__getParent\").split(\".\");\n            parentPath.splice(-(i + 1), (i + 1));\n            return _getProperty((observable as TObservable).parentProxy, parentPath.join(\".\"));\n          }\n          // return the full path of the current object relative to the parent observable\n        } else if (property === \"__getPath\") {\n          // strip off the 12 characters for \".__getParent\"\n          const parentPath = _getPath(target, \"__getParent\");\n          return parentPath.slice(0, -12);\n        }\n\n        // for performance improvements, we assign this to a variable so we do not have to lookup the property value again\n        let targetProp = target[property];\n        if (target instanceof Date && targetProp instanceof Function && targetProp !== null) {\n          return targetProp.bind(target);\n        }\n\n        // if we are traversing into a new object, then we want to record path to that object and return a new observable.\n        // recursively returning a new observable allows us a single Observable.observe() to monitor all changes on\n        // the target object and any objects nested within.\n        if (targetProp instanceof Object && targetProp !== null && target.hasOwnProperty(property)) {\n\n          // if we've found a proxy nested on the object, then we want to retrieve the original object behind that proxy\n          if (targetProp.__isProxy === true) targetProp = targetProp.__getTarget;\n\n          // if the object accessed by the user (targetProp) already has a __targetPosition AND the object\n          // stored at target[targetProp.__targetPosition] is not null, then that means we are already observing this object\n          // we might be able to return a proxy that we've already created for the object\n          if (targetProp.__targetPosition > -1 && targets[targetProp.__targetPosition] !== null) {\n\n            // loop over the proxies that we've created for this object\n            const ttp = targetsProxy[targetProp.__targetPosition];\n            for (let i = 0, l = ttp.length; i < l; i++) {\n\n              // if we find a proxy that was setup for this particular observable, then return that proxy\n              if (observable === ttp[i].observable) {\n                return ttp[i].proxy;\n              }\n            }\n          }\n\n          // if we're arrived here, then that means there is no proxy for the object the user just accessed, so we\n          // have to create a new proxy for it\n\n          // create a shallow copy of the path array -- if we didn't create a shallow copy then all nested objects would share the same path array and the path wouldn't be accurate\n          const newPath = path.slice(0);\n          newPath.push({ \"target\": targetProp, \"property\": property });\n          return _create(targetProp, domDelay, (observable as TObservable), newPath);\n        } else {\n          return targetProp;\n        }\n      },\n      deleteProperty: function (target, property: string) {\n\n        // was this change an original change or was it a change that was re-triggered below\n        let originalChange = true;\n        if (dupProxy === proxy) {\n          originalChange = false;\n          dupProxy = null;\n        }\n\n        // in order to report what the previous value was, we must make a copy of it before it is deleted\n        const previousValue = Object.assign({}, target);\n\n\n        // record the deletion that just took place\n        changes.push({\n          \"type\": \"delete\"\n          , \"target\": target\n          , \"property\": property\n          , \"newValue\": null\n          , \"previousValue\": previousValue[property]\n          , \"currentPath\": _getPath(target, property)\n          , \"jsonPointer\": _getPath(target, property, true)\n          , \"proxy\": proxy\n        });\n\n        if (originalChange === true) {\n\n          // perform the delete that we've trapped if changes are not paused for this observable\n          if (!(observable as TObservable).changesPaused) delete target[property];\n\n          let a = 0;\n          for (let l = targets.length; a < l; a++) if (target === targets[a]) break;\n\n          // loop over each proxy and see if the target for this change has any other proxies\n          const currentTargetProxy = targetsProxy[a] || [];\n\n          let b = currentTargetProxy.length;\n          while (b--) {\n            // if the same target has a different proxy\n            if (currentTargetProxy[b].proxy !== proxy) {\n              // !!IMPORTANT!! store the proxy as a duplicate proxy (dupProxy) -- this will adjust the behavior above appropriately (that is,\n              // prevent a change on dupProxy from re-triggering the same change on other proxies)\n              dupProxy = currentTargetProxy[b].proxy;\n\n              // make the same delete on the different proxy for the same target object. it is important that we make this change *after* we invoke the same change\n              // on any other proxies so that the previousValue can show up correct for the other proxies\n              delete currentTargetProxy[b].proxy[property];\n            }\n          }\n\n        }\n\n        _notifyObservers(changes.length);\n\n        return true;\n\n      },\n      set: function (target, property: string, value, receiver) {\n\n        // if the value we're assigning is an object, then we want to ensure\n        // that we're assigning the original object, not the proxy, in order to avoid mixing\n        // the actual targets and proxies -- creates issues with path logging if we don't do this\n        if (value && value.__isProxy) value = value.__getTarget;\n\n        // was this change an original change or was it a change that was re-triggered below\n        let originalChange = true;\n        if (dupProxy === proxy) {\n          originalChange = false;\n          dupProxy = null;\n        }\n\n        // improve performance by saving direct references to the property\n        const targetProp = target[property];\n\n        // Only record this change if:\n        // \t1. the new value differs from the old one \n        //\t2. OR if this proxy was not the original proxy to receive the change\n        // \t3. OR the modified target is an array and the modified property is \"length\" and our helper property __length indicates that the array length has changed\n        //\n        // Regarding #3 above: mutations of arrays via .push or .splice actually modify the .length before the set handler is invoked\n        // so in order to accurately report the correct previousValue for the .length, we have to use a helper property.\n        if (targetProp !== value || originalChange === false || (property === \"length\" && target instanceof Array && (target as any).__length !== value)) {\n\n          let foundObservable = true;\n\n          const typeOfTargetProp = (typeof targetProp);\n\n          // determine if we're adding something new or modifying somethat that already existed\n          let type: \"update\" | \"add\" = \"update\";\n          if (typeOfTargetProp === \"undefined\") type = \"add\";\n\n\n          // store the change that just occurred. it is important that we store the change before invoking the other proxies so that the previousValue is correct\n          changes.push({\n            \"type\": type\n            , \"target\": target\n            , \"property\": property\n            , \"newValue\": value\n            , \"previousValue\": receiver[property]\n            , \"currentPath\": _getPath(target, property)\n            , \"jsonPointer\": _getPath(target, property, true)\n            , \"proxy\": proxy\n          });\n\n          // mutations of arrays via .push or .splice actually modify the .length before the set handler is invoked\n          // so in order to accurately report the correct previousValue for the .length, we have to use a helper property.\n          if (property === \"length\" && target instanceof Array && (target as any).__length !== value) {\n            changes[changes.length - 1].previousValue = (target as any).__length;\n            (target as any).__length = value;\n          }\n\n          // !!IMPORTANT!! if this proxy was the first proxy to receive the change, then we need to go check and see\n          // if there are other proxies for the same project. if there are, then we will modify those proxies as well so the other\n          // observers can be modified of the change that has occurred.\n          if (originalChange === true) {\n\n            // because the value actually differs than the previous value\n            // we need to store the new value on the original target object,\n            // but only as long as changes have not been paused\n            if (!(observable as TObservable).changesPaused) target[property] = value;\n\n\n            foundObservable = false;\n\n            const targetPosition = target.__targetPosition;\n            let z = targetsProxy[targetPosition].length;\n\n            // find the parent target for this observable -- if the target for that observable has not been removed\n            // from the targets array, then that means the observable is still active and we should notify the observers of this change\n            while (z--) {\n              if (observable === targetsProxy[targetPosition][z].observable) {\n                if (targets[targetsProxy[targetPosition][z].observable.parentTarget.__targetPosition] !== null) {\n                  foundObservable = true;\n                  break;\n                }\n              }\n            }\n\n            // if we didn't find an observable for this proxy, then that means .remove(proxy) was likely invoked\n            // so we no longer need to notify any observer function about the changes, but we still need to update the\n            // value of the underlying original objectm see below: target[property] = value;\n            if (foundObservable) {\n\n              // loop over each proxy and see if the target for this change has any other proxies\n              const currentTargetProxy = targetsProxy[targetPosition];\n              for (let b = 0, l = currentTargetProxy.length; b < l; b++) {\n                // if the same target has a different proxy\n                if (currentTargetProxy[b].proxy !== proxy) {\n\n                  // !!IMPORTANT!! store the proxy as a duplicate proxy (dupProxy) -- this will adjust the behavior above appropriately (that is,\n                  // prevent a change on dupProxy from re-triggering the same change on other proxies)\n                  dupProxy = currentTargetProxy[b].proxy;\n\n                  // invoke the same change on the different proxy for the same target object. it is important that we make this change *after* we invoke the same change\n                  // on any other proxies so that the previousValue can show up correct for the other proxies\n                  currentTargetProxy[b].proxy[property] = value;\n\n                }\n              }\n\n              // if the property being overwritten is an object, then that means this observable\n              // will need to stop monitoring this object and any nested objects underneath the overwritten object else they'll become\n              // orphaned and grow memory usage. we excute this on a setTimeout so that the clean-up process does not block\n              // the UI rendering -- there's no need to execute the clean up immediately\n              setTimeout(function () {\n\n                if (typeOfTargetProp === \"object\" && targetProp !== null) {\n\n                  // check if the to-be-overwritten target property still exists on the target object\n                  // if it does still exist on the object, then we don't want to stop observing it. this resolves\n                  // an issue where array .sort() triggers objects to be overwritten, but instead of being overwritten\n                  // and discarded, they are shuffled to a new position in the array\n                  const keys = Object.keys(target);\n                  for (let i = 0, l = keys.length; i < l; i++) {\n                    if (target[keys[i]] === targetProp) return;\n                  }\n\n                  let stillExists = false;\n\n                  // now we perform the more expensive search recursively through the target object.\n                  // if we find the targetProp (that was just overwritten) still exists somewhere else\n                  // further down in the object, then we still need to observe the targetProp on this observable.\n                  (function iterate(target) {\n                    const keys = Object.keys(target);\n                    for (let i = 0, l = keys.length; i < l; i++) {\n\n                      const property = keys[i];\n                      const nestedTarget = target[property];\n\n                      if (nestedTarget instanceof Object && nestedTarget !== null) iterate(nestedTarget);\n                      if (nestedTarget === targetProp) {\n                        stillExists = true;\n                        return;\n                      }\n                    };\n                  })(target);\n\n                  // even though targetProp was overwritten, if it still exists somewhere else on the object,\n                  // then we don't want to remove the observable for that object (targetProp)\n                  if (stillExists === true) return;\n\n                  // loop over each property and recursively invoke the `iterate` function for any\n                  // objects nested on targetProp\n                  (function iterate(obj) {\n\n                    const keys = Object.keys(obj);\n                    for (let i = 0, l = keys.length; i < l; i++) {\n                      const objProp = obj[keys[i]];\n                      if (objProp instanceof Object && objProp !== null) iterate(objProp);\n                    }\n\n                    // if there are any existing target objects (objects that we're already observing)...\n                    let c = -1;\n                    for (let i = 0, l = targets.length; i < l; i++) {\n                      if (obj === targets[i]) {\n                        c = i;\n                        break;\n                      }\n                    }\n                    if (c > -1) {\n\n                      // ...then we want to determine if the observables for that object match our current observable\n                      const currentTargetProxy = targetsProxy[c];\n                      let d = currentTargetProxy.length;\n\n                      while (d--) {\n                        // if we do have an observable monitoring the object thats about to be overwritten\n                        // then we can remove that observable from the target object\n                        if (observable === currentTargetProxy[d].observable) {\n                          currentTargetProxy.splice(d, 1);\n                          break;\n                        }\n                      }\n\n                      // if there are no more observables assigned to the target object, then we can remove\n                      // the target object altogether. this is necessary to prevent growing memory consumption particularly with large data sets\n                      if (currentTargetProxy.length == 0) { // eslint-disable-line eqeqeq\n                        // targetsProxy.splice(c,1);\n                        targets[c] = null;\n                      }\n                    }\n\n                  })(targetProp)\n                }\n              }, 10000);\n            }\n\n            // TO DO: the next block of code resolves test case #29, but it results in poor IE11 performance with very large objects.\n            // UPDATE: need to re-evaluate IE11 performance due to major performance overhaul from 12/23/2018.\n            // \n            // if the value we've just set is an object, then we'll need to iterate over it in order to initialize the\n            // observers/proxies on all nested children of the object\n\t\t\t\t\t\t/* if (value instanceof Object && value !== null) {\n\t\t\t\t\t\t\t(function iterate(proxy) {\n\t\t\t\t\t\t\t\tconst target = proxy.__getTarget;\n\t\t\t\t\t\t\t\tconst keys = Object.keys(target);\n\t\t\t\t\t\t\t\tfor (let i = 0, l = keys.length; i < l; i++) {\n\t\t\t\t\t\t\t\t\tconst property = keys[i];\n\t\t\t\t\t\t\t\t\tif (target[property] instanceof Object && target[property] !== null) iterate(proxy[property]);\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t})(proxy[property]);\n\t\t\t\t\t\t}; */\n\n          };\n\n          if (foundObservable) {\n            // notify the observer functions that the target has been modified\n            _notifyObservers(changes.length);\n          }\n\n        }\n        return true;\n      }\n    }\n\n    const __targetPosition = target.__targetPosition;\n    if (!(__targetPosition > -1)) {\n      Object.defineProperty(target, \"__targetPosition\", {\n        value: targets.length\n        , writable: false\n        , enumerable: false\n        , configurable: false\n      });\n    }\n\n    // create the proxy that we'll use to observe any changes\n    const proxy = new Proxy(target, handler);\n\n    // we don't want to create a new observable if this function was invoked recursively\n    if (observable === null) {\n      observable = { \"parentTarget\": target, \"domDelay\": domDelay, \"parentProxy\": proxy, \"observers\": [], \"paused\": false, \"path\": path, \"changesPaused\": false };\n      observables.push(observable);\n    }\n\n    // store the proxy we've created so it isn't re-created unnecessairly via get handler\n    const proxyItem = { \"target\": target, \"proxy\": proxy, \"observable\": observable };\n\n    // if we have already created a Proxy for this target object then we add it to the corresponding array\n    // on targetsProxy (targets and targetsProxy work together as a Hash table indexed by the actual target object).\n    if (__targetPosition > -1) {\n\n      // the targets array is set to null for the position of this particular object, then we know that\n      // the observable was removed some point in time for this object -- so we need to set the reference again\n      if (targets[__targetPosition] === null) {\n        targets[__targetPosition] = target;\n      }\n\n      \n      \n\n      targetsProxy[__targetPosition].push(proxyItem);\n\n      // else this is a target object that we had not yet created a Proxy for, so we must add it to targets,\n      // and push a new array on to targetsProxy containing the new Proxy\n    } else {\n      targets.push(target);\n      targetsProxy.push([proxyItem]);\n    }\n\n    return proxy;\n  };\n\n  return {\n\t\t/*\tMethod:\n\t\t\t\tPublic method that is invoked to create a new ES6 Proxy whose changes we can observe\n\t\t\t\tthrough the Observerable.observe() method.\n\n\t\t\tParameters\n\t\t\t\ttarget - Object, required, plain JavaScript object that we want to observe for changes.\n\t\t\t\tdomDelay - Boolean, required, if true, then batch up changes on a 10ms delay so a series of changes can be processed in one DOM update.\n\t\t\t\tobserver - Function, optional, will be invoked when a change is made to the proxy.\n\n\t\t\tReturns:\n\t\t\t\tAn ES6 Proxy object.\n\t\t*/\n    create: function (target: TTarget, domDelay: boolean, observer?: TObserver) {\n      \n\n      // test if the target is a Proxy, if it is then we need to retrieve the original object behind the Proxy.\n      // we do not allow creating proxies of proxies because -- given the recursive design of ObservableSlim -- it would lead to sharp increases in memory usage\n      if (target.__isProxy === true) {\n        target = target.__getTarget;\n        //if it is, then we should throw an error. we do not allow creating proxies of proxies\n        // because -- given the recursive design of ObservableSlim -- it would lead to sharp increases in memory usage\n        //throw new Error(\"ObservableSlim.create() cannot create a Proxy for a target object that is also a Proxy.\");\n      }\n\n      // fire off the _create() method -- it will create a new observable and proxy and return the proxy\n      const proxy = _create(target, domDelay);\n\n      // assign the observer function\n      if (typeof observer === \"function\") this.observe(proxy, observer);\n\n      // recursively loop over all nested objects on the proxy we've just created\n      // this will allow the top observable to observe any changes that occur on a nested object\n      (function iterate(proxy) {\n        const target = proxy.__getTarget;\n        const keys = Object.keys(target);\n        for (let i = 0, l = keys.length; i < l; i++) {\n          const property = keys[i];\n          if (target[property] instanceof Object && target[property] !== null) iterate(proxy[property]);\n        }\n      })(proxy);\n\n      return proxy;\n\n    },\n\n\t\t/*\tMethod: observe\n\t\t\t\tThis method is used to add a new observer function to an existing proxy.\n\n\t\t\tParameters:\n\t\t\t\tproxy \t- the ES6 Proxy returned by the create() method. We want to observe changes made to this object.\n\t\t\t\tobserver \t- this function will be invoked when a change is made to the observable (not to be confused with the\n\t\t\t\t\t\t\t  observer defined in the create() method).\n\n\t\t\tReturns:\n\t\t\t\tNothing.\n\t\t*/\n    observe: function (proxy: TProxy, observer: TObserver) {\n      // loop over all the observables created by the _create() function\n      let i = observables.length;\n      while (i--) {\n        if (observables[i].parentProxy === proxy) {\n          observables[i].observers.push(observer);\n          break;\n        }\n      };\n    },\n\n\t\t/*\tMethod: pause\n\t\t\t\tThis method will prevent any observer functions from being invoked when a change occurs to a proxy.\n\n\t\t\tParameters:\n\t\t\t\tproxy \t- the ES6 Proxy returned by the create() method.\n\t\t*/\n    pause: function (proxy: TProxy) {\n      let i = observables.length;\n      let foundMatch = false;\n      while (i--) {\n        if (observables[i].parentProxy === proxy) {\n          observables[i].paused = true;\n          foundMatch = true;\n          break;\n        }\n      };\n\n      if (foundMatch == false) throw new Error(\"ObseravableSlim could not pause observable -- matching proxy not found.\"); // eslint-disable-line eqeqeq\n    },\n\n\t\t/*\tMethod: resume\n\t\t\t\tThis method will resume execution of any observer functions when a change is made to a proxy.\n\n\t\t\tParameters:\n\t\t\t\tproxy \t- the ES6 Proxy returned by the create() method.\n\t\t*/\n    resume: function (proxy: TProxy) {\n      let i = observables.length;\n      let foundMatch = false;\n      while (i--) {\n        if (observables[i].parentProxy === proxy) {\n          observables[i].paused = false;\n          foundMatch = true;\n          break;\n        }\n      };\n\n      if (foundMatch == false) throw new Error(\"ObseravableSlim could not resume observable -- matching proxy not found.\"); // eslint-disable-line eqeqeq\n    },\n\n\t\t/*\tMethod: pauseChanges\n\t\t\t\tThis method will prevent any changes (i.e., set, and deleteProperty) from being written to the target\n\t\t\t\tobject.  However, the observer functions will still be invoked to let you know what changes WOULD have\n\t\t\t\tbeen made.  This can be useful if the changes need to be approved by an external source before the\n\t\t\t\tchanges take effect.\n\n\t\t\tParameters:\n\t\t\t\tproxy\t- the ES6 Proxy returned by the create() method.\n\t\t */\n    pauseChanges: function (proxy: TProxy) {\n      let i = observables.length;\n      let foundMatch = false;\n      while (i--) {\n        if (observables[i].parentProxy === proxy) {\n          observables[i].changesPaused = true;\n          foundMatch = true;\n          break;\n        }\n      };\n\n      if (foundMatch == false) throw new Error(\"ObseravableSlim could not pause changes on observable -- matching proxy not found.\"); // eslint-disable-line eqeqeq\n    },\n\n\t\t/*\tMethod: resumeChanges\n\t\t\t\tThis method will resume the changes that were taking place prior to the call to pauseChanges().\n\n\t\t\tParameters:\n\t\t\t\tproxy\t- the ES6 Proxy returned by the create() method.\n\t\t */\n    resumeChanges: function (proxy: TProxy) {\n      let i = observables.length;\n      let foundMatch = false;\n      while (i--) {\n        if (observables[i].parentProxy === proxy) {\n          observables[i].changesPaused = false;\n          foundMatch = true;\n          break;\n        }\n      };\n\n      if (foundMatch == false) throw new Error(\"ObseravableSlim could not resume changes on observable -- matching proxy not found.\"); // eslint-disable-line eqeqeq\n    },\n\n\t\t/*\tMethod: remove\n\t\t\t\tThis method will remove the observable and proxy thereby preventing any further callback observers for\n\t\t\t\tchanges occuring to the target object.\n\n\t\t\tParameters:\n\t\t\t\tproxy \t- the ES6 Proxy returned by the create() method.\n\t\t*/\n    remove: function (proxy: TProxy) {\n\n      let matchedObservable = null;\n      let foundMatch = false;\n\n      let c = observables.length;\n      while (c--) {\n        if (observables[c].parentProxy === proxy) {\n          matchedObservable = observables[c];\n          foundMatch = true;\n          break;\n        }\n      };\n\n      let a = targetsProxy.length;\n      while (a--) {\n        let b = targetsProxy[a].length;\n        while (b--) {\n          if (targetsProxy[a][b].observable === matchedObservable) {\n            targetsProxy[a].splice(b, 1);\n\n            // if there are no more proxies for this target object\n            // then we null out the position for this object on the targets array\n            // since we are essentially no longer observing this object.\n            // we do not splice it off the targets array, because if we re-observe the same \n            // object at a later time, the property __targetPosition cannot be redefined.\n            if (targetsProxy[a].length === 0) {\n              targets[a] = null;\n            };\n          }\n        };\n      };\n\n      if (foundMatch === true) {\n        observables.splice(c, 1);\n      }\n    }\n  };\n})();\n\nexport { ObservableSlim };\n","/*\nStorka\n*/\n\nimport { ObservableSlim, TObserver } from \"./observable-slim\";\n\n\n// NOTE: when automatic synchronization kicks in, make sure not to throw away\n// partial transactions.  That is _only_ OK when starting Storka for the first\n// time.\n\n////////////////////////////////////////////////////////////////////////////////\n// Helper functions\n\n/**\n * Asserts the condition `condition`.  If the value is not boolean then it is\n * cast to a boolean value.  If the condition evaluates to a falsy value then\n * an exception is raised.  An optional message `message` is displayed and\n * other optional things `...other` printed to the error console.\n * \n * // TODO: in future version ...): asserts condition { ...\n * can be added.\n *\n * @param {any} condition\n * @param {string=} message\n * @param {any=} other\n *\n * @throws Will throw an error if `condition` is falsy.\n */\nexport function assert(\n  condition: any,\n  message = \"Assertion failed\",\n  ...other: any[]\n): asserts condition {\n  if (!condition) {\n    if (typeof message !== \"string\") {\n      console.error(JSON.parse(JSON.stringify(message)));\n      throw new Error(\"Assertion failed\");\n    } else {\n      if (other.length > 0) {\n        console.error(JSON.parse(JSON.stringify(other)));\n      }\n    }\n    throw new Error(message);\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Storka events\n\nexport type StorkaEventAfterAddChange = { type: \"afteraddchange\", change: ChangeItem, object: any };\nexport type StorkaEventBeforeAddChange = { type: \"beforeaddchange\", change: ChangeItem, object: any };\nexport type StorkaEventSyncing = { type: \"syncing\" };\nexport type StorkaEventSynced = { type: \"synced\" };\nexport type StorkaEventReady = { type: \"ready\" };\nexport type StorkaEventChange = { type: \"change\", change: ChangeItem, object: any };\n\n/** To do something before a change is added. */\nexport type StorkaEventBeforeChange = { type: \"beforechange\", change: ChangeItem, object: any };\n\n/** To do something after a change is added. */\nexport type StorkaEventAfterChange = { type: \"afterchange\", change: ChangeItem, object: any };\n\nexport type StorkaEvent = StorkaEventSyncing | StorkaEventSynced | StorkaEventReady | StorkaEventChange | StorkaEventBeforeChange | StorkaEventAfterChange | StorkaEventBeforeAddChange | StorkaEventAfterAddChange;\n\n////////////////////////////////////////////////////////////////////////////////\n// Storka event types\n\ntype StorkaEventType = \"syncing\" | \"synced\" | \"ready\" | \"change\" | \"beforechange\" | \"afterchange\" | \"beforeaddchange\" | \"afteraddchange\";\n\n////////////////////////////////////////////////////////////////////////////////\n// Storka event listeners\n\ntype StorkaEventListener = (ev: StorkaEvent) => void;\n\ninterface StorkaListeners {\n  afterchange: Set<StorkaEventListener>,\n  beforechange: Set<StorkaEventListener>,\n  change: Set<StorkaEventListener>,\n  ready: Set<StorkaEventListener>,\n  synced: Set<StorkaEventListener>,\n  syncing: Set<StorkaEventListener>,\n  beforeaddchange: Set<StorkaEventListener>,\n  afteraddchange: Set<StorkaEventListener>,\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Various Storka types\n\ninterface StorkaReturnObject {\n  object: any;\n  proxy: any;\n  addEventListener: (type: StorkaEventType, listener: StorkaEventListener) => void;\n  removeEventListener: (type: StorkaEventType, listener: StorkaEventListener) => void;\n  ready: boolean;\n  beginTransaction: () => void,\n  endTransaction: () => void,\n}\n\ntype ChangeItem = { type: \"set\", jsonPointer: string, value: any } | { type: \"delete\", jsonPointer: string } | { type: \"begin-transaction\", id: string } | { type: \"end-transaction\", id: string };\n\n\n////////////////////////////////////////////////////////////////////////////////\n// Scheduler types\n\ntype TJobHandlerCallback = (result: { ok: true } | { ok: false, reason: string }) => void;\ntype TJobHandler = (callback: TJobHandlerCallback) => void;\n\n////////////////////////////////////////////////////////////////////////////////\n\n\n/**\n * Creates a \"scheduler\"\n */\nfunction createScheduler() {\n\n  const jobTypes = new Set<string>();\n\n  // NOTE: not optimal\n  const jobQueue: string[] = [];\n\n  const jobHandlers = new Map<string, TJobHandler>();\n\n  let working = false;\n\n  function addJobType(jobType: string) {\n    assert(!jobTypes.has(jobType));\n    jobTypes.add(jobType);\n  }\n\n  function setJobHandler(jobType: string, handler: TJobHandler) {\n    assert(!jobHandlers.has(jobType));\n    jobHandlers.set(jobType, handler);\n  }\n\n  function removeJobHandler(jobType: string) {\n    throw new Error(\"Not implemented\")\n  }\n\n  function scheduleJob(jobType: string) {\n    assert(jobTypes.has(jobType));\n\n    if (!jobQueue.includes(jobType)) jobQueue.push(jobType);\n\n    if (!working) {\n      working = true;\n      dispatch();\n    }\n  }\n\n  const handleJobHandlerCallback: TJobHandlerCallback = (result) => {\n    if (result.ok) {\n      assert(working, \"Don't konw what is going on...\");\n      dispatch();\n    } else {\n      throw new Error(result.reason);\n    }\n  };\n\n  function dispatch() {\n    if (jobQueue.length === 0) {\n      // Done\n      working = false;\n      return;\n    }\n\n    const jobType = jobQueue.shift() as string;\n\n    assert(jobHandlers.has(jobType));\n\n    const jobHandler = jobHandlers.get(jobType) as TJobHandler;\n\n    jobHandler(handleJobHandlerCallback);\n  }\n\n  return {\n    addJobType,\n    setJobHandler,\n    scheduleJob,\n    removeJobHandler,\n  };\n}\n\n\n/**\n * Creates a Storka object using IndexeDB database `database_name`.\n * \n * @param database_name \n * @param config \n */\nexport function createStorka(database_name: string, config: { transactional: boolean }) {\n\n  if (!window.indexedDB)\n    throw new Error(\"Unable to use application since your browser does not support a stable version of IndexedDB.\");\n\n  let object: any = {}; // The object (state) we're going to proxy.\n  let proxy: any = {};  // The proxy for the object (state).\n\n  let { transactional = false } = config;\n\n  const scheduler = createScheduler();\n  scheduler.addJobType(\"applychanges\");\n  scheduler.addJobType(\"addchanges\");\n\n  const listeners: StorkaListeners = {\n    afterchange: new Set<StorkaEventListener>(),\n    beforechange: new Set<StorkaEventListener>(),\n    change: new Set<StorkaEventListener>(),\n    synced: new Set<StorkaEventListener>(),\n    syncing: new Set<StorkaEventListener>(),\n    ready: new Set<StorkaEventListener>(),\n    beforeaddchange: new Set<StorkaEventListener>(),\n    afteraddchange: new Set<StorkaEventListener>(),\n  };\n\n  let is_ready = false; // Becomes `true` when it's OK to use.\n\n  let pending_changes: ChangeItem[] = [];\n\n  // Accumulation of data\n  let accumulatedLocalChange = 0;\n  let accumulatedDbChange = 0;\n\n  const ACCUMULATED_CHANGE_LIMIT = 20 * 1024 * 1024; // 20 MB\n\n  //////////////////////////////////////////////////////////////////////////////\n  // Various\n\n  /**\n   * Extract path elements from JSON pointer `jsonPointer`.\n   * \n   * @param {string} jsonPointer \n   */\n  function getPathFromJsonPointer(jsonPointer: string) {\n    return jsonPointer.split(\"/\").filter(x => x.length > 0);\n  }\n\n  /**\n   * Applies the change `change` to object `object`.\n   * \n   * @param change \n   * @param object \n   * \n   * @throws\n   */\n  function applyChangeToObject(change: ChangeItem, object: any) {\n    assert(change.type === \"set\" || change.type === \"delete\");\n\n    const path = getPathFromJsonPointer(change.jsonPointer);\n\n    assert(path.length > 0);\n\n    let node = object;\n\n    for (let i = 0; i < path.length - 1; i++) node = node[path[i]];\n\n    const last_crumb = path[path.length - 1];\n\n    if (change.type === \"set\") node[last_crumb] = change.value;\n    else if (change.type === \"delete\") delete node[last_crumb];\n    else throw new Error();\n  }\n\n\n  //////////////////////////////////////////////////////////////////////////////\n  // Database stuff\n\n  /**\n   * Initialize IndexedDB database.  This function executed every time when\n   * setting up Storka.\n   * \n   * Returns `true` if this is the first time this function is called,\n   * i.e. the database is being created, otherwise `false`.\n   */\n  function dbInit(): Promise<boolean> {\n    return new Promise((resolve, reject) => {\n      let upgrading = false;\n\n      // TODO: the code here is a total brittle mess!!!\n\n      // Going to wait `timeout` milliseconds, in case `upgradeneeded` event is\n      // is fired after `success` event is fired.\n      const potential_onupgradeneeded_timeout = 50;\n\n      const onupgradedneeded_done_timeout = 20;\n\n      const req = window.indexedDB.open(database_name);\n      req.onblocked = (e) => reject(`Blocked when opening database ${database_name}.  It's maybe in use.`);\n      // NOTE: (2020-02-27 15:04) IndexedDB does not work in private browsing\n      // mode in Firefox.\n      req.onerror = (e) => reject(`Error when opening database ${database_name}`);\n      req.onupgradeneeded = (e) => {\n        upgrading = true;\n\n        const db = req.result;\n\n        // req.transaction\n\n        // TODO: the code here below is super brittle\n        db.createObjectStore(\"object\", {});\n        db.createObjectStore(\"changes\", { keyPath: \"key\", autoIncrement: true });\n\n        setTimeout(() => {\n          resolve(true);\n        }, onupgradedneeded_done_timeout);\n      };\n\n      req.onsuccess = (e) => {\n        // TODO: potentially brittle\n        setTimeout(() => {\n          if (!upgrading) {\n            const db = req.result;\n            db.close();\n            resolve(false);\n          }\n        }, potential_onupgradeneeded_timeout);\n      };\n    });\n  }\n\n  /**\n   * The first time this application is executed an object store is created for\n   * the object and the change list.  After creating a an object, this function\n   * is executed to initialize the object in the object store.  The initial\n   * value is `{}`.\n   */\n  function dbInitObject(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const req = window.indexedDB.open(database_name);\n      req.onblocked = (e) => reject();\n      req.onerror = (e) => reject();\n      req.onupgradeneeded = (e) => reject();\n      req.onsuccess = (e) => {\n        const db = req.result;\n\n        const transaction = db.transaction([\"object\"], \"readwrite\");\n        transaction.oncomplete = (e) => { resolve(); };\n        transaction.onerror = (e) => { reject(); };\n\n        const store = transaction.objectStore(\"object\");\n\n        const store_req = store.put({}, 0);\n        store_req.onerror = (e) => {\n          reject();\n        };\n      };\n    });\n  }\n\n  /**\n   * Adds a list of changes to apply to the object to the object store\n   * `changes`.\n   * \n   * @param items \n   */\n  function dbAddChanges(items: ChangeItem[]) {\n    return new Promise((resolve, reject) => {\n      const req = window.indexedDB.open(database_name);\n      req.onblocked = (e) => { reject(); };\n      req.onerror = (e) => { reject(); };\n      req.onupgradeneeded = (e) => { reject(); };\n      req.onsuccess = (e) => {\n        const db = req.result;\n\n        const transaction = db.transaction([\"changes\"], \"readwrite\");\n        transaction.oncomplete = (e) => { resolve(); };\n        transaction.onerror = (e) => { reject(); };\n\n        const store = transaction.objectStore(\"changes\");\n\n        items.forEach(function (item) {\n          const store_req = store.add(item);\n          store_req.onsuccess = (e) => { };\n          store_req.onerror = (e) => { reject(); };\n        });\n      };\n    });\n  }\n\n  /**\n   * Retrieves all changes from object store `changes`.\n   */\n  function dbGetChanges(): Promise<ChangeItem[]> {\n    return new Promise((resolve, reject) => {\n      let changes: any;\n\n      // Retrieveing changes\n      const req = window.indexedDB.open(database_name);\n      req.onblocked = (e) => { reject(); };\n      req.onerror = (e) => { reject(); };\n      req.onupgradeneeded = (e) => { reject(); };\n      req.onsuccess = (e) => {\n        const db = req.result;\n\n        const transaction = db.transaction([\"changes\"], \"readonly\");\n        transaction.oncomplete = (e) => { resolve(changes); };\n        transaction.onerror = (e) => { reject(); };\n\n        const store = transaction.objectStore(\"changes\");\n\n        const store_req = store.getAll();\n        store_req.onerror = (e) => { };\n        store_req.onsuccess = (e) => {\n          // @ts-ignore\n          const result = e.target.result;\n          changes = result;\n        };\n      };\n    });\n  }\n\n  /**\n   * Removes all changes from changes object store.\n   */\n  function dbRemoveAllChanges(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      // Retrieveing changes\n      const req = window.indexedDB.open(database_name);\n      req.onblocked = (e) => { reject(); };\n      req.onerror = (e) => { reject(); };\n      req.onupgradeneeded = (e) => { reject(); };\n      req.onsuccess = (e) => {\n        const db = req.result;\n\n        const transaction = db.transaction([\"changes\"], \"readwrite\");\n        transaction.oncomplete = (e) => { resolve(); };\n        transaction.onerror = (e) => { reject(); };\n\n        const store = transaction.objectStore(\"changes\");\n\n        const store_req = store.clear();\n        store_req.onerror = (e) => { reject(); };\n        store_req.onsuccess = (e) => { };\n      };\n    });\n  }\n\n  /**\n   * Retrieves the changes from the changes object store and the object from\n   * the object object store, and applies the changes to the object, removes\n   * the changes from the changes object store, and sets the update object to\n   * the object object store.\n   * \n   * TODO: it should work in a different manner when this is run the first time\n   * and other times.\n   */\n  async function dbApplyChanges(): Promise<void> {\n    const values: [ChangeItem[], any] = await Promise.all([\n      dbGetChanges(),\n      dbGetObject(),\n    ]);\n\n    const [changes, object] = values;\n\n    if (changes.length > 0) {\n      if (transactional) {\n        const transactions: ChangeItem[][] = [];\n        let transaction: ChangeItem[] = [];\n\n        let inTransaction = false;\n        let transactionID = null;\n\n        for (let i = 0; i < changes.length; i++) {\n          const change = changes[i];\n\n          if (inTransaction) {\n            assert(change.type !== \"begin-transaction\");\n\n            if (change.type === \"end-transaction\") {\n              assert(change.id === transactionID);\n\n              transactions.push(transaction);\n              transaction = [];\n\n              transactionID = null;\n              inTransaction = false;\n            } else {\n              transaction.push(change);\n            }\n          } else {\n            assert(transaction.length === 0);\n            assert(change.type === \"begin-transaction\");\n            assert(transactionID === null);\n\n            transactionID = change.id;\n            inTransaction = true;\n          }\n        }\n\n        assert(!inTransaction);\n        assert(transaction.length === 0);\n        assert(transactions.length > 0);\n\n        // Apply transactions\n\n        for (const transaction of transactions) {\n          for (const change of transaction) {\n            applyChangeToObject(change, object);\n          }\n        }\n\n        await dbSetObject(object);\n        await dbRemoveAllChanges();\n      } else {\n        throw new Error(\"Not implemented\");\n      }\n    }\n\n    return;\n  }\n\n  /**\n   * Retrieves the object from the object store.\n   */\n  function dbGetObject(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      let object: any;\n\n      // Retrieveing changes\n      const req = window.indexedDB.open(database_name);\n      req.onblocked = (e) => { reject(); };\n      req.onerror = (e) => { reject(); };\n      req.onupgradeneeded = (e) => { reject(); };\n      req.onsuccess = (e) => {\n        const db = req.result;\n\n        const transaction = db.transaction([\"object\"], \"readonly\");\n        transaction.oncomplete = (e) => { resolve(object); };\n        transaction.onerror = (e) => { reject(); };\n\n        const store = transaction.objectStore(\"object\");\n\n        const store_req = store.get(0);\n        store_req.onerror = (e) => { };\n        store_req.onsuccess = (e) => {\n          // @ts-ignore\n          const result = e.target.result;\n          object = result;\n        };\n      };\n    });\n  }\n\n  /**\n   * Sets the object in the object store.\n   * \n   * @param object \n   */\n  function dbSetObject(object: any): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const req = window.indexedDB.open(database_name);\n      req.onblocked = (e) => { reject(); };\n      req.onerror = (e) => { reject(); };\n      req.onupgradeneeded = (e) => { reject(); };\n      req.onsuccess = (e) => {\n        const db = req.result;\n\n        const transaction = db.transaction([\"object\"], \"readwrite\");\n        transaction.oncomplete = (e) => { resolve(); };\n        transaction.onerror = (e) => { reject(); };\n\n        const store = transaction.objectStore(\"object\");\n\n        const store_req = store.put(object, 0);\n        store_req.onerror = (e) => {\n          reject();\n        };\n      };\n    });\n  };\n\n  /**\n   * Call this function at start\n   */\n  async function dbSetup() {\n    // Initialize database\n    const first_time = await dbInit();\n\n    // Initializes the object if there is a need for it.\n    if (first_time) await dbInitObject();\n\n    // Apply any pending changes.\n    await dbApplyChanges();\n  }\n\n  //////////////////////////////////////////////////////////////////////////////\n\n  /**\n   * Only ever call this function through the scheduler\n   */\n  function doApplyChanges(callback: TJobHandlerCallback) {\n    dbApplyChanges().then(() => {\n      resetDbAccumulation();\n      callback({ ok: true });\n    }).catch((reason) => {\n      throw new Error(reason);\n    });\n  }\n\n  /**\n   * Only ever call this function through the scheduler\n   */\n  function doAddChanges(callback: TJobHandlerCallback) {\n    if (pending_changes.length === 0) {\n      // Done\n      callback({ ok: true });\n      return;\n    }\n\n    const changes = pending_changes;\n    pending_changes = [];\n\n    const removedLocalAccumulation = resetLocalAccumulation();\n\n    dbAddChanges(changes).then(() => {\n      accumulateDbChange(removedLocalAccumulation);\n      // Done\n      callback({ ok: true });\n    }).catch((reason) => {\n      // callback??\n      console.error(reason);\n      throw new Error(reason);\n    });\n  }\n\n  scheduler.setJobHandler(\"applychanges\", doApplyChanges);\n  scheduler.setJobHandler(\"addchanges\", doAddChanges);\n\n  /**\n   * Call this function\n   */\n  function requestApplyChanges() {\n    scheduler.scheduleJob(\"applychanges\");\n  }\n\n  /**\n   * Call this function\n   */\n  function requestAddChanges() {\n    scheduler.scheduleJob(\"addchanges\");\n  }\n\n  //////////////////////////////////////////////////////////////////////////////\n  // Change accumulation\n\n  function resetLocalAccumulation() {\n    const removed = accumulatedLocalChange;\n    accumulatedLocalChange = 0;\n    return removed;\n  }\n\n  function resetDbAccumulation() {\n    const removed = accumulatedDbChange;\n    accumulatedDbChange = 0;\n    return removed;\n  }\n\n  function accumulateLocalChange(changeItem: ChangeItem) {\n    if (changeItem.type === \"begin-transaction\" || changeItem.type === \"end-transaction\") {\n      accumulatedLocalChange += changeItem.id.length + changeItem.type.length;\n    } else if (changeItem.type === \"delete\") {\n      accumulatedLocalChange += changeItem.jsonPointer.length + changeItem.type.length;\n    } else if (changeItem.type === \"set\") {\n      accumulatedLocalChange += changeItem.jsonPointer.length + changeItem.type.length + JSON.stringify(changeItem.value).length;\n    } else {\n      throw new Error();\n    }\n  }\n\n  function accumulateDbChange(change: number) {\n    assert(change > 0);\n    accumulatedDbChange += change;\n    if (accumulatedDbChange > ACCUMULATED_CHANGE_LIMIT) {\n      requestApplyChanges();\n    }\n  }\n\n  //////////////////////////////////////////////////////////////////////////////\n\n  /**\n   * \n   * @param item \n   */\n  function addChangeItem(changeItem: ChangeItem) {\n    accumulateLocalChange(changeItem);\n    if (transactional) {\n      // -----------------------------------------------------------------------\n      // TRANSACTIONAL\n      //\n      dispatchEvent(\"beforeaddchange\", { type: \"beforeaddchange\", change: changeItem, object: object });\n\n      if (inTransaction) {\n        // ---------------------------------------------------------------------\n        // IN TRANSACTION\n        //\n\n        dispatchEvent(\"beforechange\", { type: \"beforechange\", change: changeItem, object: object });\n\n        pending_changes.push(changeItem);\n\n        dispatchEvent(\"change\", { type: \"change\", change: changeItem, object: object });\n        dispatchEvent(\"afterchange\", { type: \"afterchange\", change: changeItem, object: object });\n      } else {\n        // ---------------------------------------------------------------------\n        // NOT IN TRANSACTION\n        //\n\n        // An opportunity to create a new transaction.\n        dispatchEvent(\"beforechange\", { type: \"beforechange\", change: changeItem, object: object });\n\n        assert(inTransaction);\n\n        pending_changes.push(changeItem);\n\n        dispatchEvent(\"change\", { type: \"change\", change: changeItem, object: object });\n        dispatchEvent(\"afterchange\", { type: \"afterchange\", change: changeItem, object: object });\n      }\n\n      dispatchEvent(\"afteraddchange\", { type: \"afteraddchange\", change: changeItem, object: object });\n    } else {\n      // -----------------------------------------------------------------------\n      // NON-TRANSACTIONAL\n      //\n\n      // Do not allow transaction if not transactional.\n      assert(!(changeItem.type === \"begin-transaction\" || changeItem.type === \"end-transaction\"));\n\n      dispatchEvent(\"beforechange\", { type: \"beforechange\", change: changeItem, object: object });\n\n      pending_changes.push(changeItem);\n\n      dispatchEvent(\"afterchange\", { type: \"afterchange\", change: changeItem, object: object });\n      dispatchEvent(\"change\", { type: \"change\", change: changeItem, object: object });\n\n      // Add changes after every change (not transactional).\n      requestAddChanges();\n    }\n  }\n\n  //////////////////////////////////////////////////////////////////////////////\n  // Proxy stuff\n\n  const observer: TObserver = (changes) => {\n    for (const change of changes) {\n      const { type } = change;\n      if (type === \"add\" || type === \"update\") {\n        addChangeItem({ type: \"set\", jsonPointer: change.jsonPointer, value: change.newValue });\n      } else if (type === \"delete\") {\n        addChangeItem({ type: \"delete\", jsonPointer: change.jsonPointer });\n      } else {\n        throw new Error(`Unknown type: ${type}`);\n      }\n    }\n  };\n\n\n  //////////////////////////////////////////////////////////////////////////////\n  // Transactions\n\n  function getNextTransactionID() {\n    return \"\" + Date.now();\n  }\n\n  let inTransaction = false;\n  let activeTransactionID: null | string = null;\n\n  function beginTransaction() {\n    assert(transactional);\n    assert(activeTransactionID === null);\n\n    activeTransactionID = getNextTransactionID();\n\n    pending_changes.push({\n      type: \"begin-transaction\",\n      id: activeTransactionID,\n    });\n\n    inTransaction = true;\n  }\n\n  function endTransaction() {\n    assert(transactional);\n    assert(activeTransactionID !== null);\n\n    pending_changes.push({\n      type: \"end-transaction\",\n      id: activeTransactionID,\n    });\n\n    activeTransactionID = null;\n    inTransaction = false;\n\n    requestAddChanges();\n  }\n\n  //////////////////////////////////////////////////////////////////////////////\n  // Stork events and listeners\n\n  function dispatchEvent(type: StorkaEventType, event: StorkaEvent) {\n    assert(type === event.type);\n    for (const listener of listeners[type]) {\n      assert(type === event.type);\n      listener(event);\n    }\n  }\n\n  function addEventListener(type: StorkaEventType, listener: StorkaEventListener) {\n    if (!listeners[type].has(listener)) {\n      listeners[type].add(listener);\n\n      if (type === \"ready\") {\n        if (is_ready) {\n          const event: StorkaEventReady = { type: \"ready\" };\n          listener(event);\n        }\n      }\n    }\n  }\n\n  function removeEventListener(type: StorkaEventType, listener: StorkaEventListener) {\n    if (listeners[type].has(listener)) {\n      listeners[type].delete(listener);\n    }\n  }\n\n  //////////////////////////////////////////////////////////////////////////////\n  // Initialization\n\n  async function init() {\n    await dbSetup();\n\n    // Retrieve object\n    const retrieved_object = await dbGetObject();\n\n    assert(typeof retrieved_object && retrieved_object !== null);\n\n    object = retrieved_object;\n\n\n    // Make return object be in a ready state.\n    proxy = ObservableSlim.create(object, false, observer);\n\n    return_object.object = object;\n    return_object.proxy = proxy;\n    return_object.ready = true;\n    return_object.beginTransaction = beginTransaction;\n    return_object.endTransaction = endTransaction;\n\n    const event: StorkaEventReady = { type: \"ready\" };\n\n    dispatchEvent(\"ready\", event);\n  }\n\n  // Start initialization\n  init().catch((reason) => {\n    console.log(\"Error:\", reason);\n    throw new Error(reason);\n  });\n\n  //////////////////////////////////////////////////////////////////////////////\n  // Return object\n\n  const return_object: StorkaReturnObject = {\n    object: null,\n    proxy: null,\n    addEventListener,\n    removeEventListener,\n    ready: false,\n\n    beginTransaction: () => { },\n    endTransaction: () => { },\n  };\n\n  //////////////////////////////////////////////////////////////////////////////\n  // Exports\n\n  return return_object;\n}\n","const s1 = new Set([\"has\", \"starts-width\", \"ends-with\", \"not-starts-with\"]);\n\n/**\n * Asserts the condition `condition`.  If the value is not boolean then it is\n * cast to a boolean value.  If the condition evaluates to a falsy value then\n * an exception is raised.  An optional message `message` is displayed and\n * other optional things `...other` printed to the error console.\n * \n * // TODO: in future version ...): asserts condition { ...\n * can be added.\n *\n * @param {any} condition\n * @param {string=} message\n * @param {any=} other\n *\n * @throws Will throw an error if `condition` is falsy.\n */\nexport function assert(\n  condition: any,\n  message = \"Assertion failed\",\n  ...other: any[]\n): asserts condition {\n  if (!condition) {\n    if (typeof message !== \"string\") {\n      console.error(JSON.parse(JSON.stringify(message)));\n      throw new Error(\"Assertion failed\");\n    } else if (other.length > 0) console.error(JSON.parse(JSON.stringify(other)));\n    throw new Error(message);\n  }\n}\n\n\nexport function isNonNegativeInteger(x: any) {\n  return isInteger(x) && x >= 0;\n}\n\n/**\n * Checks whether the object `object` has a property with the name\n * `propertyName`.  It does NOT search trough its prototypes.\n *\n * Use this instead of `object.hasOwnProperty(propertyName)`.\n *\n * `Object.prototype.hasOwnProperty.call(object, propertyName)`\n *\n * @param {object} object\n * @param {string|number|symbol} propertyName\n * @returns {boolean}\n */\nexport function hasOwnProperty(\n  object: object,\n  propertyName: string | number | symbol\n) {\n  return Object.prototype.hasOwnProperty.call(object, propertyName);\n}\n\n/**\n * Encodes the string `s` to be used in regular expressions, such that it does\n * not conflict with any regular expression meta-characters.\n *\n * @param {string} s\n */\nexport function encodeForRegex(s: string) {\n  // $& means the whole matched string\n  return s.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n}\n\n/**\n *\n * @param {string} query\n * @param {string} mode \"has\", \"starts-width\", \"ends-with\", \"not-starts-with\"\n * @param {boolean} caseSensitive\n */\nexport function createSearchFilter(\n  query: string,\n  mode: string,\n  caseSensitive: boolean\n) {\n  assert(s1.has(mode));\n  assert(typeof caseSensitive === \"boolean\");\n\n  if (caseSensitive) {\n    // is case sensitive, do nothing\n  } else {\n    query = query.toLocaleLowerCase();\n  }\n\n  const escaped_query = encodeForRegex(query);\n\n  let regex = null;\n\n  if (mode === \"has\") {\n    regex = new RegExp(`.*${escaped_query}.*`);\n  } else if (mode === \"starts-width\") {\n    regex = new RegExp(`^${escaped_query}.*`);\n  } else if (mode === \"ends-with\") {\n    // TODO: I'm not sure if this one is correct.  Double check later.\n    regex = new RegExp(`.*${escaped_query}$`);\n  } else if (mode === \"not-starts-with\") {\n    regex = new RegExp(`.+${escaped_query}.*`);\n  } else {\n    throw new Error();\n  }\n\n  if (!(regex instanceof RegExp)) {\n    throw new Error();\n  }\n\n  const reg = regex;\n\n  if (caseSensitive) {\n    /**\n     *\n     * @param {string} s\n     */\n    const f = (s: string) => {\n      return s.match(reg) !== null;\n    };\n    return f;\n  } else {\n    /**\n     *\n     * @param {string} s\n     */\n    const f = (s: string) => {\n      return s.toLocaleLowerCase().match(reg) !== null;\n    };\n    return f;\n  }\n}\n\n/**\n * Checks whether the object `object` has a property with the name\n * `propertyName`.  It also searches through the object's prototypes.\n *\n * @param {Object} object\n * @param {string|number|symbol} propertyName\n * @returns {boolean}\n */\nexport function hasProperty(\n  object: object,\n  propertyName: string | number | symbol\n) {\n  return propertyName in object;\n}\n\n/**\n * Use this instead of `childObject.isPrototypeOf(parentObject)`.\n *\n * @param {Object} childObject\n * @param {Object} parentObject\n * @returns {boolean}\n */\nexport function isPrototypeOf(childObject: object, parentObject: object) {\n  return Object.prototype.isPrototypeOf.call(childObject, parentObject);\n}\n\n/**\n * a u b\n *\n * @param {Set<any>} a\n * @param {Set<any>} b\n */\nexport function getSetUnion(a: Set<any>, b: Set<any>) {\n  const union = new Set([...a, ...b]);\n  return union;\n}\n\n/**\n * a n b\n *\n * @param {Set<any>} a\n * @param {Set<any>} b\n */\nexport function getSetIntersection(a: Set<any>, b: Set<any>) {\n  const intersection = new Set([...a].filter((x) => b.has(x)));\n  return intersection;\n}\n\n/**\n * a - b OR a \\ b\n *\n * @param {Set<any>} a\n * @param {Set<any>} b\n */\nexport function getSetDifference(a: Set<any>, b: Set<any>) {\n  const difference = new Set([...a].filter((x) => !b.has(x)));\n  return difference;\n}\n\n/**\n *\n * @param {Set<any>} a\n * @param {Set<any>} b\n */\nexport function getSetSymmetricDifference(a: Set<any>, b: Set<any>) {\n  const x = getSetDifference(a, b);\n  const y = getSetDifference(b, a);\n  return getSetUnion(x, y);\n}\n\n/**\n * Use this isntead of `object.propertyIsEnumerable(propertyName)`.\n *\n * @param {Object} object\n * @param {string|number|symbol} propertyName\n * @returns {boolean}\n */\nexport function isPropertyEnumerable(\n  object: object,\n  propertyName: string | number | symbol\n) {\n  return {}.propertyIsEnumerable.call(object, propertyName);\n}\n\n/**\n * If `source` and `target` are JavaScript objects (and not null) then\n * properties from `source` are inserted into `target`, and overwriting\n * pre-existing properties in `target` if they have the same property key.\n *\n * @param {any} source\n * @param {any} target\n */\nexport function mixin(source: any, target: any) {\n  if (typeof source !== \"object\" || source === null) {\n    return;\n  }\n\n  if (typeof target === \"object\" && target !== null) {\n    Object.keys(source).forEach((key) => {\n      target[key] = source[key];\n    });\n  }\n}\n\nexport function isEmpty(x: any) {\n  return typeof x === \"undefined\" || x === null;\n}\n\n/**\n * Takes a snapshot of the JSON element `element`, i.e. creates a copy of the\n * JSON element.\n *\n * @param {any} element\n * @param {*} defaultValue\n *\n * @throws Will throw an error if `JSON.stringify` fails to stringify the\n * element `element`.\n */\nexport function snapshot(element: any, defaultValue?: any) {\n  if (typeof element === \"undefined\") {\n    return defaultValue;\n  }\n  return JSON.parse(JSON.stringify(element));\n}\n\n/**\n * Generates a random string generator which derives its symbols from the\n * alphabet `alphabet`.\n *\n * @param {string|string[]} alphabet\n */\nexport function generateRandomStringGenerator(alphabet: string | string[]) {\n  const symbols = typeof alphabet === \"string\" ? alphabet.split(\"\") : alphabet;\n  const m = symbols.length;\n\n  /**\n   * Generates a random string of length `n` from alphabet `alphabet` (from\n   * closures).\n   *\n   * @param {number} n\n   */\n  function generateRandomString(n: number) {\n    const randomSymbols = [];\n    for (let i = 0; i < n; i++) {\n      const randomIndex = Math.floor(m * Math.random());\n      const randomSymbol = symbols[randomIndex];\n      randomSymbols.push(randomSymbol);\n    }\n    const randomString = randomSymbols.join(\"\");\n    return randomString;\n  }\n\n  return generateRandomString;\n}\n\n/**\n * Returns `true` if `a < x < b`.\n *\n * @param {number} x\n * @param {number} a\n * @param {number} b\n */\nexport function inLeftOpenRightOpenInterval(x: number, a: number, b: number) {\n  return a < x && x < b;\n}\n\n/**\n * Returns `true` if `a <= x < b`.\n *\n * @param {number} x\n * @param {number} a\n * @param {number} b\n */\nexport function inLeftClosedRightOpenInterval(x: number, a: number, b: number) {\n  return a <= x && x < b;\n}\n\n/**\n * Returns `true` if `a < x <= b`.\n *\n * @param {number} x\n * @param {number} a\n * @param {number} b\n */\nexport function inLeftOpenRightClosedInterval(x: number, a: number, b: number) {\n  return a < x && x <= b;\n}\n\n/**\n * Returns `true` if `a <= x <= b`.\n *\n * @param {number} x\n * @param {number} a\n * @param {number} b\n */\nexport function inLeftClosedRightClosedInterval(\n  x: number,\n  a: number,\n  b: number\n) {\n  return a <= x && x <= b;\n}\n\n/**\n * Returns `true` if `a < x < b`.\n *\n * @param {number} x\n * @param {number} a\n * @param {number} b\n */\nexport function inOpenInterval(x: number, a: number, b: number) {\n  return a < x && x < b;\n}\n\n/**\n * Returns `true` if `a <= x <= b`.\n *\n * @param {number} x\n * @param {number} a\n * @param {number} b\n */\nexport function inClosedInterval(x: number, a: number, b: number) {\n  return a <= x && x <= b;\n}\n\n/**\n *\n * @param {number} x\n * @param {number} a\n * @param {number} b\n */\nexport function clamp(x: number, a: number, b: number) {\n  if (x < a) {\n    return x;\n  } else if (x > b) {\n    return b;\n  } else {\n    return x;\n  }\n}\n\nexport function isInfinite(x: any) {\n  return x === Infinity || x === -Infinity;\n}\n\nexport function isNaN(x: any) {\n  return Number.isNaN(x);\n}\n\nexport function isString(x: any) {\n  return typeof x === \"string\";\n}\n\nexport function isUndefined(x: any) {\n  return typeof x === \"undefined\";\n}\n\nexport function isNull(x: any) {\n  return x === null;\n}\n\nexport function isInteger(x: any) {\n  return Number.isSafeInteger(x);\n}\n\nexport function isNegativeInteger(x: any) {\n  return isInteger(x) && x < 0;\n}\n\nexport function isPositiveInteger(x: any) {\n  return isInteger(x) && x > 0;\n}\n\nexport function isNonNegative(x: any) {\n  return isInteger(x) && x >= 0;\n}\n\n/**\n * Returns the duration or time passed from dates `start` to `end` in\n * milliseconds (non-negative integer).\n *\n * Strings `start` and `end` are expected to be in a simplified extended ISO\n * format (ISO 8601).\n *\n * @param {string} start\n * @param {string} end\n *\n * @throws Will throw an error if `start` or `end` do not conform to simplified\n * extended ISO format (ISO 8601).  It will also throw an error `start` is of\n * a later date than `end`.\n */\nexport function getDurationISO8601InMS(start: string, end: string) {\n  const da = new Date(start);\n  const db = new Date(end);\n  assert(\"\" + da !== `From ${start} to ${end}`);\n  assert(\"\" + db !== `From ${start} to ${end}`);\n\n  const ta = da.getTime();\n  const tb = db.getTime();\n\n  assert(tb >= ta, `Should hold: ${tb} >= ${ta}`);\n\n  const duration = tb - ta;\n  assert(Number.isSafeInteger(duration) && duration >= 0);\n  return duration;\n}\n\n/*\n * Generates a random prefix (string).\n *\n * @param {number} n How many symbols to generate.\n */\nexport const generateRandomPrefix = (() => {\n  const NUMBERS = \"0123456789\";\n  const LETTERS_LOWER_CASE = \"abcdefghijklmnopqrstuvwxyz\";\n\n  const alphabet_first_symbol = LETTERS_LOWER_CASE;\n  const alphabet_remainder_symbols = LETTERS_LOWER_CASE + NUMBERS;\n\n  const grs1 = generateRandomStringGenerator(alphabet_first_symbol);\n  const grs2 = generateRandomStringGenerator(alphabet_remainder_symbols);\n\n  /**\n   *\n   * @param {number} n\n   */\n  function generateRandomStringFG4(n = 10) {\n    const randomSymbols = [];\n    randomSymbols.push(grs1(Math.min(1, n)));\n    randomSymbols.push(grs2(Math.max(0, n - 1)));\n    const randomString = randomSymbols.join(\"\");\n    return randomString;\n  }\n\n  return generateRandomStringFG4;\n})();\n\n\nexport const generateBase64String = (() => {\n  // Base64 alphabet\n  const alphabet = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n  const alph = alphabet.split(\"\");\n\n  // How many random bytes\n  const n = 1024 * 18;\n\n  // Array of random bytes\n  const a = new Uint8Array(n);\n\n  // We always want to have 3\n  // How many 6-bit blocks can we safely go through\n  const h = (n - (n % 6)) / 6;\n\n  // Index of the next random byte.\n  let i = 0;\n\n  // Refill random bytes.\n  window.crypto.getRandomValues(a);\n\n  // TODO: when should we refill?\n\n  // TODO: implement!\n\n  // string concatenation -> 0.269 µs\n  // array join -> 0.632 µs\n\n  return (nrOfSymbols: number) => {\n    if (true) throw new Error(\"Not implemented?\");\n    assert(Number.isSafeInteger(nrOfSymbols) && nrOfSymbols >= 0);\n    if (nrOfSymbols === 0) return \"\";\n\n    let s = \"\";\n\n    const k_remainder = nrOfSymbols % 4;\n    const k_full_rounds = (nrOfSymbols - k_remainder) / 4;\n\n    // TODO: how many rounds can be go through until we need to refill?\n    // TODO: try to use all the randomly created bytes\n\n    // Full round\n\n    // Always go through 4x 6-bit blocks that consume 3x 8-bit blocks.\n    for (let k = 0; k < 4; ++k) {\n      switch (k) {\n        case 0:\n          s += alph[a[i] >> 2];\n          break;\n        case 1:\n          s += alph[((a[i] & 0b11) << 4) + (a[++i] >> 4)];\n          break;\n        case 2:\n          s += alph[((a[i] & 0b1111) << 2) + (a[++i] >> 6)];\n          break;\n        case 3:\n          s += alph[a[i] & 0b111111];\n          ++i;\n          break;\n      }\n    }\n\n    // Remainder round\n\n    return s;\n  };\n})();\n\n\nexport const generate144BitsBase64 = (() => {\n  // 144 bits is 18 8-bit blocks\n  // 144 bits is 24 6-bit blocks\n\n  // n =     1 -> 0.696 µs\n  // n =    10 -> 0.249 µs\n  // n =   100 -> 0.19  µs\n  // n =  1000 -> 0.182 µs\n  // n =  2500 -> 0.185 µs\n  // n =  5000 -> error\n  // n = 10000 -> error\n  const n = 1024 * 18;\n  const a = new Uint8Array(n);\n\n  const alphabet = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n  const alph = alphabet.split(\"\");\n\n  let i = n;\n  let k = 0;\n\n  // string concatenation -> 0.269 µs\n  // array join -> 0.632 µs\n\n  return () => {\n    if (i == n) {\n      window.crypto.getRandomValues(a);\n      i = 0;\n    }\n\n    let s = \"\";\n\n    for (let j = 0; j < 24; ++j) {\n      switch (k % 4) {\n        case 0:\n          //   i\n          //   k\n          //   vvvv vv\n          // | xxxx xxyy | yyyy zzzz | zzww wwww |\n          s += alph[a[i] >> 2];\n          ++k;\n          break;\n        case 1:\n          //   i           i\n          //          k\n          //          vv   vvvv\n          // | xxxx xxyy | yyyy zzzz | zzww wwww |\n          s += alph[((a[i] & 0b11) << 4) + (a[++i] >> 4)];\n          ++k;\n          break;\n        case 2:\n          //               i\n          //                    k\n          //                    vvvv   vv\n          // | xxxx xxyy | yyyy zzzz | zzww wwww |\n          s += alph[((a[i] & 0b1111) << 2) + (a[++i] >> 6)];\n          ++k;\n          break;\n        case 3:\n          //                             i\n          //                             k\n          //                             vv vvvv\n          // | xxxx xxyy | yyyy zzzz | zzww wwww |\n          s += alph[a[i] & 0b111111];\n          ++i;\n          ++k;\n          break;\n      }\n    }\n\n    return s;\n  };\n})();\n\n\n/**\n * Deep comparison\n * \n * Returns `true` if `x` is structurally equivalent to `y`.\n * \n * Source:\n * * <https://gist.github.com/nicbell/6081098>\n * \n * TODO: handle cycles\n * \n * @param x \n * @param y \n */\nexport const deepCompare = (x: any, y: any) => {\n\n  const items = [];\n\n  const _deepCompare = (x: any, y: any) => {\n    // Covers `string`, `boolean` and `number`.\n    if (x === y) return true;\n\n    if (typeof x !== typeof y) return false;\n\n    // Check for null\n    if (x === null || y === null) {\n      if (x === null && y === null) return true;\n      else return false;\n    }\n\n    if (typeof x === \"undefined\") return true;\n\n    const o1 = x;\n    const o2 = x;\n\n    for (const p in o1) {\n      if (o1.hasOwnProperty(p) !== o2.hasOwnProperty(p)) return false;\n      if (typeof o1[p] !== typeof o2[p]) return false;\n\n      switch (typeof o1[p]) {\n        // Deep compare objects.\n        case 'object':\n          if (!_deepCompare(o1[p], o2[p])) return false;\n          break;\n        // Compare function code\n        case 'function':\n          if (typeof o2[p] === \"undefined\" || (o1[p].toString() !== o2[p].toString())) return false;\n          break;\n        // Compare values\n        default:\n          if (o1[p] !== o2[p]) return false;\n      }\n    }\n\n    // Check object 2 for any extra properties\n    for (const p in o2) {\n      if (typeof o1[p] === \"undefined\") return false;\n    }\n\n    return true;\n  };\n\n  return _deepCompare(x, y);\n};\n","// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\n// This work is free. You can redistribute it and/or modify it\n// under the terms of the WTFPL, Version 2\n// For more information see LICENSE.txt or http://www.wtfpl.net/\n//\n// For more information, the home page:\n// http://pieroxy.net/blog/pages/lz-string/testing.html\n//\n// LZ-based compression algorithm, version 1.4.4\nconst LZString = (function () {\n  // private property\n  const f = String.fromCharCode;\n  const keyStrBase64 =\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n    const keyStrUriSafe =\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\";\n    const baseReverseDic: { [alphabet: string]: { [character: string]: number } } = {};\n\n  function getBaseValue(alphabet: string, character: string) {\n    if (!baseReverseDic[alphabet]) {\n      baseReverseDic[alphabet] = {};\n      for (var i = 0; i < alphabet.length; i++) {\n        baseReverseDic[alphabet][alphabet.charAt(i)] = i;\n      }\n    }\n    return baseReverseDic[alphabet][character];\n  }\n\n  const LZString = {\n    compressToBase64: function (input: null | string) {\n      if (input == null) return \"\"; // eslint-disable-line eqeqeq\n      var res = LZString._compress(input, 6, function (a) {\n        return keyStrBase64.charAt(a);\n      });\n      switch (\n      res.length % 4 // To produce valid Base64\n      ) {\n        default: // When could this happen ?\n        case 0:\n          return res;\n        case 1:\n          return res + \"===\";\n        case 2:\n          return res + \"==\";\n        case 3:\n          return res + \"=\";\n      }\n    },\n\n    decompressFromBase64: function (input: null | string) {\n      if (input == null) return \"\"; // eslint-disable-line eqeqeq\n      if (input == \"\") return null; // eslint-disable-line eqeqeq\n      return LZString._decompress(input.length, 32, function (index) {\n        return getBaseValue(keyStrBase64, input.charAt(index));\n      });\n    },\n\n    compressToUTF16: function (input: null | string) {\n      if (input == null) return \"\"; // eslint-disable-line eqeqeq\n      return (\n        LZString._compress(input, 15, function (a) {\n          return f(a + 32);\n        }) + \" \"\n      );\n    },\n\n    decompressFromUTF16: function (compressed: null | string) {\n      if (compressed == null) return \"\"; // eslint-disable-line eqeqeq\n      if (compressed == \"\") return null; // eslint-disable-line eqeqeq\n      return LZString._decompress(compressed.length, 16384, function (index) {\n        return compressed.charCodeAt(index) - 32;\n      });\n    },\n\n    //compress into uint8array (UCS-2 big endian format)\n    compressToUint8Array: function (uncompressed: string) {\n      var compressed = LZString.compress(uncompressed);\n      var buf = new Uint8Array(compressed.length * 2); // 2 bytes per character\n\n      for (var i = 0, TotalLen = compressed.length; i < TotalLen; i++) {\n        var current_value = compressed.charCodeAt(i);\n        buf[i * 2] = current_value >>> 8;\n        buf[i * 2 + 1] = current_value % 256;\n      }\n      return buf;\n    },\n\n    //decompress from uint8array (UCS-2 big endian format)\n    decompressFromUint8Array: function (compressed: Uint8Array) {\n      if (compressed === null || compressed === undefined) {\n        // @ts-ignore\n        return LZString.decompress(compressed);\n      } else {\n        var buf = new Array(compressed.length / 2); // 2 bytes per character\n        for (var i = 0, TotalLen = buf.length; i < TotalLen; i++) {\n          buf[i] = compressed[i * 2] * 256 + compressed[i * 2 + 1];\n        }\n\n        var result: any[] = [];\n        buf.forEach(function (c) {\n          result.push(f(c));\n        });\n        return LZString.decompress(result.join(\"\"));\n      }\n    },\n\n    //compress into a string that is already URI encoded\n    compressToEncodedURIComponent: function (input: null | string) {\n      if (input == null) return \"\"; // eslint-disable-line eqeqeq\n      return LZString._compress(input, 6, function (a) {\n        return keyStrUriSafe.charAt(a);\n      });\n    },\n\n    //decompress from an output of compressToEncodedURIComponent\n    decompressFromEncodedURIComponent: function (input: null | string) {\n      if (input == null) return \"\"; // eslint-disable-line eqeqeq\n      if (input == \"\") return null; // eslint-disable-line eqeqeq\n      input = input.replace(/ /g, \"+\");\n      return LZString._decompress(input.length, 32, function (index) {\n        return getBaseValue(keyStrUriSafe, (input as string).charAt(index));\n      });\n    },\n\n    compress: function (uncompressed: null | string) {\n      return LZString._compress(uncompressed, 16, function (a: number) {\n        return f(a);\n      });\n    },\n    _compress: function (uncompressed: null | string, bitsPerChar: number, getCharFromInt: (a: number) => string) {\n      if (uncompressed == null) return \"\"; // eslint-disable-line eqeqeq\n      var i,\n        value,\n        context_dictionary: { [key: string]: number } = {},\n        context_dictionaryToCreate: { [key: string]: boolean } = {},\n        context_c = \"\",\n        context_wc = \"\",\n        context_w = \"\",\n        context_enlargeIn = 2, // Compensate for the first entry which should not count\n        context_dictSize = 3,\n        context_numBits = 2,\n        context_data = [],\n        context_data_val = 0,\n        context_data_position = 0,\n        ii;\n\n      for (ii = 0; ii < uncompressed.length; ii += 1) {\n        context_c = uncompressed.charAt(ii);\n        if (\n          !Object.prototype.hasOwnProperty.call(context_dictionary, context_c)\n        ) {\n          context_dictionary[context_c] = context_dictSize++;\n          context_dictionaryToCreate[context_c] = true;\n        }\n\n        context_wc = context_w + context_c;\n        if (\n          Object.prototype.hasOwnProperty.call(context_dictionary, context_wc)\n        ) {\n          context_w = context_wc;\n        } else {\n          if (\n            Object.prototype.hasOwnProperty.call(\n              context_dictionaryToCreate,\n              context_w\n            )\n          ) {\n            if (context_w.charCodeAt(0) < 256) {\n              for (i = 0; i < context_numBits; i++) {\n                context_data_val = context_data_val << 1;\n                if (context_data_position == bitsPerChar - 1) { // eslint-disable-line eqeqeq\n                  context_data_position = 0;\n                  context_data.push(getCharFromInt(context_data_val));\n                  context_data_val = 0;\n                } else {\n                  context_data_position++;\n                }\n              }\n              value = context_w.charCodeAt(0);\n              for (i = 0; i < 8; i++) {\n                context_data_val = (context_data_val << 1) | (value & 1);\n                if (context_data_position == bitsPerChar - 1) { // eslint-disable-line eqeqeq\n                  context_data_position = 0;\n                  context_data.push(getCharFromInt(context_data_val));\n                  context_data_val = 0;\n                } else {\n                  context_data_position++;\n                }\n                value = value >> 1;\n              }\n            } else {\n              value = 1;\n              for (i = 0; i < context_numBits; i++) {\n                context_data_val = (context_data_val << 1) | value;\n                if (context_data_position == bitsPerChar - 1) { // eslint-disable-line eqeqeq\n                  context_data_position = 0;\n                  context_data.push(getCharFromInt(context_data_val));\n                  context_data_val = 0;\n                } else {\n                  context_data_position++;\n                }\n                value = 0;\n              }\n              value = context_w.charCodeAt(0);\n              for (i = 0; i < 16; i++) {\n                context_data_val = (context_data_val << 1) | (value & 1);\n                if (context_data_position == bitsPerChar - 1) { // eslint-disable-line eqeqeq\n                  context_data_position = 0;\n                  context_data.push(getCharFromInt(context_data_val));\n                  context_data_val = 0;\n                } else {\n                  context_data_position++;\n                }\n                value = value >> 1;\n              }\n            }\n            context_enlargeIn--;\n            if (context_enlargeIn == 0) { // eslint-disable-line eqeqeq\n              context_enlargeIn = Math.pow(2, context_numBits);\n              context_numBits++;\n            }\n            delete context_dictionaryToCreate[context_w];\n          } else {\n            value = context_dictionary[context_w];\n            for (i = 0; i < context_numBits; i++) {\n              context_data_val = (context_data_val << 1) | (value & 1);\n              if (context_data_position == bitsPerChar - 1) { // eslint-disable-line eqeqeq\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          }\n          context_enlargeIn--;\n          if (context_enlargeIn == 0) { // eslint-disable-line eqeqeq\n            context_enlargeIn = Math.pow(2, context_numBits);\n            context_numBits++;\n          }\n          // Add wc to the dictionary.\n          context_dictionary[context_wc] = context_dictSize++;\n          context_w = String(context_c);\n        }\n      }\n\n      // Output the code for w.\n      if (context_w !== \"\") {\n        if (\n          Object.prototype.hasOwnProperty.call(\n            context_dictionaryToCreate,\n            context_w\n          )\n        ) {\n          if (context_w.charCodeAt(0) < 256) {\n            for (i = 0; i < context_numBits; i++) {\n              context_data_val = context_data_val << 1;\n              if (context_data_position == bitsPerChar - 1) { // eslint-disable-line eqeqeq\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n            }\n            value = context_w.charCodeAt(0);\n            for (i = 0; i < 8; i++) {\n              context_data_val = (context_data_val << 1) | (value & 1);\n              if (context_data_position == bitsPerChar - 1) { // eslint-disable-line eqeqeq\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          } else {\n            value = 1;\n            for (i = 0; i < context_numBits; i++) {\n              context_data_val = (context_data_val << 1) | value;\n              if (context_data_position == bitsPerChar - 1) { // eslint-disable-line eqeqeq\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = 0;\n            }\n            value = context_w.charCodeAt(0);\n            for (i = 0; i < 16; i++) {\n              context_data_val = (context_data_val << 1) | (value & 1);\n              if (context_data_position == bitsPerChar - 1) { // eslint-disable-line eqeqeq\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          }\n          context_enlargeIn--;\n          if (context_enlargeIn == 0) { // eslint-disable-line eqeqeq\n            context_enlargeIn = Math.pow(2, context_numBits);\n            context_numBits++;\n          }\n          delete context_dictionaryToCreate[context_w];\n        } else {\n          value = context_dictionary[context_w];\n          for (i = 0; i < context_numBits; i++) {\n            context_data_val = (context_data_val << 1) | (value & 1);\n            if (context_data_position == bitsPerChar - 1) { // eslint-disable-line eqeqeq\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) { // eslint-disable-line eqeqeq\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n      }\n\n      // Mark the end of the stream\n      value = 2;\n      for (i = 0; i < context_numBits; i++) {\n        context_data_val = (context_data_val << 1) | (value & 1);\n        if (context_data_position == bitsPerChar - 1) { // eslint-disable-line eqeqeq\n          context_data_position = 0;\n          context_data.push(getCharFromInt(context_data_val));\n          context_data_val = 0;\n        } else {\n          context_data_position++;\n        }\n        value = value >> 1;\n      }\n\n      // Flush the last char\n      while (true) {\n        context_data_val = context_data_val << 1;\n        if (context_data_position == bitsPerChar - 1) { // eslint-disable-line eqeqeq\n          context_data.push(getCharFromInt(context_data_val));\n          break;\n        } else context_data_position++;\n      }\n      return context_data.join(\"\");\n    },\n\n    decompress: function (compressed: null | string) {\n      if (compressed == null) return \"\"; // eslint-disable-line eqeqeq\n      if (compressed == \"\") return null; // eslint-disable-line eqeqeq\n      return LZString._decompress(compressed.length, 32768, function (index: number) {\n        return compressed.charCodeAt(index);\n      });\n    },\n\n    _decompress: function (length: number, resetValue: number, getNextValue: (index: number) => number) {\n      var dictionary = [],\n        // next,\n        enlargeIn = 4,\n        dictSize = 4,\n        numBits = 3,\n        entry = \"\",\n        result = [],\n        i,\n        w,\n        bits,\n        resb,\n        maxpower,\n        power,\n        c,\n        data = {\n          val: getNextValue(0),\n          position: resetValue,\n          index: 1\n        };\n\n      for (i = 0; i < 3; i += 1) {\n        dictionary[i] = i;\n      }\n\n      bits = 0;\n      maxpower = Math.pow(2, 2);\n      power = 1;\n      while (power != maxpower) { // eslint-disable-line eqeqeq\n        resb = data.val & data.position;\n        data.position >>= 1;\n        if (data.position == 0) { // eslint-disable-line eqeqeq\n          data.position = resetValue;\n          data.val = getNextValue(data.index++);\n        }\n        bits |= (resb > 0 ? 1 : 0) * power;\n        power <<= 1;\n      }\n\n      switch (bits /*(next = bits)*/ ) {\n        case 0:\n          bits = 0;\n          maxpower = Math.pow(2, 8);\n          power = 1;\n          while (power != maxpower) { // eslint-disable-line eqeqeq\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) { // eslint-disable-line eqeqeq\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb > 0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n          c = f(bits);\n          break;\n        case 1:\n          bits = 0;\n          maxpower = Math.pow(2, 16);\n          power = 1;\n          while (power != maxpower) { // eslint-disable-line eqeqeq\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) { // eslint-disable-line eqeqeq\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb > 0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n          c = f(bits);\n          break;\n        case 2:\n          return \"\";\n      }\n      dictionary[3] = c;\n      w = c;\n      result.push(c);\n      while (true) {\n        if (data.index > length) {\n          return \"\";\n        }\n\n        bits = 0;\n        maxpower = Math.pow(2, numBits);\n        power = 1;\n        while (power != maxpower) { // eslint-disable-line eqeqeq\n          resb = data.val & data.position;\n          data.position >>= 1;\n          if (data.position == 0) { // eslint-disable-line eqeqeq\n            data.position = resetValue;\n            data.val = getNextValue(data.index++);\n          }\n          bits |= (resb > 0 ? 1 : 0) * power;\n          power <<= 1;\n        }\n\n        switch ((c = bits)) {\n          case 0:\n            bits = 0;\n            maxpower = Math.pow(2, 8);\n            power = 1;\n            while (power != maxpower) { // eslint-disable-line eqeqeq\n              resb = data.val & data.position;\n              data.position >>= 1;\n              if (data.position == 0) { // eslint-disable-line eqeqeq\n                data.position = resetValue;\n                data.val = getNextValue(data.index++);\n              }\n              bits |= (resb > 0 ? 1 : 0) * power;\n              power <<= 1;\n            }\n\n            dictionary[dictSize++] = f(bits);\n            c = dictSize - 1;\n            enlargeIn--;\n            break;\n          case 1:\n            bits = 0;\n            maxpower = Math.pow(2, 16);\n            power = 1;\n            while (power != maxpower) { // eslint-disable-line eqeqeq\n              resb = data.val & data.position;\n              data.position >>= 1;\n              if (data.position == 0) { // eslint-disable-line eqeqeq\n                data.position = resetValue;\n                data.val = getNextValue(data.index++);\n              }\n              bits |= (resb > 0 ? 1 : 0) * power;\n              power <<= 1;\n            }\n            dictionary[dictSize++] = f(bits);\n            c = dictSize - 1;\n            enlargeIn--;\n            break;\n          case 2:\n            return result.join(\"\");\n        }\n\n        if (enlargeIn == 0) { // eslint-disable-line eqeqeq\n          enlargeIn = Math.pow(2, numBits);\n          numBits++;\n        }\n\n        if (dictionary[c]) {\n          // @ts-ignore\n          entry = dictionary[c];\n        } else {\n          if (c === dictSize) {\n            entry = w + (w as string).charAt(0);\n          } else {\n            return null;\n          }\n        }\n        result.push(entry);\n\n        // Add w+entry[0] to the dictionary.\n        dictionary[dictSize++] = w + entry.charAt(0);\n        enlargeIn--;\n\n        w = entry;\n\n        if (enlargeIn == 0) { // eslint-disable-line eqeqeq\n          enlargeIn = Math.pow(2, numBits);\n          numBits++;\n        }\n      }\n    }\n  };\n  return LZString;\n})();\n\nexport { LZString };\n","import { hasOwnProperty } from \"./utils\";\nimport { assert } from \"../utils-ui\";\nimport { LZString } from \"./lz-string\";\n\n// const LEGACY_PREFIXES = [\"fnk4sss2wf\", \"SQpN9PVGmf\"];\n\n////////////////////////////////////////////////////////////////////////////////\n// Legacy\n\n// export const SELECTED_PREFIX = \"y2AEnXD9WoAGHKeRzeMq0PlMyWWrQkUp\";\nexport const VERIFICATION_LEVEL_NONE = 1;\nexport const VERIFICATION_LEVEL_MINIMAL = 2;\nexport const VERIFICATION_LEVEL_MAX = 3;\n\n////////////////////////////////////////////////////////////////////////////////\n\n\nconst DEBUG = false;\n\nconst DEBUG_FILENAME = \"gtm-lib-common.ts\";\n\n////////////////////////////////////////////////////////////////////////////////\n// Entity types\n\nexport interface GTMEntityCalendar_v1 {\n  type: \"calendar\";\n  id: string;\n\n  name: string;\n  description: string;\n\n  date_created: string;\n  date_modified: string;\n\n  time_zone: null | string;\n  owner: null | string;\n}\n\nexport interface GTMEntityDependency_v1 {\n  type: \"dependency\";\n  id: string;\n\n  date_created: string;\n\n  source_id: string;\n  target_id: string;\n}\n\nexport interface GTMEntityEvent_v1 {\n  type: \"event\";\n  id: string;\n  version: string;\n\n  calendar_id: string;\n\n  title: string;\n  description: string;\n\n  // Default value should be false\n  all_day: boolean;\n\n  date_start: string;\n  date_end: null | string;\n\n  reminders: unknown[];\n\n  repetition: null;\n\n  notifications: unknown[];\n\n  location: null | string;\n}\n\nexport interface GTMEntityLink_v1 {\n  type: \"link\";\n  id: string;\n\n  date_created: string;\n  date_modified: string;\n\n  source_id: string;\n  target_id: string;\n\n  data: any;\n}\n\nexport interface GTMEntityNote_v1 {\n  type: \"note\";\n  id: string;\n\n  title: string;\n  text: string;\n\n  date_created: string;\n  date_modified: string;\n}\n\nexport interface GTMEntityPoset_v1 {\n  type: \"poset\";\n  id: string;\n\n  date_created: string;\n  date_modified: string;\n}\n\nexport interface GTMEntityReminder_v1 {\n  type: \"reminder\";\n  id: string;\n\n  description: string;\n\n  date_created: string;\n  date_modified: string;\n\n  date_remind: string;\n\n  // Determines whether the user has been reminded.  By default it should be\n  // false.\n  done: boolean;\n}\n\nexport interface GTMEntityTag_v1 {\n  type: \"tag\";\n  id: string;\n\n  name: string;\n\n  date_created: string;\n  date_modified: string;\n}\n\nexport interface GTMEntityTask_v20 {\n  type: \"task\",\n  id: string,\n\n  title: string,\n  description: string,\n\n  date_created: string,\n  date_modified: string,\n\n  date_user_modified: string,\n\n  date_due: null | string,\n\n  date_opened: null | string,\n  date_done: null | string,\n  date_archived: null | string,\n  date_removed: null | string,\n\n  // References other tasks\n  dependencies: string[],\n  dependents: string[],\n\n  // Estimated time in milliseconds\n  estimated_time: null | number,\n\n  priority: number,\n  status: \"open\" | \"archived\" | \"removed\" | \"done\",\n\n  worktime: ([string] | [string, string])[],\n\n  tags: string[],\n\n  // Refers to `GTMEntityNote` elements.\n  comments: string[],\n}\n\n////////////////////////////////////////////////////////////////////////////////\n\nexport type GTMEntity_v20 = GTMEntityCalendar_v1 | GTMEntityDependency_v1 | GTMEntityEvent_v1 | GTMEntityLink_v1 | GTMEntityNote_v1 | GTMEntityPoset_v1 | GTMEntityReminder_v1 | GTMEntityTag_v1 | GTMEntityTask_v20;\n\n////////////////////////////////////////////////////////////////////////////////\n// GTM states\n\ninterface State_V_0_16_0 {\n  version: \"0.16.0\",\n  storage: {\n    graph: {\n      nodes: {\n        [id: string]: {\n          id: string,\n          type: string,\n          description: string,\n          dependencies: string[],\n          dependents: string[],\n          date_modified: string,\n          date_created: string,\n          date_user_modified: string,\n          date_done: null | string,\n          date_removed: null | string,\n          date_abandoned: null | string,\n          date_due: null | string,\n          time_estimated: null | number,\n          tags: string[],\n          priority: number,\n          status: \"open\" | \"done\" | \"removed\" | \"abandoned\",\n          worktime: string[][], // NOTE: not correct\n          comments: string[]\n        }\n      }\n    },\n    _next_id: number,\n    _work_task_id: null | string,\n    _work_task_active: boolean\n  }\n};\n\ninterface State_V_20 {\n  version: 20;\n  entities: {\n    [id: string]: GTMEntity_v20;\n  };\n\n  next_id: number;\n\n  // If the activity stack is empty, then it's OK to submit changes, otherwise\n  // it is in an intermediate state.\n  activity_stack: number[];\n\n  misc: {\n    active_task_ids: string[];\n  };\n};\n\ninterface GTMState_v20 {\n  version: 20,\n  entities: {\n    [id: string]: GTMEntity_v20,\n  },\n  next_id: number,\n  // If the activity stack is empty, then it's OK to submit changes, otherwise\n  // it is in an intermediate state.\n  activity_stack: number[],\n  misc: {\n    active_task_ids: string[],\n  },\n};\n\nexport interface GTMState_v21 {\n  version: 21,\n  entities: {\n    [id: string]: GTMEntity_v20,\n  },\n  next_id: number,\n  // Transaction is set with `Date.now()` before a GTM function is called and\n  // afterwards it is compared.\n  transaction: string,\n  misc: {\n    active_task_ids: string[],\n  },\n};\n\n// CHANGES\n// \n// * ID's are randomly generated, and ought to be unique.\n// * Each entity should generate a random ID.\n// * No more `state.next_id`.\n// * To begin with, each ID is random 128-bit number encoded in Base64 with the\n//   62nd key as `+` and the 63rd key as `/` and `=` as padding.  (I think \n//   `-` and `_` are better choices).  The 62nd is `-` and 63rd is `_` and the\n//   padding is `=` and is optional.\n// * \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\"\ninterface GTMState_v22 {\n  version: 22,\n  entities: {\n    [id: string]: GTMEntity_v20,\n  },\n  // Miscellaneous properties associated with `entities`.\n  misc: {\n    active_task_ids: string[],\n  },\n  // Transaction is set with `Date.now()` before a GTM function is called and\n  // afterwards it is compared.\n  transaction: string,\n  // A 1024-bit random string.  256-512 bits are reserved for generating \n  // private and public keys, and another 256-512 bits to generate symmetric\n  // keys.\n  token: string,\n}\n\n\n////////////////////////////////////////////////////////////////////////////////\n// Selected entity types\n\nexport interface GTMEntityDependency extends GTMEntityDependency_v1 { };\nexport interface GTMEntityEvent extends GTMEntityEvent_v1 { };\nexport interface GTMEntityLink extends GTMEntityLink_v1 { };\nexport interface GTMEntityNote extends GTMEntityNote_v1 { };\nexport interface GTMEntityPoset extends GTMEntityPoset_v1 { };\nexport interface GTMEntityReminder extends GTMEntityReminder_v1 { };\nexport interface GTMEntityTag extends GTMEntityTag_v1 { };\nexport interface GTMEntityTask extends GTMEntityTask_v20 { };\nexport interface GTMEntityCalendar extends GTMEntityCalendar_v1 { };\n\n////////////////////////////////////////////////////////////////////////////////\n// Selected entity\n\nexport type GTMEntity = GTMEntity_v20;\n\n////////////////////////////////////////////////////////////////////////////////\n// Selected state\n\nexport interface GTMState extends GTMState_v21 { };\n\n////////////////////////////////////////////////////////////////////////////////\n\nconst CURRENT_VERSION: GTMState[\"version\"] = 21;\n\n////////////////////////////////////////////////////////////////////////////////\n// Setup\n\n/**\n * Here it is assumed `state` might be a Proxy, but it doesn't have to be.\n * \n * @param state \n */\nexport function setup(state: any) {\n  assert(typeof state === \"object\" && state !== null, `${DEBUG_FILENAME}: setup(state): state must be an object and not null.`);\n\n  // Here we check to make sure whether the state has been properly set up.\n  if (verifyState(state)) return;\n\n  if (!hasOwnProperty(state, \"version\")) {\n    // State has not been set up.\n\n    // Make sure this is an \"empty\" object.\n    assert(Object.keys(state).length === 0);\n    applyNewState(getNewState(), state);\n    if (DEBUG) console.info(`${DEBUG_FILENAME}: setup(state): post-application of new state:`, { state, stateSnapshot: JSON.parse(JSON.stringify(state)) });\n    assert(verifyState(state), () => {\n      console.error({ state: JSON.parse(JSON.stringify(state)) });\n      return `${DEBUG_FILENAME}: setup(state): State verification failed!`;\n    });\n  } else {\n    const latest_version: GTMState[\"version\"] = 21;\n\n    if (state.version === latest_version) return;\n\n    // Start migrating...\n    const migratedState = migrate(state);\n\n\n    // Delete old keys\n    Object.keys(state).forEach((key) => {\n      if (key !== \"transaction\") {\n        delete (state as any)[key];\n      }\n    });\n\n    // Add new keys\n    Object.keys(migratedState).forEach((key) => {\n      if (key !== \"transaction\") {\n        (state as any)[key] = migratedState[key];\n      }\n    });\n  }\n}\n\nfunction applyNewState(newState: any, state: any, useTransaction = true) {\n  assert(typeof newState === \"object\" && newState !== null);\n  assert(typeof state === \"object\" && state !== null);\n\n  // Remove existing properties\n  Object.keys(state).forEach((key) => {\n    delete state[key];\n  });\n\n  let transactionValue;\n  if (useTransaction) {\n    delete newState[\"transaction\"];\n    transactionValue = beginTransaction(state);\n  }\n\n  // Set properties.\n  Object.keys(newState).forEach((key) => {\n    (state as any)[key] = (newState as any)[key];\n  });\n\n  if (useTransaction) {\n    endTransaction(state, transactionValue as string);\n  }\n}\n\n\nfunction verifyState_v20(state: any, full = false) {\n  if (!(typeof state === \"object\" && state !== null)) return false;\n\n  if (!hasOwnProperty(state, \"version\")) return false;\n  if (!(typeof state.version === \"number\")) return false;\n  if (!(state.version === 20)) return false;\n\n  if (!hasOwnProperty(state, \"entities\")) return false;\n  if (!(typeof state.entities === \"object\" && state.entities !== null)) return false;\n\n  if (!hasOwnProperty(state, \"next_id\")) return false;\n  if (!(typeof state.next_id === \"number\")) return false;\n\n  if (!(state.next_id > 0)) return false;\n\n  if (!hasOwnProperty(state, \"activity_stack\")) return false;\n  if (!(Array.isArray(state.activity_stack))) return false;\n\n  if (!hasOwnProperty(state, \"misc\")) return false;\n  if (!(typeof state.misc === \"object\" && state.misc !== null)) return false;\n\n  if (!hasOwnProperty(state.misc, \"active_task_ids\")) return false;\n  if (!(Array.isArray(state.misc.active_task_ids))) return false;\n\n  if (full) {\n    // TODO: verify each entity\n\n    // TODO: verify dependency structure\n\n    // TODO: verify that each entity's ID does not exceed next_id.\n  }\n\n  return true;\n}\n\nfunction verifyState_v21(state: any, full = false) {\n  if (!(typeof state === \"object\" && state !== null)) return false;\n\n  if (!hasOwnProperty(state, \"version\")) return false;\n  if (!(typeof state.version === \"number\")) return false;\n  if (!(state.version === 21)) return false;\n\n  if (!hasOwnProperty(state, \"entities\")) return false;\n  if (!(typeof state.entities === \"object\" && state.entities !== null)) return false;\n\n  if (!hasOwnProperty(state, \"next_id\")) return false;\n  if (!(typeof state.next_id === \"number\")) return false;\n\n  if (!(state.next_id > 0)) return false;\n\n  if (!hasOwnProperty(state, \"transaction\")) return false;\n  if (!(typeof state.transaction === \"string\")) return false;\n\n  if (!hasOwnProperty(state, \"misc\")) return false;\n  if (!(typeof state.misc === \"object\" && state.misc !== null)) return false;\n\n  if (!hasOwnProperty(state.misc, \"active_task_ids\")) return false;\n  if (!(Array.isArray(state.misc.active_task_ids))) return false;\n\n  if (full) {\n    // TODO: verify each entity\n\n    // TODO: verify dependency structure\n\n    // TODO: verify that each entity's ID does not exceed next_id.\n  }\n\n  return true;\n}\n\n/**\n * Verifies whether the state `state` is property set up.\n * \n * If `full` is set to `true` then \"intensive\" tests are made if available.\n * \n * @param state \n * @param full \n */\nexport function verifyState(state: any, full = false) {\n  if (!(typeof state === \"object\" && state !== null)) return false;\n\n  if (!hasOwnProperty(state, \"version\")) return false;\n  if (!(typeof state.version === \"number\")) return false;\n\n  if (state.version === 20) {\n    return verifyState_v20(state, full);\n  } else if (state.version === 21) {\n    return verifyState_v21(state, full);\n  } else {\n    return false;\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Entities\n\n/**\n * @param state \n * @param id \n * @throws If the entity with ID `task_id` is not of type `task` then an exception is raised.\n */\nexport function hasEntity(state: GTMState, id: string) {\n  if (!hasOwnProperty(state.entities, id)) return false;\n  return true;\n}\n\nexport function verifyEntity(state: GTMState, id: string) {\n  // TODO: if entity with ID does not exist, throw error!\n  throw new Error(\"Not implemented!\");\n}\n\n/**\n * \n * @param state \n * @param id \n * @throws throws error if task doesn't exist with given ID\n */\nexport function getEntity(state: GTMState, id: string) {\n  assert(hasOwnProperty(state.entities, id));\n  const entity = state.entities[id];\n  return entity;\n}\n\nexport function addEntity(state: GTMState, entity: GTMEntity_v20) {\n  assert(typeof entity === \"object\" && entity !== null);\n  assert(hasOwnProperty(entity, \"id\"));\n  assert(typeof entity.id === \"string\");\n  assert(entity.id !== \"\");\n  assert(!hasOwnProperty(state, entity.id));\n\n  state.entities[entity.id] = entity;\n}\n\nexport function removeEntity(state: GTMState, id: string) {\n  assert(hasOwnProperty(state.entities, id));\n  delete state.entities[id];\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Export and import\n\n/**\n * \n * If `json` is set to `true` then the export text will just be JSON.\n * \n * @param state \n * @param json \n */\nexport function doExport(state: GTMState, json=false) {\n  // TODO: we want to make sure that we don't lose any information exporting\n  // data.\n  if (json) {\n    return JSON.stringify(state);\n  } else {\n    return LZString.compressToBase64(JSON.stringify(state));  \n  }\n}\n\n/**\n * \n * @param state \n * @param import_value \n * @param json \n */\nexport function doImport(state: GTMState, import_value: string, json=false) {\n  let new_state: any;\n  let status = -1;\n\n  // Parse JSON\n  if (status === -1) {\n    try {\n      new_state = JSON.parse(import_value);\n      status = 0;\n    } catch (e) { }\n  }\n\n  // Decompress and then parse JSON\n  if (status === -1) {\n    try {\n      const decompressed_import_value = LZString.decompressFromBase64(import_value);\n      if (decompressed_import_value !== null) {\n        new_state = JSON.parse(decompressed_import_value);\n        status = 0;\n      }\n    } catch (e) { }\n  }\n\n  // Cannot import\n  if (status === -1) {\n    throw new Error(`Cannot import value: ${import_value}`);\n  }\n\n  assert(typeof new_state === \"object\" && new_state !== null);\n  assert(hasOwnProperty(new_state, \"version\"));\n\n  if (typeof new_state.version === \"string\") {\n    new_state = migrate(new_state);\n  } else if (typeof new_state.version === \"number\") {\n    if (new_state.version !== CURRENT_VERSION) {\n      new_state = migrate(new_state);\n    }\n  }\n\n  assert(typeof new_state === \"object\" && new_state !== null);\n  assert(hasOwnProperty(new_state, \"version\"));\n  assert(new_state.version === CURRENT_VERSION);\n\n  // Delete old keys\n  Object.keys(state).forEach((key) => {\n    if (key !== \"transaction\") {\n      delete (state as any)[key];\n    }\n  });\n\n  // Add new keys\n  Object.keys(new_state).forEach((key) => {\n    if (key !== \"transaction\") {\n      (state as any)[key] = new_state[key];\n    }\n  });\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Common things\n\n/**\n * This function is about to be deprecated!\n * \n * @param state \n */\nexport function getNextID(state: GTMState) {\n  const nextID = state.next_id;\n  state.next_id += 1;\n  return \"\" + nextID;\n}\n\n\n\nexport function getState(state: any): GTMState {\n  assert(verifyState(state, true));\n  return state;\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Transaction\n\nexport function beginTransaction(state: GTMState_v21) {\n  if (state.hasOwnProperty(\"transaction\")) {\n    assert(state.transaction === \"\" || (state.transaction.length > 0 && state.transaction[0] === \"(\"));\n  }\n\n\n  const value = \")\" + Date.now();\n\n  state.transaction = value;\n\n  return value;\n}\n\nexport function endTransaction(state: GTMState_v21, expectedValue: string) {\n  assert(state.hasOwnProperty(\"transaction\"));\n  assert(state.transaction.length > 0);\n  assert(state.transaction[0] === \")\");\n  assert(state.transaction === expectedValue);\n\n  const value = \"(\" + expectedValue;\n\n  state.transaction = value;\n\n  return value;\n}\n\n////////////////////////////////////////////////////////////////////////////////\n// Generate new states.\n\nfunction getNewState_v20() {\n  const new_state: State_V_20 = {\n    version: 20,\n    entities: {},\n    next_id: 1,\n    activity_stack: [],\n    misc: {\n      active_task_ids: [],\n    },\n  };\n  return new_state;\n}\n\nfunction getNewState_v21() {\n  const newState: GTMState_v21 = {\n    version: 21,\n    entities: {},\n    next_id: 1,\n    transaction: \"\",\n    misc: {\n      active_task_ids: [],\n    },\n  };\n\n  return newState;\n}\n\nfunction getNewState_v22() {\n  const newState: GTMState_v22 = {\n    version: 22,\n    entities: {},\n    misc: {\n      active_task_ids: [],\n    },\n    transaction: \"\",\n    token: \"\",\n  };\n\n  return newState;\n}\n\nconst getNewState = getNewState_v21;\n\n////////////////////////////////////////////////////////////////////////////////\n// Migration\n\nfunction migrate_from_v_0_16_0_to_v_20(oldState: State_V_0_16_0) {\n\n  function getNextID(state: State_V_20) {\n    const nextID = state.next_id\n    state.next_id += 1;\n    return \"\" + nextID;\n  }\n\n  const new_state = getNewState_v20();\n\n  // Update next ID\n  new_state.next_id = oldState.storage._next_id;\n  // Update tasks  \n\n  const old_task_ids = Object.keys(oldState.storage.graph.nodes);\n\n  const comments_changes = [];\n\n  for (let i = 0; i < old_task_ids.length; i++) {\n    const old_task_id = old_task_ids[i];\n    const old_task = oldState.storage.graph.nodes[old_task_id];\n\n    let new_status: string = old_task.status;\n    if (new_status === \"abandoned\") {\n      new_status = \"archived\";\n    }\n\n    comments_changes.push({\n      id: old_task_id,\n      comments: old_task.comments,\n    })\n\n    const new_task: GTMEntityTask_v20 = {\n      type: \"task\",\n      id: old_task_id,\n\n      title: \"\",\n      description: old_task.description,\n\n      date_created: old_task.date_created,\n      date_modified: old_task.date_modified,\n\n      date_due: old_task.date_due,\n\n      date_opened: null,\n      date_done: old_task.date_done,\n      date_archived: old_task.date_abandoned,\n      date_removed: old_task.date_removed,\n\n\n      dependencies: old_task.dependencies,\n      dependents: old_task.dependents,\n\n      // Estimated time in milliseconds\n      estimated_time: old_task.time_estimated,\n\n      priority: old_task.priority,\n\n      // @ts-ignore\n      status: new_status,\n\n      // @ts-ignore\n      worktime: old_task.worktime,\n\n      tags: old_task.tags,\n\n      // Refers to `note` elements.\n      comments: [],\n    };\n\n    // Need to add date_opened\n    if (old_task.status === \"open\") {\n      new_task.date_opened = new_task.date_created;\n    }\n\n    new_state.entities[new_task.id] = new_task;\n  }\n\n  // Add comments\n  for (const comments_change of comments_changes) {\n    // TODO: FIX!\n    const task_id = comments_change.id;\n    const entity = new_state.entities[task_id];\n    assert(entity.type === \"task\");\n    const task = entity;\n    const task_comments = comments_change.comments;\n\n\n    for (const task_comment of task_comments) {\n      const id = getNextID(new_state);\n\n      const note: GTMEntityNote_v1 = {\n        type: \"note\",\n        id,\n\n        title: \"\",\n        text: task_comment,\n\n        date_created: task.date_created,\n        date_modified: task.date_created,\n      };\n\n      new_state.entities[id] = note;\n    }\n  }\n\n  return new_state;\n}\n\nfunction migrate_from_v_20_to_v_21(oldState: GTMState_v20) {\n  assert(oldState.activity_stack.length === 0);\n\n  const newState = getNewState_v21();\n\n  newState.entities = oldState.entities;\n  newState.next_id = oldState.next_id;\n  newState.misc.active_task_ids = oldState.misc.active_task_ids;\n\n  return newState;\n}\n\nfunction migrate_from_v_21_to_v_22(oldState: GTMState_v21): GTMState_v22 {\n  if (Math.random() > -1) throw new Error(\"Not implemented!\");\n\n  const state = getNewState_v22();\n\n  // Copy from old state\n  state.entities = oldState.entities\n  state.misc.active_task_ids = oldState.misc.active_task_ids;\n  state.transaction = oldState.transaction;\n\n  const mapOldIDToNewID: { [oldID: string]: string } = {};\n\n  // Every single ID must be renamed\n  const generateID = () => {\n    if (Math.random() > -1) throw new Error(\"Not implemented!\");\n    return \"\";\n  };\n\n  const addToMap = (oldID: string) => {\n    if (!mapOldIDToNewID.hasOwnProperty(oldID)) {\n      mapOldIDToNewID[oldID] = generateID();\n    }\n  };\n\n  const getNewID = (oldID: string) => {\n    assert(mapOldIDToNewID.hasOwnProperty(oldID));\n    return mapOldIDToNewID[oldID];\n  };\n\n  // Walk over everything, gather IDs\n  Object.keys(state.entities).forEach((entity_id) => {\n    const entity = state.entities[entity_id];\n    addToMap(entity_id);\n    assert(entity.id === entity_id);\n    switch (entity.type) {\n      case \"calendar\":\n        break;\n      case \"dependency\":\n        assert(state.entities.hasOwnProperty(entity.source_id));\n        assert(state.entities.hasOwnProperty(entity.target_id));\n        addToMap(entity.source_id);\n        addToMap(entity.target_id);\n        break;\n      case \"event\":\n        assert(state.entities.hasOwnProperty(entity.calendar_id));\n        addToMap(entity.calendar_id);\n        break;\n      case \"link\":\n        assert(state.entities.hasOwnProperty(entity.source_id));\n        assert(state.entities.hasOwnProperty(entity.target_id));\n        addToMap(entity.source_id);\n        addToMap(entity.target_id);\n        break;\n      case \"note\":\n        break;\n      case \"poset\":\n        break;\n      case \"reminder\":\n        break;\n      case \"tag\":\n        break;\n      case \"task\":\n        Object.keys(entity.dependencies).forEach((dep_id) => {\n          assert(state.entities.hasOwnProperty(dep_id));\n          addToMap(dep_id);\n        });\n        Object.keys(entity.dependents).forEach((dep_id) => {\n          assert(state.entities.hasOwnProperty(dep_id));\n          addToMap(dep_id);\n        });\n        Object.keys(entity.comments).forEach((com_id) => {\n          assert(state.entities.hasOwnProperty(com_id));\n          addToMap(com_id);\n        });\n        break;\n      default:\n        throw new Error(`Unknown error!`);\n    }\n  });\n\n  const oldEntities = state.entities;\n\n  state.entities = {};\n\n  // Remap ALL IDs\n  Object.keys(oldEntities).forEach((oldEntityID) => {\n    const entity = oldEntities[oldEntityID];\n    const newEntityID = getNewID(oldEntityID);\n    state.entities[newEntityID] = entity;\n    entity.id = newEntityID;\n    switch (entity.type) {\n      case \"calendar\":\n        break;\n      case \"dependency\":\n        entity.source_id = getNewID(entity.source_id);\n        entity.target_id = getNewID(entity.target_id);\n        break;\n      case \"event\":\n        entity.calendar_id = getNewID(entity.calendar_id);\n        break;\n      case \"link\":\n        entity.source_id = getNewID(entity.source_id);\n        entity.target_id = getNewID(entity.target_id);\n        break;\n      case \"note\":\n        break;\n      case \"poset\":\n        break;\n      case \"reminder\":\n        break;\n      case \"tag\":\n        break;\n      case \"task\":\n        Object.keys(entity.dependencies).forEach((dep_id, idx) => {\n          entity.dependencies[idx] = getNewID(dep_id);\n        });\n        Object.keys(entity.dependents).forEach((dep_id, idx) => {\n          entity.dependents[idx] = getNewID(dep_id);\n        });\n        Object.keys(entity.comments).forEach((com_id, idx) => {\n          entity.dependents[idx] = getNewID(com_id);\n        });\n        break;\n      default:\n        throw new Error(`Unknown error!`);\n    }\n  });\n\n  state.misc.active_task_ids.forEach((id, idx) => {\n    state.misc.active_task_ids[idx] = getNewID(id);\n  });\n\n\n  return state;\n}\n\n/**\n * Takes an old state and returns a new state.\n * \n * @param state \n */\nfunction doMigrate(state: any) {\n  if (state.version === \"0.16.0\") {\n    return {\n      ok: true,\n      state: migrate_from_v_0_16_0_to_v_20(state)\n    };\n  } else if (state.version === 20) {\n    return {\n      ok: true,\n      state: migrate_from_v_20_to_v_21(state)\n    };\n  } else {\n    console.error(`Unknown state version: ${state.version}`);\n  }\n\n  return {\n    ok: false\n  };\n}\n\nexport function migrate(inputState: any) {\n  assert(typeof inputState === \"object\" && inputState !== null);\n  assert(hasOwnProperty(inputState, \"version\"));\n\n  // Remove proxies and other garbage.\n  let migratedState = JSON.parse(JSON.stringify(inputState));\n\n  if (inputState.version === CURRENT_VERSION) {\n    if (DEBUG) console.info(`migrate(): no need to migrate`);\n    return migratedState;\n  }\n\n  let ok = true;\n\n  while (ok && migratedState.version !== CURRENT_VERSION) {\n    if (DEBUG) console.info(`migrate(): migrating from version: ${migratedState.version}`);\n    const migrationResult = doMigrate(migratedState);\n\n    ok = migrationResult.ok;\n\n    if (DEBUG) console.info(`migrate(): migrating from version is ok?: ${ok}`);\n\n    if (migrationResult.ok) {\n      migratedState = migrationResult.state;\n    }\n  }\n\n  if (ok) {\n    return migratedState;\n  } else {\n    throw new Error(`Unable to migrate!`);\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////////\n","import { GTMState } from \"../gtm-lib-common\";\nimport { assert, hasOwnProperty } from \"../utils\";\n\nexport function createCalendar(state: GTMState) {\n  throw new Error(\"Not implemented!\");\n}\n\nexport function getCalendar(state: GTMState, id: string) {\n  assert(hasOwnProperty(state.entities, id));\n  const entity = state.entities[id];\n  assert(entity.type === \"calendar\");\n  return entity;\n}\n\nexport function verify(state: GTMState, id: string, full = false) {\n  // TODO: implement\n  return true;\n}\n","import { GTMState, GTMEntityDependency, getNextID } from \"../gtm-lib-common\";\nimport { assert, hasOwnProperty } from \"../utils\";\n\n// NOTE: don't use yet!\n\nexport function createDependency(state: GTMState, source_id: string, target_id: string) {\n  {\n    assert(state.entities.hasOwnProperty(source_id));\n    assert(state.entities.hasOwnProperty(target_id));\n\n    const source = state.entities[source_id];\n    const target = state.entities[target_id];\n\n    assert(source.type === \"task\");\n    assert(target.type === \"task\");\n  }\n\n  // TODO: try to look up dependency before creating a new one.\n\n  // Create new dependency\n  const id = getNextID(state);\n\n  const now_json = (new Date()).toJSON();\n\n  const dependency: GTMEntityDependency = {\n    type: \"dependency\",\n    id,\n\n    date_created: now_json,\n\n    source_id,\n    target_id,\n  };\n\n  // Add dependency to state\n  // state.entities[id] = dependency;\n\n  // Return dependency\n  return dependency;\n}\n\n\nexport function getDependency(state: GTMState, id: string) {\n  assert(hasOwnProperty(state.entities, id));\n  const entity = state.entities[id];\n  assert(entity.type === \"dependency\");\n  return entity;\n}\n\nexport function verify(state: GTMState, id: string, full = false) {\n  // TODO: implement\n  return true;\n}\n","import { GTMState } from \"../gtm-lib-common\";\nimport { assert, hasOwnProperty } from \"../utils\";\n\n\nexport function createEvent(state: GTMState) {\n  throw new Error(\"Not implemented!\");\n}\n\nexport function getEvent(state: GTMState, id: string) {\n  assert(hasOwnProperty(state.entities, id));\n  const entity = state.entities[id];\n  assert(entity.type === \"event\");\n  return entity;\n}\n\nexport function verify(state: GTMState, id: string, full = false) {\n  // TODO: implement\n  return true;\n}\n","import { GTMState } from \"../gtm-lib-common\";\nimport { assert, hasOwnProperty } from \"../utils\";\n\nexport function createLink(state: GTMState) {\n  throw new Error(\"Not implemented!\");\n}\n\nexport function getLink(state: GTMState, id: string) {\n  assert(hasOwnProperty(state.entities, id));\n  const entity = state.entities[id];\n  assert(entity.type === \"link\");\n  return entity;\n}\n\nexport function verify(state: GTMState, id: string, full = false) {\n  // TODO: implement\n  return true;\n}\n","/*\nSimple Note\n\nStores title, text and modification dates.\n*/\n\nimport { GTMEntityNote_v1 } from \"../gtm-lib-common\";\nimport { GTMState } from \"../gtm-lib-common\";\nimport { assert, hasOwnProperty } from \"../utils\";\nimport lib from \"../gtm-lib\";\n\nexport function createNote(state: GTMState, text = \"\") {\n  const id = lib.common.getNextID(state);\n\n  const now_json = (new Date()).toJSON();\n\n  const note: GTMEntityNote_v1 = {\n    type: \"note\",\n    id,\n\n    title: \"\",\n    text,\n\n    date_created: now_json,\n    date_modified: now_json,\n  };\n\n  lib.common.addEntity(state, note);\n\n  return note;\n}\n\nexport function changeText(state: GTMState, id: string, text: string) {\n  const note = getNote(state, id);\n\n  const now_json = (new Date()).toJSON();\n\n  note.text = text;\n  note.date_modified = now_json;\n}\n\nexport function getNote(state: GTMState, id: string) {\n  assert(hasOwnProperty(state.entities, id));\n  const entity = state.entities[id];\n  assert(entity.type === \"note\");\n  return entity;\n}\n\nexport function verify(state: GTMState, id: string, full = false) {\n  // TODO: implement\n  return true;\n}\n","/*\nPoset\n\nPoset, or partially ordered set.\n\nThe purpose of this entity was to group other entities, including other posets.\n\nThis was supposed to be a generalization of folders, and in fact, it works\nvery similarly to directed-acyclic graphs (DAGs) with the exception that there\nis only one root node, i.e. only one node that has no parents, and there's a\npath from this root node to all other nodes of the graph by only traversing \nthrough the children.\n*/\n\nimport { GTMState } from \"../gtm-lib-common\";\nimport { assert, hasOwnProperty } from \"../utils\";\n\nexport function createPoset(state: GTMState) {\n  throw new Error(\"Not implemented!\");\n}\n\nexport function getPoset(state: GTMState, id: string) {\n  assert(hasOwnProperty(state.entities, id));\n  const entity = state.entities[id];\n  assert(entity.type === \"poset\");\n  return entity;\n}\n\nexport function verify(state: GTMState, id: string, full = false) {\n  // TODO: implement\n  return true;\n}\n","import { GTMState } from \"../gtm-lib-common\";\nimport { assert, hasOwnProperty } from \"../utils\";\n\n\nexport function createReminder(state: GTMState) {\n  throw new Error(\"Not implemented!\");\n}\n\n\nexport function getReminder(state: GTMState, id: string) {\n  assert(hasOwnProperty(state.entities, id));\n  const entity = state.entities[id];\n  assert(entity.type === \"reminder\");\n  return entity;\n}\n\nexport function verify(state: GTMState, id: string, full = false) {\n  // TODO: implement\n  return true;\n}\n","/*\nTask (DAG)\n\nTasks whose dependencies form a directed acyclic graph (DAG).\n*/\n\nimport { GTMState, GTMEntityTask } from \"../gtm-lib-common\";\nimport lib from \"../gtm-lib\";\n\nimport {\n  assert,\n  hasOwnProperty,\n  getDurationISO8601InMS,\n} from \"../utils\";\n\n// * TODO: add ability to change order of dependencies AND dependents of a\n// given task.\n\n// TODO: make sure to set this to `false`!\nconst EXPERIMENTAL = false;\n\nconst ALLOWED_STATUSES: GTMEntityTask[\"status\"][] = [\"open\", \"archived\", \"removed\", \"done\"];\n\nexport function _verifyDependencyGraph(state: GTMState) {\n  \n  // m\n  // 0: unmarked\n  // 1: temporary mark\n  // 2: permanent mark\n\n  const UNMARKED = 2;\n  const TEMPORARY_MARK = 3;\n  const PERMANENT_MARK = 4;\n\n  const task_ids = Object.keys(state.entities).filter((id) => {\n    if (state.entities[id].type === \"task\") {\n      return true;\n    } else {\n      return false;\n    }\n  });\n\n  const graph: { [id: string]: { id: string, mark: typeof UNMARKED | typeof TEMPORARY_MARK | typeof PERMANENT_MARK, out: string[] } } = {};\n\n  task_ids.forEach((task_id) => {\n    const task = getTask(state, task_id);\n    graph[task_id] = {\n      // id\n      id: task_id,\n      // mark\n      mark: UNMARKED,\n      // out nodes\n      out: [...task.dependencies],\n    };\n  });\n\n  // ---------------------------------------------------------------------\n  // Topological sorting: depth-first search\n\n  const L: string[] = [];\n\n  let ok = true;\n\n  // i is node ID\n  function visit(id: string) {\n    if (!ok) return;\n\n    if (graph[id].mark === PERMANENT_MARK) return;\n\n    if (graph[id].mark === TEMPORARY_MARK) {\n      // NOT A DAG\n      ok = false;\n      return;\n    }\n\n    graph[id].mark = TEMPORARY_MARK;\n    for (let j = 0; j < graph[id].out.length && ok; j++) {\n      visit(graph[id].out[j]);\n    }\n    graph[id].mark = PERMANENT_MARK;\n    L.push(id);\n  }\n\n  for (let i = 0; i < task_ids.length && ok; i++) {\n    const node_id = task_ids[i];\n    if (graph[node_id].mark === UNMARKED) {\n      visit(node_id);\n    }\n  }\n\n  // L is now the nodes of graph topologically sorted :)\n  if (ok) L.reverse();\n\n  // ---------------------------------------------------------------------\n\n  return ok;\n}\n\nexport function _updateTask(state: GTMState, id: string) {\n  const task = getTask(state, id);\n  const now_json = (new Date()).toJSON();\n  task.date_modified = now_json;\n}\n\n\n/**\n * Checks whether these exists a path from `node_id_1` to `node_id_2` in the\n * dependencies.\n *\n * Let `node_id_1` be U and `node_id_2` be V.  Before adding the dependency\n * U -> V (U depends on V), check if there already exists a path from V to U,\n * if so then it will introduce a cycle (NOT ALLOWED IN DAGs), otherwise it\n * is fine.\n *\n * @param {string} node_id_from\n * @param {string} node_id_to\n *\n * @throws Will throw an error if node IDs `node_id_1` and `node_id_2` are not\n * found in the graph.\n */\nexport function doesPathThroughDependenciesExist(state: GTMState, task_from_id: string, task_to_id: string) {\n  // Check if path exists from `node_id_1` to `node_id_2`.\n  assert(typeof task_from_id === \"string\");\n  assert(typeof task_to_id === \"string\");\n\n  assert(isTask(state, task_from_id));\n  assert(isTask(state, task_to_id));\n\n  // Depth-first search\n  const S = new Set<string>();\n  const Q = [task_from_id];\n\n  while (Q.length > 0) {\n    const nid = Q.pop() as string;\n    if (nid === task_to_id) return true;\n    S.add(nid);\n    const t = getTask(state, nid);\n    const d = t.dependencies;\n    for (let i = 0; i < d.length; i++) if (!S.has(d[i])) Q.push(d[i]);\n  }\n\n  return false;\n}\n\n/**\n * Creates a new task\n * \n * @param state \n */\nexport function createTask(state: GTMState) {\n  const id = lib.common.getNextID(state);\n\n  const now_json = new Date().toJSON();\n\n  const task: GTMEntityTask = {\n    type: \"task\",\n    id: id,\n    title: \"\",\n    description: \"\",\n    date_created: now_json,\n    date_modified: now_json,\n    date_user_modified: now_json,\n    date_due: null,\n    date_opened: now_json,\n    date_done: null,\n    date_archived: null,\n    date_removed: null,\n    estimated_time: null,\n    dependencies: [],\n    dependents: [],\n    tags: [],\n    priority: 0,\n    status: \"open\",\n    worktime: [],\n    comments: [],\n  };\n\n  lib.common.addEntity(state, task);\n\n  return task;\n}\n\nexport function reorderDependents(state: GTMState, task_id: string, source_index: number, target_index: number) {\n  const task = getTask(state, task_id);\n\n  const list = task.dependents;\n\n  assert(list.length > 0);\n  assert(Number.isSafeInteger(source_index) && source_index >= 0 && source_index < list.length);\n  assert(Number.isSafeInteger(target_index) && target_index >= 0 && target_index < list.length);\n\n  const [removed] = list.splice(source_index, 1);\n  list.splice(target_index, 0, removed);\n\n  _updateTask(state, task_id);\n}\n\nexport function reorderDependencies(state: GTMState, task_id: string, source_index: number, target_index: number) {\n  const task = getTask(state, task_id);\n\n  const list = task.dependencies;\n\n  assert(list.length > 0);\n  assert(Number.isSafeInteger(source_index) && source_index >= 0 && source_index < list.length);\n  assert(Number.isSafeInteger(target_index) && target_index >= 0 && target_index < list.length);\n\n  const [removed] = list.splice(source_index, 1);\n  list.splice(target_index, 0, removed);\n\n  _updateTask(state, task_id);\n}\n\n\n/**\n * Makes task with ID `task_from_id` dependent on task with ID `task_to_id`.\n * \n * @param perm_storage \n * @param task_from_id \n * @param task_to_id \n */\nexport function addDependency(state: GTMState, task_from_id: string, task_to_id: string) {\n  const task_from = getTask(state, task_from_id);\n  const task_to = getTask(state, task_to_id);\n\n  const node_id_1 = task_from_id;\n  const node_id_2 = task_to_id;\n\n  assert(\n    !doesPathThroughDependenciesExist(state, node_id_2, node_id_1),\n    `Adding a dependency from node ${node_id_1} to ${node_id_2} will result in a cycle.`\n  );\n\n  const node_1 = task_from;\n  const node_2 = task_to;\n\n  assert(\n    !node_1.dependencies.includes(node_id_2),\n    \"Node 1 already has node 2 as a dependency.\"\n  );\n  assert(\n    !node_2.dependents.includes(node_id_1),\n    \"Node 2 already has node 1 as a dependency.\"\n  );\n\n  node_1.dependencies.push(node_id_2);\n  \n  if (EXPERIMENTAL) {\n    if (Math.random() > 0.5) {\n      throw new Error();\n    }\n  }\n  \n  node_2.dependents.push(node_id_1);\n\n  \n\n\n  _updateTask(state, node_id_1);\n  _updateTask(state, node_id_2);\n\n  const ok = _verifyDependencyGraph(state);\n\n\n  if (!ok) {\n    // UNDO\n    node_1.dependencies.pop();\n    node_2.dependents.pop();\n    throw new Error(\"SHOULD NOT HAPPEN\");\n  }\n}\n\n/**\n * Adds `task_2_id` as a dependent for `task_1_id`.\n * \n * @param perm_storage \n * @param task_1_id \n * @param task_2_id \n */\nexport function addDependent(state: GTMState, task_1_id: string, task_2_id: string) {\n  addDependency(state, task_2_id, task_1_id);\n}\n\n/**\n * Removes NODE_ID_2 as a dependency from NODE_ID_1\n * \n * @param perm_storage \n * @param node_id_1 \n * @param node_id_2 \n */\nexport function removeDependency(state: GTMState, node_id_1: string, node_id_2: string) {\n  const node_1 = getTask(state, node_id_1);\n  const node_2 = getTask(state, node_id_2)\n\n  const idx1 = node_1.dependencies.indexOf(node_id_2);\n  const idx2 = node_2.dependents.indexOf(node_id_1);\n\n  assert(idx1 >= 0);\n  assert(idx2 >= 0);\n\n  node_1.dependencies.splice(idx1, 1);\n  node_2.dependents.splice(idx2, 1);\n\n  assert(!node_1.dependencies.includes(node_id_2));\n  assert(!node_2.dependents.includes(node_id_1));\n\n  _updateTask(state, node_id_1);\n  _updateTask(state, node_id_2);\n}\n\n/**\n * Removes NODE_ID_2 as a dependent from NODE_ID_1\n * \n * @param perm_storage \n * @param node_id_1 \n * @param node_id_2 \n */\nexport function removeDependent(state: GTMState, task_1_id: string, task_2_id: string) {\n  removeDependency(state, task_2_id, task_1_id);\n}\n\nexport function removeComment(state: GTMState, task_id: string, comment_index: number) {\n  throw new Error(\"Not implemented!\");\n}\n\n/**\n * \n * @param perm_storage \n * @param task_id \n * @param comment \n * \n * @throws Raises exception if task doesn't exist.\n */\nexport function addComment(state: GTMState, task_id: string, comment = \"\") {\n  const task = getTask(state, task_id);\n\n  const note = lib.note.createNote(state, comment);\n  \n  task.comments.push(note.id);\n\n  _updateTask(state, task_id);\n}\n\nexport function getComment(state: GTMState, task_id: string, comment_index: number) {\n  const task = getTask(state, task_id);\n\n  assert(Number.isSafeInteger(comment_index));\n  assert(comment_index >= 0 && comment_index < task.comments.length);\n\n  const comment_id = task.comments[comment_index];\n\n  const note = lib.note.getNote(state, comment_id);\n\n  const comment = note.text;\n\n  return comment;\n}\n\nexport function changePriority(state: GTMState, task_id: string, priority: number) {\n  throw new Error(\"Not implemented!\");\n}\n\nexport function changeDueDate(state: GTMState, id: string, due_date: string) {\n  const task = getTask(state, id);\n\n  assert((\"\" + new Date(due_date)) !== \"Invalid Date\");\n\n  task.date_due = due_date;\n\n  _updateTask(state, id);\n}\n\nexport function removeDueDate(state: GTMState, id: string) {\n  const task = getTask(state, id);\n\n  task.date_due = null;\n\n  _updateTask(state, id);\n}\n\n\nexport function changeDescription(state: GTMState, task_id: string, description: string) {\n  const task = getTask(state, task_id);\n  \n  task.description = description;\n\n  _updateTask(state, task_id);\n}\n\nexport function changeComment(state: GTMState, task_id: string, comment_index: number, comment: string) {\n  const task = getTask(state, task_id);\n\n  assert(Number.isSafeInteger(comment_index));\n  assert(comment_index >= 0 && comment_index < task.comments.length);\n\n  const comment_id = task.comments[comment_index];\n\n  lib.note.changeText(state, comment_id, comment);\n  \n  _updateTask(state, task_id);\n}\n\n/**\n * Replaces `get_total_dependency_graph`\n * \n * @param perm_storage \n */\nexport function getDescendantIDs(state: GTMState) {\n  throw new Error(\"Not implemented!\");\n}\n\n/**\n * \n * TODO: check logic\n * \n * @param perm_storage \n * @param task_id \n */\nexport function getPossibleDependencyIDs(state: GTMState, task_id: string) {\n  const task = getTask(state, task_id);\n\n  const possible_dependencies: string[] = [];\n\n  Object.keys(state.entities).forEach((entity_id) => {\n    if (task_id !== entity_id && !task.dependencies.includes(entity_id)) {\n\n      // Check if that node is my ancestor (then it's impossible to add)\n      if (isTask(state, entity_id) && !lib.task.doesPathThroughDependenciesExist(state, entity_id, task_id)) {\n        possible_dependencies.push(entity_id);\n      }\n    }\n  });\n\n  if (true) {\n    // Final sanity check\n    assert(Array.isArray(possible_dependencies));\n    possible_dependencies.forEach((did) => {\n      assert(typeof did === \"string\");\n      assert(hasOwnProperty(state.entities, task_id));\n    });\n  }\n\n  return possible_dependencies;\n}\n\n/**\n * \n * TODO: check logic\n * \n * @param perm_storage \n * @param task_id \n */\nexport function getPossibleDependentIDs(state: GTMState, task_id: string) {\n  \n  const task = getTask(state, task_id);\n\n  const possible_dependents: string[] = [];\n\n  Object.keys(state.entities).forEach((entity_id) => {\n    if (task_id !== entity_id && !task.dependents.includes(entity_id)) {\n      // Check if that node is my ancestor (then it's impossible to add)\n      if (isTask(state, entity_id) && !lib.task.doesPathThroughDependenciesExist(state, task_id, entity_id)) {\n        possible_dependents.push(entity_id);\n      }\n    }\n  });\n\n  if (true) {\n    // Final sanity check\n    assert(Array.isArray(possible_dependents));\n    possible_dependents.forEach((did) => {\n      assert(typeof did === \"string\");\n      assert(hasOwnProperty(state.entities, task_id));\n    });\n  }\n\n  return possible_dependents;\n}\n\nexport function addTag(state: GTMState, task_id: string, node_id: string) {\n  throw new Error(\"Not implemented!\");\n}\n\nexport function removeTag(state: GTMState, task_id: string, tag: string) {\n  throw new Error(\"Not implemented!\");\n}\n\n\ntype ListTaskCriterionFilter = [\"filter\", ...any[]];\n\ntype ListTaskCriterionSort = [\"sort\", ...any[]];\n\ntype ListTaskCriterion = ListTaskCriterionFilter | ListTaskCriterionSort;\n\ntype ListTaskCriteria = ListTaskCriterion[];\n\n\n/**\n * TODO: Add some point reimplement filters and sorts\n */\nexport function listTaskIDs(state: GTMState, criteria?: ListTaskCriteria) {\n  \n  // Get all tasks\n  let tasks: GTMEntityTask[] = [];\n  Object.keys(state.entities).forEach((entity_id) => {\n    const entity = state.entities[entity_id];\n    if (entity.type === \"task\") {\n      tasks.push(entity);\n    }\n  });\n\n  if (typeof criteria !== \"undefined\") {\n    assert(Array.isArray(criteria));\n    for (let i = 0; i < criteria.length; i++) {\n      const criterion = criteria[i];\n      assert(Array.isArray(criterion) && criterion.length >= 1);\n\n      const criterion_type = criterion[0];\n      // [\"filter\", ...] or [\"sort\", ...]\n\n      if (criterion_type === \"filter\") {\n        for (let j = 1; j < criterion.length; j++) {\n          // [...]\n          const filter: any[] = criterion[j];\n          assert(Array.isArray(filter) && filter.length >= 1);\n\n          const filter_type = filter[0];\n\n          if (filter_type === \"roots\") {\n            tasks = tasks.filter((task) => {\n              return task.dependents.length === 0;\n            });\n          } else if (filter_type === \"leaves\") {\n            tasks = tasks.filter((task) => {\n              return task.dependencies.length === 0;\n            });\n          } else if (filter_type === \"possible-new-dependencies-of\") {\n            // [\"possible-new-dependencies-of\", TASK_ID]\n            assert(filter.length === 2);\n            const id = filter[1];\n            assert(typeof id === \"string\");\n            const ids = getPossibleDependencyIDs(state, id);\n            tasks = tasks.filter((task) => {\n              return ids.includes(task.id);\n            });\n          } else if (filter_type === \"dependencies-of\") {\n            // [\"dependencies-of\", TASK_ID]\n            assert(filter.length === 2);\n            const id = filter[1];\n            assert(typeof id === \"string\");\n            const ids = getTaskDependencyIDs(state, id);\n            tasks = tasks.filter((task) => {\n              return ids.includes(task.id);\n            });\n          } else if (filter_type === \"possible-new-dependents-of\") {\n            // [\"possible-new-dependents-of\", TASK_ID]\n            assert(filter.length === 2);\n            const id = filter[1];\n            assert(typeof id === \"string\");\n            const ids = getPossibleDependentIDs(state, id);\n            tasks = tasks.filter((task) => {\n              return ids.includes(task.id);\n            });\n          } else if (filter_type === \"dependents-of\") {\n            // [\"dependents-of\", TASK_ID]\n            assert(filter.length === 2);\n            const id = filter[1];\n            assert(typeof id === \"string\");\n            const ids = getTaskDependentIDs(state, id);\n            tasks = tasks.filter((task) => {\n              return ids.includes(task.id);\n            });\n          } else {\n            throw new Error(\"Unknown filter: \" + filter_type);\n          }\n        }\n      } else if (criterion_type === \"sort\") {\n        for (let j = 1; j < criterion.length; j++) {\n          // [...]\n          const sort: any[] = criterion[j];\n          assert(Array.isArray(sort) && sort.length >= 1);\n\n          const sort_type = sort[0];\n\n          if (sort_type === \"status\") {\n            // [\"status\", \"open\"]\n            // [\"status\", \"open\", \"closed\"]\n\n            const c = sort[sort.length - 1] === \"asc\" || sort[sort.length - 1] === \"desc\";\n            let n = sort.length;\n            if (c) {\n              n = sort.length - 1;\n            }\n\n            const dedup = new Set<string>();\n\n            for (let k = 1; k < n; k++) {\n              assert(ALLOWED_STATUSES.includes(sort[k]));\n              assert(!dedup.has(sort[k]));\n              dedup.add(sort[k]);\n            }\n\n            tasks.sort((a, b) => {\n              const a_i = sort.indexOf(a.status);\n              const b_i = sort.indexOf(b.status);\n\n              return a_i - b_i;\n            });\n\n            if (c) {\n              if (sort[sort.length - 1] === \"desc\") {\n                tasks.reverse();\n              }\n            }\n          } else if (sort_type === \"date_modified\") {\n            // [\"date_modified\"]\n            // [\"date_modified\", \"asc\"]\n            // [\"date_modified\", \"desc\"]\n            tasks.sort((a, b) => {\n              const t_a = (new Date(a.date_modified)).getTime();\n              const t_b = (new Date(b.date_modified)).getTime();\n              return t_a - t_b;\n            });\n\n            if (sort.length === 2) {\n              assert(sort[1] === \"asc\" || sort[1] === \"desc\");\n              if (sort[1] === \"desc\") {\n                tasks.reverse();\n              }\n            }\n          } else {\n            throw new Error(\"Unknown sort: \" + sort_type);\n          }\n        }\n      } else {\n        throw new Error(\"Unknown criterion: \" + criterion_type);\n      }\n    }\n  }\n\n  const task_ids = tasks.map((task) => { \n    return task.id;\n  });\n\n  return task_ids;\n}\n\nexport function listTasks(state: GTMState) {\n  // TODO: cache result\n  const tasks: GTMEntityTask[] = [];\n  Object.keys(state.entities).forEach((entity_id) => {\n    const entity = state.entities[entity_id];\n    if (entity.type === \"task\") {\n      tasks.push(entity);\n    }\n  });\n\n  return tasks;\n}\n\nexport function rewindTask(state: GTMState, task_id: string) {\n  throw new Error(\"Not implemented!\");\n}\n\nexport function getTaskSelfWorktime(state: GTMState, task_id: string) {\n  const task = getTask(state, task_id);\n\n  const worktime = task.worktime;\n\n  let duration = 0;\n\n  const json_now = (new Date()).toJSON();\n\n  for (let i = 0; i < worktime.length; i++) {\n    const wtu = worktime[i];\n    assert(wtu.length >= 1 && wtu.length <= 2);\n    let jt1, jt2;\n    if (wtu.length === 1) {\n      jt1 = wtu[0];\n      jt2 = json_now;\n    } else if (wtu.length === 2) {\n      jt1 = wtu[0];\n      jt2 = wtu[1];\n    } else {\n      throw new Error();\n    }\n\n    assert(typeof jt1 === \"string\", JSON.stringify(worktime));\n    assert(typeof jt2 === \"string\", JSON.stringify(worktime));\n    duration += getDurationISO8601InMS(jt1, jt2);\n  }\n\n  return duration;\n}\n\nexport function getTotalDependencyGraph(state: GTMState, task_id: string) {\n  assert(isTask(state, task_id));\n\n  const D = new Set<string>();\n  const Q = [task_id];\n\n  while (Q.length > 0) {\n    const tid = Q.shift() as string; // USE POP!\n    D.add(tid);\n\n    const task = getTask(state, tid);\n    task.dependencies.forEach((dependency) => {\n      Q.push(dependency);\n    });\n  }\n\n  // One cannot be one's own dependency.\n  D.delete(task_id);\n\n  return Array.from(D);\n}\n\nexport function getTaskTotalWorktime(state: GTMState, task_id: string) {\n  assert(isTask(state, task_id));\n  let duration = 0;  \n  duration += getTaskSelfWorktime(state, task_id);\n  \n  const d_ids = getTotalDependencyGraph(state, task_id);\n  d_ids.forEach((d_id) => {\n    duration += getTaskSelfWorktime(state, d_id);\n  });\n  return duration;\n}\n\nexport function removeTask(state: GTMState, task_id: string) {\n  // TODO: maybe do something more???\n  assert(isTask(state, task_id));\n  changeStatus(state, task_id, \"removed\");\n  _updateTask(state, task_id);\n}\n\n/**\n * Replaces `abandon_task`\n * \n * @param perm_storage \n */\nexport function archiveTask(state: GTMState) {\n  throw new Error(\"Not implemented!\");\n}\n\nexport function finishTask(state: GTMState, task_id: string) {\n  const task = getTask(state, task_id);\n  assert(task.status !== \"done\");\n  if (isTaskActive(state, task_id)) stopTask(state, task_id);\n  changeStatus(state, task_id, \"done\");\n  _updateTask(state, task_id);\n}\n\n/**\n * Replaces `reopen_task`.\n * \n * @param perm_storage \n */\nexport function openTask(state: GTMState, task_id: string) {\n  const task = getTask(state, task_id);\n  assert(task.status !== \"open\");\n  changeStatus(state, task_id, \"open\");\n}\n\nexport function deleteTask(state: GTMState, task_id: string) {\n  assert(isTask(state, task_id));\n\n  const task = getTask(state, task_id);\n\n  // ---------------------------------------------------------------------\n  // If the task is running, then stop it.\n\n  if (isTaskActive(state, task_id)) {\n    stopTask(state, task_id);\n  }\n\n  // ---------------------------------------------------------------------\n  // Remove all dependencies\n  \n  task.dependencies.forEach((dep_id) => {\n    removeDependency(state, task_id, dep_id);\n  });\n\n  // ---------------------------------------------------------------------\n  // Remove all dependents\n  task.dependents.forEach((dep_id) => {\n    removeDependent(state, task_id, dep_id);\n  });\n\n  // ---------------------------------------------------------------------\n  // Delete task\n  lib.common.removeEntity(state, task_id);\n\n  // ---------------------------------------------------------------------\n  // Checks\n\n  const is_ok = _verifyDependencyGraph(state);\n  if (!is_ok) {\n    throw new Error(\"Not ok!\");\n  }\n}\n\nexport function isTaskActive(state: GTMState, task_id: string) {\n  return state.misc.active_task_ids.includes(task_id);\n}\n\nexport function startTask(state: GTMState, task_id: string) {\n  const task = getTask(state, task_id);\n\n  // Make sure that the task is not tracked as active.\n  assert(!state.misc.active_task_ids.includes(task_id));\n\n  // Task has to be \"open\" so you can start it.\n  assert(task.status === \"open\");\n\n  state.misc.active_task_ids.push(task_id);\n\n  const now_json = new Date().toJSON();\n\n  task.worktime.push([now_json]);\n\n  _updateTask(state, task_id);\n}\n\nexport function stopTask(state: GTMState, task_id: string) {\n  const task = getTask(state, task_id);\n\n  assert(task.status === \"open\");\n\n  const index = state.misc.active_task_ids.indexOf(task_id);\n  assert(state.misc.active_task_ids.includes(task_id));\n\n  \n\n  assert(task.worktime.length > 0);\n  assert(task.worktime[task.worktime.length - 1].length === 1);\n\n  task.worktime[task.worktime.length - 1].push(new Date().toJSON());\n\n  _updateTask(state, task_id);\n\n  state.misc.active_task_ids.splice(index, 1);\n}\n\nexport function stopAllTasks(state: GTMState) {\n  state.misc.active_task_ids.forEach((task_id) => {\n    stopTask(state, task_id);\n  });\n}\n\n/**\n * \n * @param perm_storage \n * @param task_id \n * @param estimated_time Estimated time in milliseconds\n */\nexport function changeEstimatedTime(state: GTMState, task_id: string, estimated_time: number) {\n  const task = getTask(state, task_id);\n\n  assert(Number.isFinite(estimated_time) && estimated_time >= 0);\n\n  task.estimated_time = estimated_time;\n\n  _updateTask(state, task_id);\n}\n\nexport function removeEstimatedTime(state: GTMState, task_id: string) {\n  const task = getTask(state, task_id);\n\n  task.estimated_time = null;\n\n  _updateTask(state, task_id);\n}\n\nexport function getStatus(state: GTMState, task_id: string) {\n  const task = getTask(state, task_id);\n  return task.status;\n}\n\nexport function getSelfEstimatedTime(state: GTMState) {\n  throw new Error(\"Not implemented!\");\n}\n\nexport function getTotalEstimatedTime(state: GTMState) {\n  throw new Error(\"Not implemented!\");\n}\n\n/**\n * This function should NOT be exported, it should ONLY be called within this  \n * module.\n * \n * To change the status of a task you should do it through the functions,\n * * `openTask`\n * * `finishTask`\n * * `archiveTask`\n * * `removeTask`\n * \n * If the status is changed to the same status, an error is raised.\n * \n * @param state \n * @param id \n * @param status \n */\nfunction changeStatus(state: GTMState, id: string, status: GTMEntityTask[\"status\"]) {\n  const task = getTask(state, id);\n\n  assert(ALLOWED_STATUSES.includes(status));\n  const current_status = task.status;\n  assert(status !== current_status);\n\n  const json_now = (new Date()).toJSON();\n\n  if (current_status === \"open\") {\n    if (status === \"done\") task.date_done = json_now;\n    else if (status === \"removed\") task.date_removed = json_now;\n    else if (status === \"archived\") task.date_archived = json_now;\n    else throw new Error(\"Unknown status: \" + status);\n\n    task.date_opened = null;\n    task.status = status;\n  } else if (current_status === \"done\") {\n    if (status === \"open\") task.date_opened = json_now;\n    else if (status === \"removed\") task.date_removed = json_now;\n    else if (status === \"archived\") task.date_archived = json_now;\n    else throw new Error(\"Unknown status: \" + status);\n\n    task.date_done = null;\n    task.status = status;\n  } else if (current_status === \"removed\") {\n    if (status === \"open\") task.date_opened = json_now;\n    else if (status === \"done\") task.date_done = json_now;\n    else if (status === \"archived\") task.date_archived = json_now;\n    else throw new Error(\"Unknown status: \" + status);\n\n    task.date_opened = null;\n    task.status = status;\n  } else if (current_status === \"archived\") {\n    if (status === \"open\") task.date_opened = json_now;\n    else if (status === \"done\") task.date_done = json_now;\n    else if (status === \"removed\") task.date_removed = json_now;\n    else throw new Error(\"Unknown status: \" + status);\n\n    task.date_archived = null;\n    task.status = status;\n  } else throw new Error(\"Unknown current status: \" + current_status);\n\n  _updateTask(state, id);\n}\n\nexport function getActiveTaskIDs(state: GTMState) {\n  return state.misc.active_task_ids;\n}\n\nexport function getTaskDependentIDs(state: GTMState, id: string) {\n  const task = getTask(state, id);\n  return task.dependents;\n}\n\nexport function getTaskDependencyIDs(state: GTMState, id: string) {\n  const task = getTask(state, id);\n  return task.dependencies;\n}\n\n/**\n * \n * @param perm_storage \n */\nexport function getActiveTasks(state: GTMState) {\n  return state.misc.active_task_ids.map((id) => {\n    return getTask(state, id);\n  });\n}\n\nexport function hasDueDate(state: GTMState, id: string) {\n  const task = getTask(state, id);\n  return task.date_due !== null;\n}\n\nexport function getDueDate(state: GTMState, id: string) {\n  const task = getTask(state, id);\n  return task.date_due;\n}\n\nexport function isOpen(state: GTMState, id: string) {\n  const task = getTask(state, id);\n  return task.status === \"done\";\n}\n\nexport function isDone(state: GTMState, id: string) {\n  const task = getTask(state, id);\n  return task.status === \"done\";\n}\n\nexport function getDateDone(state: GTMState, id: string) {\n  const task = getTask(state, id);\n  return task.date_done;\n}\n\nexport function isRemoved(state: GTMState, id: string) {\n  const task = getTask(state, id);\n  return task.status === \"removed\";\n}\n\nexport function getDateRemoved(state: GTMState, id: string) {\n  const task = getTask(state, id);\n  return task.date_removed;\n}\n\nexport function isArchived(state: GTMState, id: string) {\n  const task = getTask(state, id);\n  return task.status === \"archived\";\n}\n\nexport function getDateArchived(state: GTMState, id: string) {\n  const task = getTask(state, id);\n  return task.date_archived;\n}\n\nexport function hasEstimatedTime(state: GTMState, id: string) {\n  const task = getTask(state, id);\n  return task.estimated_time !== null;\n}\n\n/**\n * \n * @param state \n * @param id \n */\nexport function getEstimatedTime(state: GTMState, id: string) {\n  const task = getTask(state, id);\n  const estimated_time = task.estimated_time;\n  return estimated_time;\n}\n\n/**\n * @param state \n * @param id \n * @throws If the entity with ID `task_id` is not of type `task` then an exception is raised.\n */\nexport function isTask(state: GTMState, id: string) {\n  if (!hasOwnProperty(state.entities, id)) return false;\n  const entity = state.entities[id];\n  if (entity.type === \"task\") return true;\n  else return false;\n}\n\n/**\n * @param state \n * @param id \n * @throws If the entity with ID `task_id` is not of type `task` then an exception is raised.\n */\nexport function hasTask(state: GTMState, id: string) {\n  if (!hasOwnProperty(state.entities, id)) return false;\n  const entity = state.entities[id];\n  if (entity.type === \"task\") return true;\n  else return false;\n}\n\n/**\n * Retrieves the task with ID `id` in state `state`.\n * \n * If an entity with that ID doesn't exist or that entity exist but is not of\n * type `\"task\"` then an exception is raised.\n * \n * @param state \n * @param id \n * @throws throws error if task doesn't exist with given ID\n */\nexport function getTask(state: GTMState, id: string) {\n  assert(hasOwnProperty(state.entities, id));\n  const entity = state.entities[id];\n  assert(entity.type === \"task\");\n  return entity;\n}\n\nexport function verify(state: GTMState, id: string, full = false) {\n  // TODO: implement\n  return true;\n}\n","import * as common from \"./gtm-lib-common\";\n\n// Entities\nimport * as calendar from \"./entity/calendar\";\nimport * as dependency from \"./entity/dependency\";\nimport * as event from \"./entity/event\";\nimport * as link from \"./entity/link\";\nimport * as note from \"./entity/note\";\nimport * as poset from \"./entity/poset\";\nimport * as reminder from \"./entity/reminder\";\nimport * as task from \"./entity/task\";\n\nexport const lib = {\n  common,\n\n  // Entities\n  calendar,\n  dependency,\n  event,\n  link,\n  note,\n  poset,\n  reminder,\n  task,\n};\n\nexport default lib;\n","import { createStorka, StorkaEvent } from \"../gtm-storage/storka\";\nimport { assert } from \"../utils-ui\";\nimport { lib } from \"./gtm-lib\";\n\n\nexport type GTMApp = ReturnType<typeof createGTMApp>;\n\n/**\n * The input state `inputState` might be a regular object or a proxy of an\n * object.\n * \n * @param inputState \n */\nfunction createGTMApp(inputState: any) {\n  const _this = null;\n\n  assert(typeof inputState === \"object\" && inputState !== null);\n\n  // Proxy might be empty\n  if (!lib.common.verifyState(inputState, true)) lib.common.setup(inputState);\n\n  const state = inputState;\n\n  /**\n   * Wraps GTM function `fn` such that it is not transactional, i.e. does\n   * nothing but makes it explicit.\n   * \n   * @param fn \n   */\n  const wrapNonTransaction = <A extends Array<any>, R>(fn: (...args: A) => R) => {\n    return fn;\n  }; \n\n  /**\n   * Wraps GTM function `fn` such that it becomes transactional, i.e. changes\n   * we keep track of when we start the transaction and end it when it comes\n   * to changing state `state`.\n   * \n   * This is mainly used by Storka.\n   * \n   * @param fn \n   */\n  const wrapTransaction = <T extends Array<any>, U>(fn: (...args: T) => U) => {\n    return (...args: T): U => {\n      const transactionValue = lib.common.beginTransaction(state);\n      const result = fn(...args);\n      lib.common.endTransaction(state, transactionValue);\n      return result;\n    };\n  };\n\n  // TODO: find a better way to do this\n  const app = {\n    calendar: {\n      // Non-transactional\n      getCalendar: wrapNonTransaction(lib.calendar.getCalendar.bind(_this, state)),\n\n      // Transactional\n    },\n    common: {\n      // Non-transactional\n      doExport: wrapNonTransaction(lib.common.doExport.bind(_this, state)),\n\n      // Transactional\n      doImport: wrapTransaction(lib.common.doImport.bind(_this, state)),\n    },\n    dependency: {},\n    event: {},\n    link: {},\n    note: {\n      // Non-transactional\n      getNote: wrapNonTransaction(lib.note.getNote.bind(_this, state)),\n\n      // Transactional\n      changeText: wrapTransaction(lib.note.changeText.bind(_this, state)),\n      createNote: wrapTransaction(lib.note.createNote.bind(_this, state)),\n    },\n    poset: {},\n    reminder: {},\n    task: {\n      // Non-transactional\n      getActiveTaskIDs: wrapNonTransaction(lib.task.getActiveTaskIDs.bind(_this, state)),\n      getActiveTasks: wrapNonTransaction(lib.task.getActiveTasks.bind(_this, state)),\n      getDescendantIDs: wrapNonTransaction(lib.task.getDescendantIDs.bind(_this, state)),\n      getPossibleDependencyIDs: wrapNonTransaction(lib.task.getPossibleDependencyIDs.bind(_this, state)),\n      getPossibleDependentIDs: wrapNonTransaction(lib.task.getPossibleDependentIDs.bind(_this, state)),\n      getSelfEstimatedTime: wrapNonTransaction(lib.task.getSelfEstimatedTime.bind(_this, state)),\n      getTask: wrapNonTransaction(lib.task.getTask.bind(_this, state)),\n      getTaskDependencyIDs: wrapNonTransaction(lib.task.getTaskDependencyIDs.bind(_this, state)),\n      getTaskDependentIDs: wrapNonTransaction(lib.task.getTaskDependentIDs.bind(_this, state)),\n      getTaskSelfWorktime: wrapNonTransaction(lib.task.getTaskSelfWorktime.bind(_this, state)),\n      getTaskTotalWorktime: wrapNonTransaction(lib.task.getTaskTotalWorktime.bind(_this, state)),\n      getTotalDependencyGraph: wrapNonTransaction(lib.task.getTotalDependencyGraph.bind(_this, state)),\n      getTotalEstimatedTime: wrapNonTransaction(lib.task.getTotalEstimatedTime.bind(_this, state)),\n      isTask: wrapNonTransaction(lib.task.isTask.bind(_this, state)),\n      isTaskActive: wrapNonTransaction(lib.task.isTaskActive.bind(_this, state)),\n      listTaskIDs: wrapNonTransaction(lib.task.listTaskIDs.bind(_this, state)),\n      listTasks: wrapNonTransaction(lib.task.listTasks.bind(_this, state)),\n      getComment: wrapNonTransaction(lib.task.getComment.bind(_this, state)),\n      hasDueDate: wrapNonTransaction(lib.task.hasDueDate.bind(_this, state)),\n      getDueDate: wrapNonTransaction(lib.task.getDueDate.bind(_this, state)),\n      isDone: wrapNonTransaction(lib.task.isDone.bind(_this, state)),\n      getDateDone: wrapNonTransaction(lib.task.getDateDone.bind(_this, state)),\n      isRemoved: wrapNonTransaction(lib.task.isRemoved.bind(_this, state)),\n      getDateRemoved: wrapNonTransaction(lib.task.getDateRemoved.bind(_this, state)),\n      isArchived: wrapNonTransaction(lib.task.isArchived.bind(_this, state)),\n      getDateArchived: wrapNonTransaction(lib.task.getDateArchived.bind(_this, state)),\n      hasEstimatedTime: wrapNonTransaction(lib.task.hasEstimatedTime.bind(_this, state)),\n      getEstimatedTime: wrapNonTransaction(lib.task.getEstimatedTime.bind(_this, state)),\n      isOpen: wrapNonTransaction(lib.task.isOpen.bind(_this, state)),\n\n      hasTask: wrapNonTransaction(lib.task.hasTask.bind(_this, state)),\n\n      // Transactional\n      addComment: wrapTransaction(lib.task.addComment.bind(_this, state)),\n      addDependency: wrapTransaction(lib.task.addDependency.bind(_this, state)),\n      addDependent: wrapTransaction(lib.task.addDependent.bind(_this, state)),\n      addTag: wrapTransaction(lib.task.addTag.bind(_this, state)),\n      archiveTask: wrapTransaction(lib.task.archiveTask.bind(_this, state)),\n      changeComment: wrapTransaction(lib.task.changeComment.bind(_this, state)),\n      changeDescription: wrapTransaction(lib.task.changeDescription.bind(_this, state)),\n      changeDueDate: wrapTransaction(lib.task.changeDueDate.bind(_this, state)),\n      changeEstimatedTime: wrapTransaction(lib.task.changeEstimatedTime.bind(_this, state)),\n      changePriority: wrapTransaction(lib.task.changePriority.bind(_this, state)),\n      createTask: wrapTransaction(lib.task.createTask.bind(_this, state)),\n      deleteTask: wrapTransaction(lib.task.deleteTask.bind(_this, state)),\n      finishTask: wrapTransaction(lib.task.finishTask.bind(_this, state)),\n      openTask: wrapTransaction(lib.task.openTask.bind(_this, state)),\n      removeComment: wrapTransaction(lib.task.removeComment.bind(_this, state)),\n      removeDependency: wrapTransaction(lib.task.removeDependency.bind(_this, state)),\n      removeDependent: wrapTransaction(lib.task.removeDependent.bind(_this, state)),\n      removeDueDate: wrapTransaction(lib.task.removeDueDate.bind(_this, state)),\n      removeEstimatedTime: wrapTransaction(lib.task.removeEstimatedTime.bind(_this, state)),\n      removeTag: wrapTransaction(lib.task.removeTag.bind(_this, state)),\n      removeTask: wrapTransaction(lib.task.removeTask.bind(_this, state)),\n      rewindTask: wrapTransaction(lib.task.rewindTask.bind(_this, state)),\n      startTask: wrapTransaction(lib.task.startTask.bind(_this, state)),\n      stopAllTasks: wrapTransaction(lib.task.stopAllTasks.bind(_this, state)),\n      stopTask: wrapTransaction(lib.task.stopTask.bind(_this, state)),\n      reorderDependents: wrapTransaction(lib.task.reorderDependents.bind(_this, state)),\n      reorderDependencies: wrapTransaction(lib.task.reorderDependencies.bind(_this, state)), \n    }\n  };\n\n  return app;\n}\n\n\n/**\n * Creates a GTM \"native\" application (horrible name) using IndexedDB database\n * `database_name` as its backend.\n * \n * @param database_name \n */\nexport async function getGTMNativeApp(database_name: string) {\n  // database_name\n  const storka = createStorka(database_name, { transactional: true });\n\n  // Wait for `storka` to become ready.\n  await (new Promise((resolve, reject) => {\n    storka.addEventListener(\"ready\", (evt) => {\n      resolve();\n    });\n  }));\n\n  // Add event listeners to listen for start of transactions.\n  storka.addEventListener(\"beforeaddchange\", (evt: StorkaEvent) => {\n    assert(evt.type === \"beforeaddchange\"); // TODO: fix in the future\n    const { change } = evt;\n    if (change.type === \"set\") {\n      if (change.jsonPointer === \"/transaction\" && change.value[0] === \")\") {\n        // Begin a transaction\n        storka.beginTransaction();\n      }\n    }\n  });\n\n  // Add event listeners to listen for end of transactions.\n  storka.addEventListener(\"afteraddchange\", (evt: StorkaEvent) => {\n    assert(evt.type === \"afteraddchange\"); // TODO: fix in the future\n    const { change } = evt;\n\n    if (change.type === \"set\") {\n      if (change.jsonPointer === \"/transaction\" && change.value[0] === \"(\") {\n        // End a transaction\n        storka.endTransaction();\n      }\n    }\n  });\n\n  const object = storka.object;\n  const proxy = storka.proxy;\n\n  assert(typeof proxy === \"object\" && proxy !== null);\n  assert(typeof object === \"object\" && object !== null);\n\n  // TODO: remove when not debugging\n  if (true) {\n    (window as any).state_proxy = proxy;\n    (window as any).state = object;  \n  }\n\n  lib.common.verifyState(proxy);\n\n  const app = createGTMApp(proxy);\n\n  return app;\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from \"./App\";\n\nimport { createNavi } from './navi';\nimport { getGTMNativeApp } from \"./gtm-app/gtm\";\n\nimport \"./index.css\";\n\n\nasync function main() {\n  const database_name = \"testdb\";\n  const gtm = await getGTMNativeApp(database_name);\n  (window as any).gtm = gtm;\n\n  const navi = createNavi(\"gtm:/home\");\n\n  ReactDOM.render((\n    <App navi={navi} gtm={gtm} />\n  ), document.getElementById('root'));\n}\n\n\nmain().catch((reason) => {\n  console.error((reason));\n  throw new Error(reason);\n});\n\n"],"sourceRoot":""}