"use strict";(()=>{var M=Object.defineProperty;var R=(e,n)=>{for(var i in n)M(e,i,{get:n[i],enumerable:!0})};var E={};R(E,{create_report_message:()=>re,delay_sample_point:()=>ue,delay_sample_value:()=>ee,forget:()=>se,infer_concrete_type:()=>Z,report:()=>le,sample_point:()=>te,sample_value:()=>A,sampled_values:()=>m,turn_type_into_typescript:()=>$});function y(e,n=""){if(!e)throw n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"?new Error(`Assertion failed: ${n}`):typeof n=="function"?(n(),new Error("Assertion failed!")):(console.error("Assertion failed:",n),new Error("Assertion failed!"))}function N(e){if(e==null)throw new Error(`Unwrapping violation, value was: ${e}`);return e}function W(e){throw new Error("Exhaustive check violated!")}function q(){throw new Error("Unreachable!")}var m=new Map,I=(()=>{let e=/^[_$A-Za-z]([_$A-Za-z0-9])*$/;function n(i){return i.match(e)!==null}return n})();function B(e=""){throw new Error(`Need to implement: ${e}`)}function x(e){if(e.type==="undefined")return 10;if(e.type==="null")return 20;if(e.type==="undetermined")return 30;if(e.type==="boolean")return 40;if(e.type==="number")return 50;if(e.type==="string")return 60;if(e.type==="selfref")return 70;if(e.type==="function")return 80;if(e.type==="tuple")return 90;if(e.type==="array")return 100;if(e.type==="objectunknown")return 110;if(e.type==="object")return 120;if(e.type==="builder")return 130;if(e.type==="intersection")return 140;if(e.type==="union")return 150;W(e)}function k(){return{type:"undetermined"}}function J(){return{type:"selfref"}}function T(){return{type:"undefined"}}function P(){return{type:"null"}}function D(){return{type:"boolean"}}function G(){return{type:"number"}}function H(){return{type:"string"}}function d(e){let n=[];{let s=function(p){if(p.type==="union")for(let l of p.value)s(l);else["undetermined","selfref","undefined","null","boolean","number","string","objectunknown"].includes(p.type)?r.has(p.type)||(r.add(p.type),n.push(p)):n.push(p)};var i=s;let r=new Set;for(let p of e)s(p)}{let r=[],s=[],p=[];for(let t=0;t<n.length;t++){let f=n[t];f.type==="tuple"?f.strict?s.push(f):p.push(f):r.push(f)}let l=[];if(s.length>0){let t=s[0];y(t.strict===!0);for(let f=1;f<s.length;f++){let u=s[f];if(y(u.strict===!0),t.value.length===u.value.length)for(let o=0;o<t.value.length;o++){let a=h(t.value[o],u.value[o]);t.value[o]=a}else{let o,a;t.value.length<u.value.length?(o=t,a=u):(o=u,a=t),y(o.value.length<a.value.length,`Tuple a was expected to be larger than tuple b: ${o.value.length} vs ${a.value.length}`),y(o.strict===!0),y(a.strict===!0);let c=[];for(let g=0;g<o.value.length;g++)c.push(h(o.value[g],a.value[g]));for(let g=o.value.length;g<a.value.length;g++)c.push(h(T(),a.value[g]));let _=V(c,!0);y(_.strict===!0),t=_}}y(t.type==="tuple"),y(t.strict===!0),l.push(t)}if(p.length>0){let t=p[0];y(t.strict===!1);for(let f=1;f<p.length;f++){let u=p[f];if(y(u.strict===!1),t.type==="tuple")if(t.value.length===u.value.length){for(let o=0;o<t.value.length;o++){let a=h(t.value[o],u.value[o]);t.value[o]=a}return t}else{let o=[];y(t.strict===!1),y(u.strict===!1);for(let c of t.value)o.push(c);for(let c of u.value)o.push(c);y(o.length>0);let a=o[0];for(let c=1;c<o.length;c++)a=h(a,o[c]);t=b(a)}else if(u.value.length>0){let o=[];for(let c of u.value)o.push(c);let a=t.value;for(let c=0;c<o.length;c++)a=h(a,o[c]);t.value=a}}l.push(t)}n=[...r,...l]}{let r=[],s=[];for(let l=0;l<n.length;l++){let t=n[l];t.type==="tuple"?t.strict?r.push(t):s.push(t):t.type==="array"?s.push(t):r.push(t)}let p=[];if(s.length>0){let l=s[0];for(let t=1;t<s.length;t++){let f=s[t];if(l.type==="tuple"){if(y(!l.strict),f.type==="tuple")if(y(!f.strict),l.value.length===f.value.length)for(let u=0;u<l.value.length;u++)l.value[u]=h(l.value[u],f.value[u]);else{let u=[];for(let a of l.value)u.push(a);for(let a of f.value)u.push(a);y(u.length>0);let o=u[0];for(let a=1;a<u.length;a++)o=h(o,u[a]);l=b(o)}else if(f.type==="array")if(l.value.length>0){let u=f.value;for(let o=0;o<l.value.length;o++)u=h(u,l.value[o]);f.value=u,l=f}else l=f}else if(l.type==="array")if(f.type==="tuple"){if(y(!f.strict),f.value.length>0){let u=l.value;for(let o=0;o<f.value.length;o++)u=h(u,f.value[o]);l.value=u}}else f.type==="array"&&(l.value=h(l.value,f.value))}p.push(l)}n=[...r,...p]}{let r=[],s=[];for(let l of n)l.type==="object"?r.push(l):s.push(l);let p=[];if(r.length>0){let l=r[0];for(let t=1;t<r.length;t++)l=h(l,r[t]);p.push(l)}n=[...s,...p]}{let r=[],s=new Map,p=new Set;for(let t of n)t.type==="builder"?s.has(t.value)||s.set(t.value,t):(t.type==="intersection"&&p.add(t.value[0].value),r.push(t));for(let t of p)s.delete(t);let l=[...s.values()];n=[...r,...l]}{let r=[],s=[];for(let t of n)t.type==="intersection"?r.push(t):s.push(t);r.sort((t,f)=>t.value[0].value.localeCompare(f.value[0].value));let p=[],l=new Map;for(let t of r){let f=t.value[0].value;l.hasOwnProperty(f)||l.set(f,[]),N(l.get(f)).push(t)}for(let t of l.values()){y(t.length>0);let f=t[0];for(let u=1;u<t.length;u++){let o=t[u];y(f.value[0].value===o.value[0].value);let a=h(f,o);y(a.type==="intersection"),f=a}p.push(f)}n=[...s,...p]}{let r=[],s=[];for(let l of n)l.type==="function"?r.push(l):s.push(l);r.sort((l,t)=>l.number_of_arguments-t.number_of_arguments);let p=[];{let l=null;for(let t=0;t<r.length;t++){let f=r[t];l===null?l=f:l.number_of_arguments!==f.number_of_arguments&&(p.push(l),l=f)}l!==null&&(p.push(l),l=null)}n=[...s,...p]}if(y(n.length>=1),n.sort((r,s)=>{let p=x(r),l=x(s);return p-l}),n.length===1){let r=n[0];return y(r.hasOwnProperty("type")),r}else return{type:"union",value:n}}function K(e){return y(e.length===2),y(e[0].type==="builder"),{type:"intersection",value:e}}function V(e,n=!1){return{type:"tuple",value:e,strict:n}}function b(e){return{type:"array",value:e}}function O(e){let n={};for(let i of e){let[r,s]=i;n[r]=s}return{type:"object",value:n}}function L(){return{type:"objectunknown"}}function S(e,n){let i=[];for(let r=0;r<e;r++)i.push(`p${r+1}`);if(n!==void 0)for(let r=0;r<n.length;r++)i[r]=n[r];return{type:"function",number_of_arguments:e,parameter_names:i}}function j(e){return{type:"builder",value:e}}var Q=/^[A-Z]/,X=/\((?<params>\s*\w+(,\s*\w+)*)\)/;function Y(e){return e===null?!1:typeof e=="object"?!0:typeof e=="function"}function U(e){let i=(""+e).match(X);if(i!==null){let r=i.groups;if(r!==void 0){let s=r.params;return typeof s!="string"?void 0:s.split(",").map(l=>l.trim())}else return}else return}function Z(e,n){let i=[];function r(p,l,t){let f=Y(p);if(f){if(i.includes(p))return J();i.push(p)}let u;if(p===void 0)u=T();else if(p===null)u=P();else if(typeof p=="boolean")u=D();else if(typeof p=="number")u=G();else if(typeof p=="string")u=H();else if(Object.prototype.toString.call(p)==="[object Arguments]"){if(l>=t)return f&&i.pop(),b(k());let o=[];for(let a=0;a<p.length;a++){let c=p[a];o.push(r(c,l+1,t))}u=V(o,!0)}else if(Array.isArray(p)){if(l>=t)return f&&i.pop(),b(k());if(n&&n.experimentalInterpretArrayAsArray)if(p.length===0)u=b(k());else{let o=[];for(let c of p)o.push(r(c,l+1,t));let a=o[0];for(let c=1;c<o.length;c++)a=h(a,o[c]);u=b(a)}else{let o=[];for(let a of p)o.push(r(a,l+1,t));u=V(o,!1)}}else if(typeof p=="function")if(p.name)if(p.name.match(Q)!==null)u=j(p.name);else{let o=U(p);u=S(p.length,o)}else{let o=U(p);u=S(p.length,o)}else{let o="";if(p&&p.constructor&&(o=p.constructor.name),l>=t)return f&&i.pop(),o==="Object"?L():j(o);if(["Object"].includes(o)){let a=Object.keys(p);a.sort();let c=[];for(let _ of a){let g=p[_],w=r(g,l+1,t);c.push([_,w])}u=O(c)}else{let a=Object.keys(p);a.sort();let c=[];for(let g of a){let w=p[g],C=r(w,l+1,l+1);c.push([g,C])}let _=O(c);o.length>0&&o!=="Object"&&(_=K([j(o),_])),u=_}}return f&&i.pop(),u}let s=r(e,0,1/0);return y(i.length===0,"We didn't pop off all the values off of the circular reference detector stack."),y(s!==void 0,"We expected to get some concrete type, not undefined."),y(s!==null,"We expected to get some concrete type, not null."),s}function h(e,n){if(e.type==="undefined")return n.type==="undefined"?e:d([e,n]);if(e.type==="undetermined")return n.type==="undetermined"?e:n;if(e.type==="null")return n.type==="null"?e:d([e,n]);if(e.type==="boolean")return n.type==="boolean"?e:d([e,n]);if(e.type==="number")return n.type==="number"?e:d([e,n]);if(e.type==="string")return n.type==="string"?e:d([e,n]);if(e.type==="selfref")return n.type==="selfref"?e:d([e,n]);if(e.type==="union")return d([e,n]);if(e.type==="tuple")if(n.type==="tuple")if(e.strict&&n.strict)if(e.value.length===n.value.length){for(let i=0;i<e.value.length;i++)e.value[i]=h(e.value[i],n.value[i]);return y(e.strict===!0),e}else{let i,r;e.value.length<n.value.length?(i=e,r=n):(i=n,r=e),y(i.value.length<r.value.length,`Tuple a was expected to be larger than tuple b: ${i.value.length} vs ${r.value.length}`);let s=[];for(let l=0;l<i.value.length;l++)s.push(h(i.value[l],r.value[l]));for(let l=i.value.length;l<r.value.length;l++)s.push(h(T(),r.value[l]));let p=V(s,!0);return y(p.strict===!0),p}else{if(e.strict||n.strict)return y(e.strict&&!n.strict||!e.strict&&n.strict),d([e,n]);if(y(!e.strict),y(!n.strict),e.value.length===n.value.length){for(let i=0;i<e.value.length;i++)e.value[i]=h(e.value[i],n.value[i]);return y(!e.strict),e}else{let i=[];for(let s of e.value)i.push(s);for(let s of n.value)i.push(s);y(i.length>0);let r=i[0];for(let s=1;s<i.length;s++)r=h(r,i[s]);return b(r)}}else if(n.type==="array"){if(e.strict)return y(e.strict===!0),d([e,n]);{if(e.value.length===0)return n;let i=[];for(let s of e.value)i.push(s);let r=n.value;for(let s=0;s<i.length;s++)r=h(r,i[s]);return n.value=r,n}}else return d([e,n]);else if(e.type==="array"){if(n.type==="array")return e.value=h(e.value,n.value),e;if(n.type==="tuple"){if(n.strict)return d([e,n]);{if(n.value.length===0)return e;let i=[];for(let s of n.value)i.push(s);let r=e.value;for(let s=0;s<i.length;s++)r=h(r,i[s]);return e.value=r,e}}else return d([e,n])}else if(e.type==="object")if(n.type==="object"){let i=new Set(Object.keys(e.value)),r=new Set(Object.keys(n.value)),s=new Set;for(let t of i)r.has(t)&&(s.add(t),i.delete(t),r.delete(t));let p=[];for(let t of s)p.push([t,h(e.value[t],n.value[t])]);for(let t of i)p.push([t,d([T(),e.value[t]])]);for(let t of r)p.push([t,d([T(),n.value[t]])]);return p.sort((t,f)=>t[0].localeCompare(f[0])),O(p)}else return d([e,n]);else{if(e.type==="objectunknown")return n.type==="objectunknown"?e:d([e,n]);if(e.type==="builder")return n.type==="builder"&&n.value===e.value?e:d([e,n]);if(e.type==="intersection")if(n.type==="intersection")if(y(e.value[0].type==="builder"),y(e.value[1].type!=="builder"),y(n.value[0].type==="builder"),y(n.value[1].type!=="builder"),e.value[0].value===n.value[0].value){let i=h(e.value[1],n.value[1]);return e.value[1]=i,e}else return d([e,n]);else return d([e,n]);else{if(e.type==="function")return n.type==="function"?e.number_of_arguments===n.number_of_arguments?e:d([e,n]):d([e,n]);console.log(e.type),B("combine_type: unhandled type: "+e.type)}}q()}function A(e,n,i){let r=Z(n,i);y(r!==null&&typeof r=="object");let s;if(m.has(e)){let p=N(m.get(e));p=h(p,r),y(p!==null&&typeof p=="object"),s=p,m.set(e,p)}else m.set(e,r),s=r;return y(s!==void 0),y(s!==null&&typeof s=="object"),s}function ee(e,n,i){v.push({name:e,value:n,inference_options:i})}var ne=(()=>{let e=/\d+:\d+$/,n=/([A-Za-z]([A-Za-z0-9+.-])*:\/\/.+?:\d+:\d+)/,i=/(<anonymous>:\d+:\d+)/,r=/([A-Za-z]([A-Za-z0-9+.-])*:\\.+?:\d+\d+)/,s=/(.+\/)*.+:\d+:\d+/,p=/([A-Za-z]([A-Za-z0-9+.-])*:\/\/.+?:\d+:\d+)$/,l=/@(?<location>debugger eval code:\d+:\d+)/;function t(f){let u=[],o=f.split(`
`).map(a=>a.trim()).filter(a=>a.length>0);if(o.length===0)return u;if(["Error","Error:"].includes(o[0])){o.shift(),o=o.map(a=>a.substring(3));for(let a of o)if(a[a.length-1]===")"){let c=a.indexOf("("),_=a.lastIndexOf(")");if(a=a.substring(c+1,_),a.match(e)){u.push(a);continue}else{u.push(null);continue}}else{let c;if(c=a.match(n),c!==null){u.push(c[0]);continue}if(c=a.match(i),c!==null){u.push(c[0]);continue}if(c=a.match(r),c!==null){u.push(c[0]);continue}if(c=a.match(s),c!==null){u.push(c[0]);continue}throw console.log(`Stack:
`+f),new Error("Unable to handle: ["+a+"]")}}else for(let a of o){let c;if(c=a.match(p),c!==null){u.push(c[0]);continue}if(c=a.match(l),c!==null){y(c.groups!==void 0),y(typeof c.groups.location=="string"),u.push(c.groups.location);continue}throw console.log(`Stack:
`+f),new Error("Unable to handle: ["+a+"]")}return u}return t})();function z(e){let i=new Error().stack;if(i===void 0)throw new Error("Error stack may not be undefined.");let s=ne(i)[e];return y(s!==void 0),y(s!==null),s}var v=[];function te(e,n){let i=z(2);return A(i,e,n)}function ue(e,n){let i=z(2);v.push({name:i,value:e,inference_options:n})}function F(){let e=v.length;for(let n=0;n<e;n++){let i=v[n],{name:r,value:s,inference_options:p}=i;A(r,s,p)}for(;v.length>0;)v.pop()}function $(e,n){let i="  ",r=!0;n!==void 0&&(n.ident!==void 0&&(i=n.ident),n.fmt!==void 0&&(r=n.fmt));function s(l,t,f){y(e!=null);let u=[];if(t.type==="undefined")u.push("undefined");else if(t.type==="undetermined")u.push("unknown");else if(t.type==="null")u.push("null");else if(t.type==="boolean")u.push("boolean");else if(t.type==="number")u.push("number");else if(t.type==="string")u.push("string");else if(t.type==="selfref")u.push('"<self-reference/>"');else if(t.type==="builder")u.push(t.value);else if(t.type==="tuple")if(t.value.length===0)u.push("[]");else if(t.value.length===1)u.push("["),u.push(s(l,t.value[0],!1)),u.push("]");else{if(u.push("["),r&&u.push(`
`),t.value.length>0){for(let o of t.value)r&&u.push(i.repeat(l+1)),u.push(s(l+1,o,!1)),u.push(","),r&&u.push(`
`);u.pop(),r&&u.pop(),r&&u.push(`
`)}r&&u.push(i.repeat(l)),u.push("]")}else if(t.type==="array"){let o=t.value.type==="union"||t.value.type==="intersection";o&&u.push("("),u.push(s(l+1,t.value,!1)),o&&u.push(")"),u.push("[]")}else if(t.type==="object"){let o=Object.keys(t.value);if(o.sort(),o.length===0)u.push("{}");else if(o.length===1){u.push("{ ");for(let a of o){let c=t.value[a];I(a)?u.push(a):u.push(JSON.stringify(a)),u.push(": "),u.push(s(l+1,c,!1)),u.push(", ")}u.pop(),u.push(" }")}else{u.push("{"),r&&u.push(`
`);for(let a of o){let c=t.value[a];r&&u.push(i.repeat(l+1)),I(a)?u.push(a):u.push(JSON.stringify(a)),u.push(": "),u.push(s(l+1,c,!1)),u.push(","),r&&u.push(`
`)}u.pop(),r&&u.pop(),r&&u.push(`
`),r&&u.push(i.repeat(l)),u.push("}")}}else if(t.type==="objectunknown")u.push("{ [key: string]: unknown }");else if(t.type==="union"){for(let o of t.value)u.push(s(l,o,!0)),u.push(" | ");u.pop()}else if(t.type==="function"){let o=t.number_of_arguments;if(f&&u.push("("),u.push("("),o>0){for(let a of t.parameter_names)u.push(`${a}: unknown`),u.push(", ");u.pop()}u.push(")"),u.push(" => "),u.push("unknown"),f&&u.push(")")}else if(t.type==="intersection"){let o=t.value[0],a=t.value[1];a.type==="object"&&Object.keys(a.value).length===0?u.push(s(l,o,!0)):(u.push(s(l,o,!0)),u.push(" & "),u.push(s(l,a,!0)))}else console.log("(turn_type_into_typescript) Unknown type value:",t),B(`(turn_type_into_typescript) Need to implement type value type: ${t.type}`);return u.join("")}return s(0,e,!1)}function re(){F();let e=[],n=0;for(let r of m.entries()){let s=r[0],p=r[1];e.push("// "+s+`:
`),e.push(`type T${n} = `),e.push($(p)+`;
`),e.push(`
`),n+=1}return e.length>0&&e.pop(),e.join("")}function le(e=!1){F(),e&&console.clear();let n=0;for(let i of m.entries()){let r=i[0],s=i[1],p=[];p.push("// "+r+`
`),p.push(`type T${n} = `),p.push($(s)+`;
`),p.push(`
`),console.log(p.join("")),n+=1}}function se(){m.clear()}globalThis.rti=E;})();
