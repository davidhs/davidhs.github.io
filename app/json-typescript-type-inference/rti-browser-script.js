"use strict";(()=>{var M=Object.defineProperty;var R=(e,t)=>{for(var s in t)M(e,s,{get:t[s],enumerable:!0})};var E={};R(E,{create_report_message:()=>re,delay_sample_point:()=>ue,delay_sample_value:()=>ee,forget:()=>se,infer_concrete_type:()=>Z,report:()=>le,sample_point:()=>te,sample_value:()=>A,sampled_values:()=>b,turn_type_into_typescript:()=>$});function y(e,t=""){if(!e)throw t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"?new Error(`Assertion failed: ${t}`):typeof t=="function"?(t(),new Error("Assertion failed!")):(console.error("Assertion failed:",t),new Error("Assertion failed!"))}function N(e){if(e==null)throw new Error(`Unwrapping violation, value was: ${e}`);return e}function W(e){throw new Error("Exhaustive check violated!")}function q(){throw new Error("Unreachable!")}var b=new Map,I=(()=>{let e=/^[_$A-Za-z]([_$A-Za-z0-9])*$/;function t(s){return s.match(e)!==null}return t})();function B(e=""){throw new Error(`Need to implement: ${e}`)}function x(e){if(e.type==="undefined")return 10;if(e.type==="null")return 20;if(e.type==="undetermined")return 30;if(e.type==="boolean")return 40;if(e.type==="number")return 50;if(e.type==="string")return 60;if(e.type==="selfref")return 70;if(e.type==="function")return 80;if(e.type==="tuple")return 90;if(e.type==="array")return 100;if(e.type==="objectunknown")return 110;if(e.type==="object")return 120;if(e.type==="builder")return 130;if(e.type==="intersection")return 140;if(e.type==="union")return 150;W(e)}function k(){return{type:"undetermined"}}function D(){return{type:"selfref"}}function T(){return{type:"undefined"}}function J(){return{type:"null"}}function P(){return{type:"boolean"}}function G(){return{type:"number"}}function H(){return{type:"string"}}function d(e){let t=[];{let r=function(u){if(u.type==="union")for(let o of u.value)r(o);else["undetermined","selfref","undefined","null","boolean","number","string","objectunknown"].includes(u.type)?l.has(u.type)||(l.add(u.type),t.push(u)):t.push(u)};var s=r;let l=new Set;for(let u of e)r(u)}{let l=[],r=[],u=[];for(let n=0;n<t.length;n++){let a=t[n];a.type==="tuple"?a.strict?r.push(a):u.push(a):l.push(a)}let o=[];if(r.length>0){let n=r[0];y(n.strict===!0);for(let a=1;a<r.length;a++){let p=r[a];if(y(p.strict===!0),n.value.length===p.value.length)for(let i=0;i<n.value.length;i++){let c=h(n.value[i],p.value[i]);n.value[i]=c}else{let i,c;n.value.length<p.value.length?(i=n,c=p):(i=p,c=n),y(i.value.length<c.value.length,`Tuple a was expected to be larger than tuple b: ${i.value.length} vs ${c.value.length}`),y(i.strict===!0),y(c.strict===!0);let f=[];for(let g=0;g<i.value.length;g++)f.push(h(i.value[g],c.value[g]));for(let g=i.value.length;g<c.value.length;g++)f.push(h(T(),c.value[g]));let _=V(f,!0);y(_.strict===!0),n=_}}y(n.type==="tuple"),y(n.strict===!0),o.push(n)}if(u.length>0){let n=u[0];y(n.strict===!1);for(let a=1;a<u.length;a++){let p=u[a];if(y(p.strict===!1),n.type==="tuple")if(n.value.length===p.value.length){for(let i=0;i<n.value.length;i++){let c=h(n.value[i],p.value[i]);n.value[i]=c}return n}else{let i=[];y(n.strict===!1),y(p.strict===!1);for(let f of n.value)i.push(f);for(let f of p.value)i.push(f);y(i.length>0);let c=i[0];for(let f=1;f<i.length;f++)c=h(c,i[f]);n=m(c)}else if(p.value.length>0){let i=[];for(let f of p.value)i.push(f);let c=n.value;for(let f=0;f<i.length;f++)c=h(c,i[f]);n.value=c}}o.push(n)}t=[...l,...o]}{let l=[],r=[];for(let o=0;o<t.length;o++){let n=t[o];n.type==="tuple"?n.strict?l.push(n):r.push(n):n.type==="array"?r.push(n):l.push(n)}let u=[];if(r.length>0){let o=r[0];for(let n=1;n<r.length;n++){let a=r[n];if(o.type==="tuple"){if(y(!o.strict),a.type==="tuple")if(y(!a.strict),o.value.length===a.value.length)for(let p=0;p<o.value.length;p++)o.value[p]=h(o.value[p],a.value[p]);else{let p=[];for(let c of o.value)p.push(c);for(let c of a.value)p.push(c);y(p.length>0);let i=p[0];for(let c=1;c<p.length;c++)i=h(i,p[c]);o=m(i)}else if(a.type==="array")if(o.value.length>0){let p=a.value;for(let i=0;i<o.value.length;i++)p=h(p,o.value[i]);a.value=p,o=a}else o=a}else if(o.type==="array")if(a.type==="tuple"){if(y(!a.strict),a.value.length>0){let p=o.value;for(let i=0;i<a.value.length;i++)p=h(p,a.value[i]);o.value=p}}else a.type==="array"&&(o.value=h(o.value,a.value))}u.push(o)}t=[...l,...u]}{let l=[],r=[];for(let o of t)o.type==="object"?l.push(o):r.push(o);let u=[];if(l.length>0){let o=l[0];for(let n=1;n<l.length;n++)o=h(o,l[n]);u.push(o)}t=[...r,...u]}{let l=[],r=new Map,u=new Set;for(let n of t)n.type==="builder"?r.has(n.value)||r.set(n.value,n):(n.type==="intersection"&&u.add(n.value[0].value),l.push(n));for(let n of u)r.delete(n);let o=[...r.values()];t=[...l,...o]}{let l=[],r=[];for(let n of t)n.type==="intersection"?l.push(n):r.push(n);l.sort((n,a)=>n.value[0].value.localeCompare(a.value[0].value));let u=[],o=new Map;for(let n of l){let a=n.value[0].value;o.hasOwnProperty(a)||o.set(a,[]),N(o.get(a)).push(n)}for(let n of o.values()){y(n.length>0);let a=n[0];for(let p=1;p<n.length;p++){let i=n[p];y(a.value[0].value===i.value[0].value);let c=h(a,i);y(c.type==="intersection"),a=c}u.push(a)}t=[...r,...u]}{let l=[],r=[];for(let o of t)o.type==="function"?l.push(o):r.push(o);l.sort((o,n)=>o.number_of_arguments-n.number_of_arguments);let u=[];{let o=null;for(let n=0;n<l.length;n++){let a=l[n];o===null?o=a:o.number_of_arguments!==a.number_of_arguments&&(u.push(o),o=a)}o!==null&&(u.push(o),o=null)}t=[...r,...u]}if(y(t.length>=1),t.sort((l,r)=>{let u=x(l),o=x(r);return u-o}),t.length===1){let l=t[0];return y(l.hasOwnProperty("type")),l}else return{type:"union",value:t}}function K(e){return y(e.length===2),y(e[0].type==="builder"),{type:"intersection",value:e}}function V(e,t=!1){return{type:"tuple",value:e,strict:t}}function m(e){return{type:"array",value:e}}function O(e){let t={};for(let s of e){let[l,r]=s;t[l]=r}return{type:"object",value:t}}function L(){return{type:"objectunknown"}}function S(e,t){let s=[];for(let l=0;l<e;l++)s.push(`p${l+1}`);if(t!==void 0)for(let l=0;l<t.length;l++)s[l]=t[l];return{type:"function",number_of_arguments:e,parameter_names:s}}function j(e){return{type:"builder",value:e}}var Q=/^[A-Z]/,X=/\((?<params>\s*\w+(,\s*\w+)*)\)/;function Y(e){return e===null?!1:typeof e=="object"?!0:typeof e=="function"}function U(e){let s=(""+e).match(X);if(s!==null){let l=s.groups;if(l!==void 0){let r=l.params;return typeof r!="string"?void 0:r.split(",").map(o=>o.trim())}else return}else return}function Z(e,t){let s=[];function l(u,o,n){let a=Y(u);if(a){if(s.includes(u))return D();s.push(u)}let p;if(u===void 0)p=T();else if(u===null)p=J();else if(typeof u=="boolean")p=P();else if(typeof u=="number")p=G();else if(typeof u=="string")p=H();else if(Object.prototype.toString.call(u)==="[object Arguments]"){if(o>=n)return a&&s.pop(),m(k());let i=[];for(let c=0;c<u.length;c++){let f=u[c];i.push(l(f,o+1,n))}p=V(i,!0)}else if(Array.isArray(u)){if(o>=n)return a&&s.pop(),m(k());if(t&&t.experimentalInterpretArrayAsArray)if(u.length===0)p=m(k());else{let i=[];for(let f of u)i.push(l(f,o+1,n));let c=i[0];for(let f=1;f<i.length;f++)c=h(c,i[f]);p=m(c)}else{let i=[];for(let c of u)i.push(l(c,o+1,n));p=V(i,!1)}}else if(typeof u=="function")if(u.name)if(u.name.match(Q)!==null)p=j(u.name);else{let i=U(u);p=S(u.length,i)}else{let i=U(u);p=S(u.length,i)}else{let i="";if(u&&u.constructor&&(i=u.constructor.name),o>=n)return a&&s.pop(),i==="Object"?L():j(i);if(["Object"].includes(i)){let c=Object.keys(u);c.sort();let f=[];for(let _ of c){let g=u[_],w=l(g,o+1,n);f.push([_,w])}p=O(f)}else{let c=Object.keys(u);c.sort();let f=[];for(let g of c){let w=u[g],C=l(w,o+1,o+1);f.push([g,C])}let _=O(f);i.length>0&&i!=="Object"&&(_=K([j(i),_])),p=_}}return a&&s.pop(),p}let r=l(e,0,1/0);return y(s.length===0,"We didn't pop off all the values off of the circular reference detector stack."),y(r!==void 0,"We expected to get some concrete type, not undefined."),y(r!==null,"We expected to get some concrete type, not null."),r}function h(e,t){if(e.type==="undefined")return t.type==="undefined"?e:d([e,t]);if(e.type==="undetermined")return t.type==="undetermined"?e:t;if(e.type==="null")return t.type==="null"?e:d([e,t]);if(e.type==="boolean")return t.type==="boolean"?e:d([e,t]);if(e.type==="number")return t.type==="number"?e:d([e,t]);if(e.type==="string")return t.type==="string"?e:d([e,t]);if(e.type==="selfref")return t.type==="selfref"?e:d([e,t]);if(e.type==="union")return d([e,t]);if(e.type==="tuple")if(t.type==="tuple")if(e.strict&&t.strict)if(e.value.length===t.value.length){for(let s=0;s<e.value.length;s++)e.value[s]=h(e.value[s],t.value[s]);return y(e.strict===!0),e}else{let s,l;e.value.length<t.value.length?(s=e,l=t):(s=t,l=e),y(s.value.length<l.value.length,`Tuple a was expected to be larger than tuple b: ${s.value.length} vs ${l.value.length}`);let r=[];for(let o=0;o<s.value.length;o++)r.push(h(s.value[o],l.value[o]));for(let o=s.value.length;o<l.value.length;o++)r.push(h(T(),l.value[o]));let u=V(r,!0);return y(u.strict===!0),u}else{if(e.strict||t.strict)return y(e.strict&&!t.strict||!e.strict&&t.strict),d([e,t]);if(y(!e.strict),y(!t.strict),e.value.length===t.value.length){for(let s=0;s<e.value.length;s++)e.value[s]=h(e.value[s],t.value[s]);return y(!e.strict),e}else{let s=[];for(let r of e.value)s.push(r);for(let r of t.value)s.push(r);y(s.length>0);let l=s[0];for(let r=1;r<s.length;r++)l=h(l,s[r]);return m(l)}}else if(t.type==="array"){if(e.strict)return y(e.strict===!0),d([e,t]);{if(e.value.length===0)return t;let s=[];for(let r of e.value)s.push(r);let l=t.value;for(let r=0;r<s.length;r++)l=h(l,s[r]);return t.value=l,t}}else return d([e,t]);else if(e.type==="array"){if(t.type==="array")return e.value=h(e.value,t.value),e;if(t.type==="tuple"){if(t.strict)return d([e,t]);{if(t.value.length===0)return e;let s=[];for(let r of t.value)s.push(r);let l=e.value;for(let r=0;r<s.length;r++)l=h(l,s[r]);return e.value=l,e}}else return d([e,t])}else if(e.type==="object")if(t.type==="object"){let s=new Set(Object.keys(e.value)),l=new Set(Object.keys(t.value)),r=new Set;for(let n of s)l.has(n)&&(r.add(n),s.delete(n),l.delete(n));let u=[];for(let n of r)u.push([n,h(e.value[n],t.value[n])]);for(let n of s)u.push([n,d([T(),e.value[n]])]);for(let n of l)u.push([n,d([T(),t.value[n]])]);return u.sort((n,a)=>n[0].localeCompare(a[0])),O(u)}else return d([e,t]);else{if(e.type==="objectunknown")return t.type==="objectunknown"?e:d([e,t]);if(e.type==="builder")return t.type==="builder"&&t.value===e.value?e:d([e,t]);if(e.type==="intersection")if(t.type==="intersection")if(y(e.value[0].type==="builder"),y(e.value[1].type!=="builder"),y(t.value[0].type==="builder"),y(t.value[1].type!=="builder"),e.value[0].value===t.value[0].value){let s=h(e.value[1],t.value[1]);return e.value[1]=s,e}else return d([e,t]);else return d([e,t]);else{if(e.type==="function")return t.type==="function"?e.number_of_arguments===t.number_of_arguments?e:d([e,t]):d([e,t]);console.log(e.type),B("combine_type: unhandled type: "+e.type)}}q()}function A(e,t,s){let l=Z(t,s);y(l!==null&&typeof l=="object");let r;if(b.has(e)){let u=N(b.get(e));u=h(u,l),y(u!==null&&typeof u=="object"),r=u,b.set(e,u)}else b.set(e,l),r=l;return y(r!==void 0),y(r!==null&&typeof r=="object"),r}function ee(e,t,s){v.push({name:e,value:t,inference_options:s})}var ne=(()=>{let e=/\d+:\d+$/,t=/([A-Za-z]([A-Za-z0-9+.-])*:\/\/.+?:\d+:\d+)/,s=/(<anonymous>:\d+:\d+)/,l=/([A-Za-z]([A-Za-z0-9+.-])*:\\.+?:\d+\d+)/,r=/(.+\/)*.+:\d+:\d+/,u=/([A-Za-z]([A-Za-z0-9+.-])*:\/\/.+?:\d+:\d+)$/,o=/@(?<location>debugger eval code:\d+:\d+)/;function n(a){let p=[],i=a.split(`
`).map(c=>c.trim()).filter(c=>c.length>0);if(i.length===0)return p;if(["Error","Error:"].includes(i[0])){i.shift(),i=i.map(c=>c.substring(3));for(let c of i)if(c[c.length-1]===")"){let f=c.indexOf("("),_=c.lastIndexOf(")");if(c=c.substring(f+1,_),c.match(e)){p.push(c);continue}else{p.push(null);continue}}else{let f;if(f=c.match(t),f!==null){p.push(f[0]);continue}if(f=c.match(s),f!==null){p.push(f[0]);continue}if(f=c.match(l),f!==null){p.push(f[0]);continue}if(f=c.match(r),f!==null){p.push(f[0]);continue}throw console.log(`Stack:
`+a),new Error("Unable to handle: ["+c+"]")}}else for(let c of i){let f;if(f=c.match(u),f!==null){p.push(f[0]);continue}if(f=c.match(o),f!==null){y(f.groups!==void 0),y(typeof f.groups.location=="string"),p.push(f.groups.location);continue}throw console.log(`Stack:
`+a),new Error("Unable to handle: ["+c+"]")}return p}return n})();function z(e){let s=new Error().stack;if(s===void 0)throw new Error("Error stack may not be undefined.");let r=ne(s)[e];return y(r!==void 0),y(r!==null),r}var v=[];function te(e,t){let s=z(2);return A(s,e,t)}function ue(e,t){let s=z(2);v.push({name:s,value:e,inference_options:t})}function F(){let e=v.length;for(let t=0;t<e;t++){let s=v[t],{name:l,value:r,inference_options:u}=s;A(l,r,u)}for(;v.length>0;)v.pop()}function $(e){let t="  ";function s(r,u,o){y(e!=null);let n=[];if(u.type==="undefined")n.push("undefined");else if(u.type==="undetermined")n.push("unknown");else if(u.type==="null")n.push("null");else if(u.type==="boolean")n.push("boolean");else if(u.type==="number")n.push("number");else if(u.type==="string")n.push("string");else if(u.type==="selfref")n.push('"<self-reference/>"');else if(u.type==="builder")n.push(u.value);else if(u.type==="tuple")if(u.value.length===0)n.push("[]");else if(u.value.length===1)n.push("["),n.push(s(r,u.value[0],!1)),n.push("]");else{if(n.push(`[
`),u.value.length>0){for(let a of u.value)n.push(t.repeat(r+1)+s(r+1,a,!1)),n.push(`,
`);n.pop(),n.push(`
`)}n.push(t.repeat(r)+"]")}else if(u.type==="array"){let a=u.value.type==="union"||u.value.type==="intersection";a&&n.push("("),n.push(s(r+1,u.value,!1)),a&&n.push(")"),n.push("[]")}else if(u.type==="object"){let a=Object.keys(u.value);if(a.sort(),a.length===0)n.push("{}");else if(a.length===1){n.push("{ ");for(let p of a){let i=u.value[p];I(p)?n.push(p):n.push(JSON.stringify(p)),n.push(": "),n.push(s(r+1,i,!1)),n.push(", ")}n.pop(),n.push(" }")}else{n.push(`{
`);for(let p of a){let i=u.value[p];n.push(t.repeat(r+1)),I(p)?n.push(p):n.push(JSON.stringify(p)),n.push(": "),n.push(s(r+1,i,!1)),n.push(`,
`)}n.pop(),n.push(`
`),n.push(t.repeat(r)+"}")}}else if(u.type==="objectunknown")n.push("{ [key: string]: unknown }");else if(u.type==="union"){for(let a of u.value)n.push(s(r,a,!0)),n.push(" | ");n.pop()}else if(u.type==="function"){let a=u.number_of_arguments;if(o&&n.push("("),n.push("("),a>0){for(let p of u.parameter_names)n.push(`${p}: unknown`),n.push(", ");n.pop()}n.push(")"),n.push(" => "),n.push("unknown"),o&&n.push(")")}else if(u.type==="intersection"){let a=u.value[0],p=u.value[1];p.type==="object"&&Object.keys(p.value).length===0?n.push(s(r,a,!0)):(n.push(s(r,a,!0)),n.push(" & "),n.push(s(r,p,!0)))}else console.log("(turn_type_into_typescript) Unknown type value:",u),B(`(turn_type_into_typescript) Need to implement type value type: ${u.type}`);return n.join("")}return s(0,e,!1)}function re(){F();let e=[],t=0;for(let l of b.entries()){let r=l[0],u=l[1];e.push("// "+r+`:
`),e.push(`type T${t} = `),e.push($(u)+`;
`),e.push(`
`),t+=1}return e.length>0&&e.pop(),e.join("")}function le(e=!1){F(),e&&console.clear();let t=0;for(let s of b.entries()){let l=s[0],r=s[1],u=[];u.push("// "+l+`
`),u.push(`type T${t} = `),u.push($(r)+`;
`),u.push(`
`),console.log(u.join("")),t+=1}}function se(){b.clear()}globalThis.rti=E;})();
